diff -X dontdiff -ur fte-0.49.13.1/src/c_bind.cpp fte-0.50.0/src/c_bind.cpp
--- fte-0.49.13.1/src/c_bind.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_bind.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -365,7 +365,6 @@
         }
     }
 
-    #ifdef CONFIG_ABBREV
     // free Abbrev's
     {
         EAbbrev *ab;
@@ -379,7 +378,6 @@
             }
         }
     }
-    #endif
 
     // free keymap's
     {
@@ -518,17 +516,17 @@
     return 0;
 }
 
-int GetKeyName(char *Key, int KeySize, KeySel &ks) {
-    strlcpy(Key, "", KeySize);
+int GetKeyName(char *Key, KeySel &ks) {
+    *Key = 0;
 
-    if (ks.Key  & kfAlt)   strlcat(Key, "A+", KeySize);
-    if (ks.Mask & kfAlt)   strlcat(Key, "A-", KeySize);
-    if (ks.Key  & kfCtrl)  strlcat(Key, "C+", KeySize);
-    if (ks.Mask & kfCtrl)  strlcat(Key, "C-", KeySize);
-    if (ks.Key  & kfGray)  strlcat(Key, "G+", KeySize);
-    if (ks.Mask & kfGray)  strlcat(Key, "G-", KeySize);
-    if (ks.Key  & kfShift) strlcat(Key, "S+", KeySize);
-    if (ks.Mask & kfShift) strlcat(Key, "S-", KeySize);
+    if (ks.Key  & kfAlt)   strcat(Key, "A+");
+    if (ks.Mask & kfAlt)   strcat(Key, "A-");
+    if (ks.Key  & kfCtrl)  strcat(Key, "C+");
+    if (ks.Mask & kfCtrl)  strcat(Key, "C-");
+    if (ks.Key  & kfGray)  strcat(Key, "G+");
+    if (ks.Mask & kfGray)  strcat(Key, "G-");
+    if (ks.Key  & kfShift) strcat(Key, "S+");
+    if (ks.Mask & kfShift) strcat(Key, "S-");
 
     if (keyCode(ks.Key) < 256) {
         char c[2];
@@ -540,13 +538,13 @@
         //    if (c[0] < ' ')
         //        c[0] += '@';
         if (c[0] == 32)
-            strlcat(Key, "Space", KeySize);
+            strcat(Key, "Space");
         else
-            strlcat(Key, c, KeySize);
+            strcat(Key, c);
     } else {
         for (int i = 0; i < int(sizeof(KeyList)/sizeof(KeyList[0])); i++)
             if (KeyList[i].Key == keyCode(ks.Key)) {
-                strlcat(Key, KeyList[i].Name, KeySize);
+                strcat(Key, KeyList[i].Name);
                 break;
             }
     }
diff -X dontdiff -ur fte-0.49.13.1/src/c_bind.h fte-0.50.0/src/c_bind.h
--- fte-0.49.13.1/src/c_bind.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_bind.h	2007-04-15 11:00:00.000000000 +0800
@@ -151,7 +151,7 @@
 void ExecKey(EKey *Key);
 EKey *SetKey(EEventMap *aMap, const char *Key);
 int ParseKey(const char *Key, KeySel &ks);
-int GetKeyName(char *Key, int KeySize, KeySel &ks);
+int GetKeyName(char *Key, KeySel &ks);
 
 int NewCommand(const char *Name);
 int RunCommand(int Command);
diff -X dontdiff -ur fte-0.49.13.1/src/c_cmdtab.h fte-0.50.0/src/c_cmdtab.h
--- fte-0.49.13.1/src/c_cmdtab.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_cmdtab.h	2007-04-15 11:00:00.000000000 +0800
@@ -91,7 +91,6 @@
 TAB(LineSplit),
 TAB(LineJoin),
 TAB(LineNew),
-TAB(LineNews),
 TAB(LineIndent),
 TAB(LineTrim),
 TAB(FileTrim),
@@ -140,10 +139,7 @@
 TAB(MoveSavedPos),
 TAB(SavePos),
 TAB(CompleteWord),
-TAB(CompleteGrep),
 TAB(MoveToLine),
-TAB(FileGrepLine),
-TAB(FileGrepName),
 TAB(MoveToColumn),
 TAB(BlockPasteStream),
 TAB(BlockPasteLine),
@@ -184,7 +180,6 @@
 TAB(FileSaveAs),
 TAB(FileWriteTo),
 TAB(FileOpen),
-TAB(FileCheck),
 TAB(FileOpenInMode),
 TAB(FilePrint),
 
@@ -203,7 +198,6 @@
 TAB(FindRepeatReverse),
 
 TAB(InsertChar),
-TAB(InsertAdupChar),
 
 TAB(FileClose),
 TAB(FileCloseAll),
@@ -224,8 +218,6 @@
 TAB(DirOpen),
 
 TAB(Compile),
-TAB(Grep),
-TAB(vGrep),
 TAB(CompilePrevError),
 TAB(CompileNextError),
 TAB(ViewMessages),
@@ -245,13 +237,11 @@
 TAB(ChangeFlags),
 
 TAB(ToggleAutoIndent),
-TAB(ToggleAutoTag),
 TAB(ToggleInsert),
 TAB(ToggleExpandTabs),
 TAB(ToggleShowTabs),
 TAB(ToggleUndo),
 TAB(ToggleReadOnly),
-TAB(ChangeToReadOnly),
 TAB(ToggleKeepBackups),
 TAB(ToggleMatchCase),
 TAB(ToggleBackSpKillTab),
@@ -264,7 +254,6 @@
 TAB(ToggleShowMarkers),
 TAB(ToggleHilitTags),
 TAB(ToggleShowBookmarks),
-TAB(ToggleMakeBackups),
 TAB(SetLeftMargin),
 TAB(SetRightMargin),
 TAB(SetPrintDevice),
@@ -323,8 +312,6 @@
 TAB(SearchReplace),
 TAB(SearchReplaceB),
 TAB(SearchReplaceRx),
-TAB(BlockComment),
-TAB(BlockUnComment),
 TAB(InsertDate),
 TAB(InsertUid),
 TAB(FrameNew),
diff -X dontdiff -ur fte-0.49.13.1/src/c_color.cpp fte-0.50.0/src/c_color.cpp
--- fte-0.49.13.1/src/c_color.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_color.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -22,26 +22,16 @@
 
 /* Plain */
 
-#ifdef CONFIG_DOSEDIT
-ChColor hcPlain_Normal = 0x17;
-ChColor hcPlain_Background = 0x17;
-#else
 ChColor hcPlain_Normal = 0x07;
 ChColor hcPlain_Background = 0x07;
-#endif
 ChColor hcPlain_Selected = 0x30;
 ChColor hcPlain_Markers = 0x03;
 ChColor hcPlain_Found = 0x40;
 ChColor hcPlain_Keyword = 0x0F;
-#ifdef CONFIG_FOLDS
 ChColor hcPlain_Folds[5] = { 0x0A, 0x0A, 0x0A, 0x0A, 0x0A };
-#endif
 ChColor hcPlain_HilitWord = 0x0D;
-#ifdef CONFIG_BOOKMARKS
 ChColor hcPlain_Bookmark = 0x20;
-#endif
 
-#ifdef CONFIG_OBJ_LIST
 /* LIST */
 //ChColor hcList_Border       = 0x03;
 ChColor hcList_Status       = 0x70;
@@ -53,7 +43,6 @@
 ChColor hcList_MarkSelect   = 0x1B;
 ChColor hcList_MarkHilit    = 0xB1;
 ChColor hcList_MarkHilitSel = 0x1B;
-#endif
 
 ChColor hcScrollBar_Arrows = 0x70;
 ChColor hcScrollBar_Back   = 0x07;
@@ -62,19 +51,10 @@
 ChColor hcAsciiChars = 0x07;
 
 ChColor hcMenu_Background = 0x70;
-#ifdef CONFIG_DOSEDIT
-ChColor hcMenu_ActiveItem = 0x07;
-ChColor hcMenu_ActiveChar = 0x0F;
-#else
 ChColor hcMenu_ActiveItem = 0x1F;
 ChColor hcMenu_ActiveChar = 0x1C;
-#endif
 ChColor hcMenu_NormalItem = 0x70;
-#ifdef CONFIG_DOSEDIT
-ChColor hcMenu_NormalChar = 0x7f;
-#else
 ChColor hcMenu_NormalChar = 0x74;
-#endif
 
 ChColor hcChoice_Title      = 0x1F;
 ChColor hcChoice_Param      = 0x1B;
@@ -100,7 +80,6 @@
     { "Entry.Prompt",      &hcEntry_Prompt },
     { "Entry.Selection",   &hcEntry_Selection },
 
-#ifdef CONFIG_OBJ_LIST
     { "LIST.Status",       &hcList_Status },
     { "LIST.Normal",       &hcList_Normal },
     { "LIST.Selected",     &hcList_Selected },
@@ -110,7 +89,6 @@
     { "LIST.MarkSelect",   &hcList_MarkSelect },
     { "LIST.MarkHilit",    &hcList_MarkHilit },
     { "LIST.MarkHilitSel", &hcList_MarkHilitSel },
-#endif
 
     { "PLAIN.Normal",      &hcPlain_Normal },
     { "PLAIN.Background",  &hcPlain_Background },
@@ -118,19 +96,15 @@
     { "PLAIN.Markers",     &hcPlain_Markers },
     { "PLAIN.Found",       &hcPlain_Found },
     { "PLAIN.Keyword",     &hcPlain_Keyword },
-#ifdef CONFIG_FOLDS
     { "PLAIN.Folds",       &hcPlain_Folds[0] }, // added some backwards compatibility
     { "PLAIN.Folds0",      &hcPlain_Folds[0] },
     { "PLAIN.Folds1",      &hcPlain_Folds[1] },
     { "PLAIN.Folds2",      &hcPlain_Folds[2] },
     { "PLAIN.Folds3",      &hcPlain_Folds[3] },
     { "PLAIN.Folds4",      &hcPlain_Folds[4] },
-#endif
     { "PLAIN.HilitWord",   &hcPlain_HilitWord },
-#ifdef CONFIG_BOOKMARKS
     { "PLAIN.Bookmark",    &hcPlain_Bookmark },
 
-#endif
     { "ScrollBar.Arrows",  &hcScrollBar_Arrows },
     { "ScrollBar.Back",    &hcScrollBar_Back },
     { "ScrollBar.Fore",    &hcScrollBar_Fore },
diff -X dontdiff -ur fte-0.49.13.1/src/c_commands.h fte-0.50.0/src/c_commands.h
--- fte-0.49.13.1/src/c_commands.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_commands.h	2007-04-15 11:00:00.000000000 +0800
@@ -142,10 +142,6 @@
     /// page. If there already, move to the end of file.
     ExMoveToLine,
     /// Move to line number given as argument
-    ExFileGrepLine,
-    /// Move to line by grep index
-    ExFileGrepName,
-    /// Move to filename by grep index
     ExMoveToColumn,
     /// Move to column given as argument
     ExMoveSavedPosCol,
@@ -197,10 +193,6 @@
     //& <A HREF="modes.html#ms.BackSpKillTab">BackSpKillTab</A>
     //& <A HREF="modes.html#ms.BackSpKillBlock">BackSpKillBlock</A>
 
-    ExBlockComment,
-    /// Insert comment as block operator
-    ExBlockUnComment,
-    /// Remove comment as block operator
     //<cmd_line> Line Commands
     ExLineInsert,
     /// Insert a new line before the current one.
@@ -213,8 +205,6 @@
     /// the end of line, the current line is first padded with whitespace.
     ExLineNew,
     /// Append a new line and move to the beginning of new line.
-    ExLineNews,
-    /// Append a new line with extra feature (vgrep)
     ExLineIndent,
     /// Reindent current line.
     ExLineTrim,
@@ -393,8 +383,6 @@
     /// Insert space
     ExInsertChar,
     /// Insert character argument at cursor position
-    ExInsertAdupChar,
-    /// Insert Above Dup Char
     ExTypeChar,
     /// Insert character at cursor position (expanding abbreviations)
     ExInsertTab,
@@ -412,8 +400,7 @@
     ExCompleteWord,
     /// Complete current word to last word starting with the
     /// same prefix.
-    ExCompleteGrep,
-    /// Complete Grep to Load File
+    
     ExFilePrev,
     /// Switch to previous file in ring.
     ExFileNext,
@@ -426,8 +413,6 @@
     //<cmd_file> File Commands
     ExFileOpen,
     /// Open file
-    ExFileCheck,
-    /// CheckFile is founded or not (lechee)
     ExFileOpenInMode,
     /// Open file in specified mode
     ExFileReload,
@@ -523,11 +508,7 @@
 
     //<cmd_compile> Compiler Support
     ExCompile,
-    /// Ask for Grep
-    ExGrep,
-    /// Ask for vGrep  (lechee)
-    ExvGrep,
-    /// Ask for compile command and run compiler (lechee)
+    /// Ask for compile command and run compiler
     ExRunCompiler,
     /// Run configured compile command
     ExViewMessages,
@@ -583,8 +564,6 @@
     //<cmd_option> Option commands
     ExToggleAutoIndent,
     ///
-    ExToggleAutoTag,
-    ///
     ExToggleInsert,
     ///
     ExToggleExpandTabs,
@@ -595,8 +574,6 @@
     ///
     ExToggleReadOnly,
     ///
-    ExChangeToReadOnly,
-    ///
     ExToggleKeepBackups,
     ///
     ExToggleMatchCase,
@@ -621,8 +598,6 @@
     ///
     ExToggleShowBookmarks,
     ///
-    ExToggleMakeBackups,
-    ///
     ExSetLeftMargin,
     ///
     ExSetRightMargin,
diff -X dontdiff -ur fte-0.49.13.1/src/c_config.cpp fte-0.50.0/src/c_config.cpp
--- fte-0.49.13.1/src/c_config.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_config.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -52,7 +52,7 @@
 extern int ShowHScroll;
 extern int ShowMenuBar;
 
-int SystemClipboard = 1;
+int SystemClipboard = 0;
 int ScreenSizeX = -1, ScreenSizeY = -1;
 int ScrollBarWidth = 1;
 int CursorInsSize[2] = { 90, 100 };
@@ -67,13 +67,6 @@
 char PrintDevice[MAXPATH] = "\\DEV\\PRN";
 #endif
 char CompileCommand[256] = "make";
-
-char SearchPattern[MAXSEARCH] = "";    //lechee
-char GrepName[MAXPATH] = "";
-int  GrepLine = 0;
-char VDIR[512] = "";
-char VMASK[512] = "";
-char VMark[512] = "";
 int KeepHistory = 0;
 int LoadDesktopOnEntry = 0;
 int SaveDesktopOnExit = 0;
@@ -92,10 +85,8 @@
 char *ConfigSourcePath = 0;
 int IgnoreBufferList = 0;
 static GUICharactersEntry *GUICharacters = NULL;
-#ifdef CONFIG_OBJ_CVS
 char CvsCommand[256] = "cvs";
 char CvsLogMode[32] = "PLAIN";
-#endif
 int ReassignModelIds = 0;
 int RecheckReadOnly = 0;
 char XShellCommand[256] = "xterm";
@@ -209,10 +200,8 @@
 #endif
         if (j == BFI_EventMap) {
             mode->fEventMap = FindEventMap(string);
-#ifdef CONFIG_INDENT
         } else if (j == BFI_IndentMode) {
             mode->Flags.num[j] = GetIndentMode(string);
-#endif
         } else if (j == BFS_WordChars) {
             SetWordChars(mode->Flags.WordChars, string);
         } else if (j == BFS_CapitalChars) {
@@ -313,10 +302,8 @@
     case FLAG_WindowFont: strlcpy(WindowFont, string, sizeof(WindowFont)); break;
     case FLAG_HelpCommand: strlcpy(HelpCommand, string, sizeof(HelpCommand)); break;
     case FLAG_GUICharacters: AppendGUICharacters (string); break;
-#ifdef CONFIG_OBJ_CVS
     case FLAG_CvsCommand: strlcpy(CvsCommand, string, sizeof(CvsCommand)); break;
     case FLAG_CvsLogMode: strlcpy(CvsLogMode, string, sizeof(CvsLogMode)); break;
-#endif
     case FLAG_XShellCommand: strlcpy(XShellCommand, string, sizeof(XShellCommand)); break;
     default:
         //printf("Unknown global string: %ld\n", what);
@@ -1101,7 +1088,6 @@
             }
             break;
 
-#ifdef CONFIG_SYNTAX_HILIT
         case CF_COLORIZE:
             {
                 EColorize *Mode = 0;
@@ -1124,7 +1110,6 @@
             }
             break;
 
-#endif
         case CF_MODE:
             {
                 EMode *Mode = 0;
@@ -1179,7 +1164,6 @@
     }
     return -1;
 }
-#ifdef CONFIG_EXTERNAL_CONFIG
 
 int LoadConfig(int /*argc*/, char ** /*argv*/, char *CfgFileName) {
     STARTFUNC("LoadConfig");
@@ -1196,14 +1180,6 @@
         close(fd);
         ENDFUNCRC(-1);
     }
-
-    // check that we have enough room for signature (CONFIG_ID + VERNUM)
-    if (statbuf.st_size < (4+4)) {
-        close(fd);
-        DieError(0, "Bad .CNF signature");
-        ENDFUNCRC(-1);
-    }
-
     buffer = (char *) malloc(statbuf.st_size);
     if (buffer == 0) {
         close(fd);
@@ -1254,7 +1230,6 @@
     }
     ENDFUNCRC(rc);
 }
-#endif
 
 static //const
 #include "defcfg.h"
diff -X dontdiff -ur fte-0.49.13.1/src/c_config.h fte-0.50.0/src/c_config.h
--- fte-0.49.13.1/src/c_config.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_config.h	2007-04-15 11:00:00.000000000 +0800
@@ -10,10 +10,6 @@
 #ifndef __CONFIG_H
 #define __CONFIG_H
 
-#ifndef MAXSEARCH
-#define MAXSEARCH 512
-#endif
-
 extern int ScreenSizeX;
 extern int ScreenSizeY;
 extern int CursorInsSize[2];
@@ -27,12 +23,6 @@
 extern int WSStyleSearch;
 extern char PrintDevice[MAXPATH];
 extern char CompileCommand[256];
-extern char SearchPattern[MAXSEARCH];
-extern char GrepName[MAXPATH];
-extern int  GrepLine;
-extern char VDIR[512];
-extern char VMASK[512];
-extern char CMark[512];
 extern int KeepHistory;
 extern int LoadDesktopOnEntry;
 extern int SaveDesktopOnExit;
diff -X dontdiff -ur fte-0.49.13.1/src/c_desktop.cpp fte-0.50.0/src/c_desktop.cpp
--- fte-0.49.13.1/src/c_desktop.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_desktop.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -129,9 +129,8 @@
 #ifdef CONFIG_TAGS
             if (line[0] == 'T' && line[1] == '|') { // tag file
                 TagsAdd(line + 2);
-            } else
 #endif
-            if (line[0] == 'M' && line[1] == '|') { // mark
+            } else if (line[0] == 'M' && line[1] == '|') { // mark
                 char *name;
                 char *file;
                 EPoint P;
diff -X dontdiff -ur fte-0.49.13.1/src/cfte.cpp fte-0.50.0/src/cfte.cpp
--- fte-0.49.13.1/src/cfte.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/cfte.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -22,7 +22,6 @@
 #include "sysdep.h"
 #include "c_fconfig.h"
 #include "s_files.h"
-#include "s_string.h"
 #include "c_mode.h"
 #include "console.h"
 #include "c_hilit.h"
@@ -183,11 +182,11 @@
 	    switch(n)
 	    {
 	    case 0:
-		strlcpy(Source, argv[i], sizeof(Source));
+		strcpy(Source, argv[i]);
 		break;
 
 	    case 1:
-                strlcpy(Target, argv[i], sizeof(Target));
+                strcpy(Target, argv[i]);
 		break;
 
 	    default:
@@ -203,8 +202,22 @@
 	fprintf(stderr, "No configuration file specified\n");
 	exit(1);
     }
+/*    if (strncmp(p, "-o", 2) == 0) {
+        p += 2;
+        offset = atol(p);
+        n++;
+    }
+    if (n == 1 && argc == 4) {
+        fprintf(stderr, "Invalid option '%s'\n", argv[1]);
+        exit(1);
+    }
+    strcpy(Source, argv[n++]);
+    strcpy(Target, "fte-new.cnf");
+    if (n < argc)
+        strcpy(Target, argv[n++]);
+	*/
 
-    JustDirectory(Target, XTarget, sizeof(XTarget));
+    JustDirectory(Target, XTarget);
     Slash(XTarget, 1);
 
     if (preprocess_only == false)
@@ -252,7 +265,7 @@
 #ifdef UNIX
                "."
 #endif
-               , StartDir, sizeof(StartDir));
+               , StartDir);
     Slash(StartDir, 1);
 
     if (preprocess_only == false)
@@ -260,7 +273,7 @@
         CurPos cp;
         char FSource[MAXPATH];
 
-        if (ExpandPath(Source, FSource, sizeof(FSource)) != 0) {
+        if (ExpandPath(Source, FSource) != 0) {
             fprintf(stderr, "Could not expand path %s\n", Source);
             exit(1);
         }
@@ -324,7 +337,6 @@
 
 static const OrdLookup mode_num[] = {
 MODE_BFI(AutoIndent),
-MODE_BFI(AutoTag),
 MODE_BFI(Insert),
 MODE_BFI(DrawOn),
 MODE_BFI(HilitOn),
@@ -370,7 +382,6 @@
 MODE_BFI(SaveBookmarks),
 MODE_BFI(HilitTags),
 MODE_BFI(ShowBookmarks),
-MODE_BFI(MakeBackups),
 { 0, 0 },
 };
 
@@ -387,7 +398,6 @@
 MODE_BFS(FileNameRx),
 MODE_BFS(FirstLineRx),
 MODE_BFS(CompileCommand),
-MODE_BFS(CommentPat),
 MODE_BFI(EventMap),
 { 0, 0 },
 };
@@ -1636,7 +1646,7 @@
                                     s = GetString(cp);
                                     if (s == 0) Fail(cp, "Parse failed");
                                     var = Lookup(global_string, w);
-                                    if (var == -1) Fail(cp, "Lookup of '%s' failed", w);
+                                    if (var == -1) Fail(cp, "Lookup of '%s' failed");
                                     PutNumber(cp, CF_SETVAR, var);
                                     PutString(cp, CF_STRING, s);
                                 }
@@ -1862,10 +1872,10 @@
 
     //fprintf(stderr, "Loading file %s %s\n", WhereName, CfgName);
 
-    JustDirectory(WhereName, last, sizeof(last));
+    JustDirectory(WhereName, last);
 
     if (IsFullPath(CfgName)) {
-        strlcpy(Cfg, CfgName, sizeof(Cfg));
+        strcpy(Cfg, CfgName);
     } else {
         // here we will try relative to a number of places.
         // 1. User's .fte directory.
@@ -1881,23 +1891,23 @@
         // 1. User's .fte directory.
         char tmp[MAXPATH];
         sprintf(tmp, "~/.fte/%s", CfgName);
-        ExpandPath(tmp, Cfg, sizeof(Cfg));
+        ExpandPath(tmp, Cfg);
         //fprintf(stderr, "Looking for %s\n", Cfg);
         if (!FileExists(Cfg))
         {
             // Okay, now try "local config".
             sprintf(tmp, "%slocalconfig/%s", StartDir, CfgName);
-            ExpandPath(tmp, Cfg, sizeof(Cfg));
+            ExpandPath(tmp, Cfg);
             //fprintf(stderr, "Looking for %s\n", Cfg);
             if (!FileExists(Cfg))
             {
                 sprintf(tmp, "%sconfig/%s", StartDir, CfgName);
-                ExpandPath(tmp, Cfg, sizeof(Cfg));
+                ExpandPath(tmp, Cfg);
                 //fprintf(stderr, "Looking for %s\n", Cfg);
                 if (!FileExists(Cfg))
                 {
                     sprintf(tmp, "./%s", CfgName);
-                    ExpandPath(tmp, Cfg, sizeof(Cfg));
+                    ExpandPath(tmp, Cfg);
                     //fprintf(stderr, "Looking for %s\n", Cfg);
                     if (!FileExists(Cfg))
                     {
@@ -1912,8 +1922,8 @@
         }
 #else // UNIX
         SlashDir(last);
-        strlcat(last, CfgName, sizeof(last));
-        ExpandPath(last, Cfg, sizeof(Cfg));
+        strcat(last, CfgName);
+        ExpandPath(last, Cfg);
 #endif // UNIX
     }
     // puts(Cfg);
diff -X dontdiff -ur fte-0.49.13.1/src/c_hilit.cpp fte-0.50.0/src/c_hilit.cpp
--- fte-0.49.13.1/src/c_hilit.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_hilit.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,23 +9,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_INDENT
-static const struct {
-    const char *Name;
-    int Num;
-} IndentModes[] = {
-#ifdef CONFIG_INDENT_C
-{ "C", INDENT_C },
-#endif
-#ifdef CONFIG_INDENT_REXX
-{ "REXX", INDENT_REXX },
-#endif
-#ifdef CONFIG_INDENT_SIMPLE
-{ "SIMPLE", INDENT_REXX },
-#endif
-{ "PLAIN", INDENT_PLAIN },
-};
-#endif
 #ifdef CONFIG_SYNTAX_HILIT
 static const struct {
     const char *Name;
@@ -74,8 +57,31 @@
 #endif
 };
 
+static const struct {
+    const char *Name;
+    int Num;
+} IndentModes[] = {
+#ifdef CONFIG_INDENT_C
+{ "C", INDENT_C },
+#endif
+#ifdef CONFIG_INDENT_REXX
+{ "REXX", INDENT_REXX },
+#endif
+#ifdef CONFIG_INDENT_SIMPLE
+{ "SIMPLE", INDENT_REXX },
+#endif
+{ "PLAIN", INDENT_PLAIN },
+};
+
 EColorize *Colorizers = 0;
 
+int GetIndentMode(const char *Str) {
+    for (unsigned int i = 0; i < sizeof(IndentModes) / sizeof(IndentModes[0]); i++)
+        if (strcmp(Str, IndentModes[i].Name) == 0)
+            return IndentModes[i].Num;
+    return 0;
+}
+
 int GetHilitMode(const char *Str) {
     for (unsigned int i = 0; i < sizeof(HilitModes) / sizeof(HilitModes[0]); i++)
         if (strcmp(Str, HilitModes[i].Name) == 0)
@@ -147,9 +153,6 @@
 }
 #endif
 
-
-
-
 /* ======================================================================= */
 
 EColorize::EColorize(const char *AName, const char *AParent) {
@@ -312,11 +315,3 @@
 }
 
 #endif
-#ifdef CONFIG_INDENT
-int GetIndentMode(const char *Str) {
-    for (unsigned int i = 0; i < sizeof(IndentModes) / sizeof(IndentModes[0]); i++)
-        if (strcmp(Str, IndentModes[i].Name) == 0)
-            return IndentModes[i].Num;
-    return 0;
-}
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/c_hilit.h fte-0.50.0/src/c_hilit.h
--- fte-0.49.13.1/src/c_hilit.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_hilit.h	2007-04-15 11:00:00.000000000 +0800
@@ -12,7 +12,6 @@
 
 #include "e_regex.h"
 
-
 typedef unsigned short hlState;
 typedef unsigned char hsState;
 
@@ -82,8 +81,6 @@
 int Indent_SIMPLE(EBuffer *B, int Line, int PosCursor);
 #endif
 
-#endif
-
  /*
   * NT has 2-byte charcode and attribute... Following is not portable to non-
   * intel; should be replaced by formal TCell definition' usage instead of
@@ -95,12 +92,8 @@
 #    define PCLI unsigned char
 #endif
 
-#ifdef CONFIG_SYNTAX_HILIT
 #define HILIT_CLRD() \
-    (Colors ? ((Color < COUNT_CLR) ? Colors[Color] : Color - COUNT_CLR) : hcPlain_Normal)
-#else
-#define HILIT_CLRD() hcPlain_Normal
-#endif
+    ((Color < COUNT_CLR) ? Colors[Color] : Color - COUNT_CLR)
 
 #define ColorChar() \
     do {\
@@ -158,9 +151,11 @@
         } \
     } while (0)
 
-#define HILIT_LINE_VARS(Line) \
+#define HILIT_VARS(ColorTable, Line) \
     PCLI *BPtr; \
     int BPos; \
+    ChColor *Colors = ColorTable; \
+    ChColor Color = CLR_Normal; \
     int i; \
     int len = Line->Count; \
     char *p = Line->Chars; \
@@ -168,17 +163,6 @@
     int TabSize = BFI(BF, BFI_TabSize); \
     int ExpandTabs = BFI(BF, BFI_ExpandTabs);
 
-#define HILIT_COLOR_VARS(ColorTable, Line) \
-    ChColor *Colors = ColorTable; \
-    ChColor Color = CLR_Normal; \
-    HILIT_LINE_VARS(Line);
-
-#ifdef CONFIG_SYNTAX_HILIT
-#define HILIT_VARS(c, l) HILIT_COLOR_VARS(c, l)
-#else
-#define HILIT_VARS(c, l) HILIT_LINE_VARS(l)
-#endif
-
 //#define HILIT_VARS2()
 //    int len1 = len;
 //    char *last = p + len1 - 1;
@@ -194,8 +178,6 @@
     continue;\
     }
 
-#ifdef CONFIG_SYNTAX_HILIT
-
 #define CK_MAXLEN 64
 
 inline bool isZeroArray(int* Count, size_t len)
diff -X dontdiff -ur fte-0.49.13.1/src/c_history.cpp fte-0.50.0/src/c_history.cpp
--- fte-0.49.13.1/src/c_history.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_history.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -431,8 +431,10 @@
         }
     }
     // Should not get here
-#endif
     return 0;
+#else
+    return 0
+#endif
 }
 
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/c_history.h fte-0.50.0/src/c_history.h
--- fte-0.49.13.1/src/c_history.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_history.h	2007-04-15 11:00:00.000000000 +0800
@@ -62,7 +62,6 @@
  */
 int StoreBookmarks(EBuffer *buf);
 
-#endif
 /* history values */
 #define HIST_DEFAULT    0
 #define HIST_PATH       1
@@ -79,9 +78,7 @@
 #define HIST_CVS       12
 #define HIST_CVSDIFF   13
 #define HIST_CVSCOMMIT 14
-#define HIST_GREP      15
-#define HIST_BMASK     16
-#define HIST_GREPPATH  17
 
+#endif
 
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/clip_gpm.cpp fte-0.50.0/src/clip_gpm.cpp
--- fte-0.49.13.1/src/clip_gpm.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/clip_gpm.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,11 +9,10 @@
 
 #include "fte.h"
 
-int GetPMClip(int clipboard) {
+int GetPMClip() {
     return 0;
 }
 
-int PutPMClip(int clipboard) {
-    Msg(S_INFO,"_gpm");
+int PutPMClip() {
     return 0;
 }
diff -X dontdiff -ur fte-0.49.13.1/src/clip_no.cpp fte-0.50.0/src/clip_no.cpp
--- fte-0.49.13.1/src/clip_no.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/clip_no.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,12 +9,10 @@
 
 #include "fte.h"
 
-
-
-int GetPMClip(int clipboard) {
+int GetPMClip() {
     return 0;
 }
 
-int PutPMClip(int clipboard) {
+int PutPMClip() {
     return 0;
 }
diff -X dontdiff -ur fte-0.49.13.1/src/clip_os2.cpp fte-0.50.0/src/clip_os2.cpp
--- fte-0.49.13.1/src/clip_os2.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/clip_os2.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -10,15 +10,11 @@
 #include "fte.h"
 #include "clip.h"
 
-int GetPMClip(int clipboard) {
+int GetPMClip() {
     ClipData cd;
     unsigned int i,j, l, dx;
     EPoint P;
 
-    if (clipboard!=0) {
-        // only one clipboard supported
-        return 0;
-    }
     if (GetClipText(&cd) == 0) {
         SSBuffer->Clear();
         j = 0;
@@ -50,7 +46,7 @@
     return 0;
 }
 
-int PutPMClip(int clipboard) {
+int PutPMClip() {
     char *p = 0;
     int l = 0;
     PELine L;
@@ -58,10 +54,6 @@
     ClipData cd;
     int rc;
 
-    if (clipboard!=0) {
-        // only one clipboard supported
-        return 0;
-    }
     for (int i = 0; i < SSBuffer->RCount; i++) {
         L = SSBuffer->RLine(i);
         p = (char *)realloc(p, l + (Len = L->Count) + 2);
diff -X dontdiff -ur fte-0.49.13.1/src/clip_x11.cpp fte-0.50.0/src/clip_x11.cpp
--- fte-0.49.13.1/src/clip_x11.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/clip_x11.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,16 +9,16 @@
 
 #include "fte.h"
 
-int GetXSelection(int *len, char **data, int clipboard);
-int SetXSelection(int len, char *data, int clipboard);
+int GetXSelection(int *len, char **data);
+int SetXSelection(int len, char *data);
 
-int GetPMClip(int clipboard) {
+int GetPMClip() {
     char *data;
     int len;
     int i,j, l, dx;
     EPoint P;
 
-    if (GetXSelection(&len, &data, clipboard) == 0) {
+    if (GetXSelection(&len, &data) == 0) {
         SSBuffer->Clear();
         j = 0;
         l = 0;
@@ -48,7 +48,7 @@
     return 0;
 }
 
-int PutPMClip(int clipboard) {
+int PutPMClip() {
     PELine L;
     char *p = NULL;
     int rc = 0;
@@ -76,7 +76,7 @@
     if (p != NULL) {
         // remove some 'UNWANTED' characters - sequence XX 0x08 YY -> YY
         // this makes usable cut&paste from manpages
-        rc = (SetXSelection(l, p, clipboard) == 0);
+        rc = (SetXSelection(l, p) == 0);
         free(p);
     }
     return (rc)?1:0;
diff -X dontdiff -ur fte-0.49.13.1/src/c_mode.cpp fte-0.50.0/src/c_mode.cpp
--- fte-0.49.13.1/src/c_mode.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_mode.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -70,9 +70,7 @@
         0,                  // trim on save
         0,                  // save bookmarks
         1,                  // HilitTags
-        0,		    // ShowBookmarks
-        1,                  // MakeBackups
-        1                   // AutoTag
+        0,                  // ShowBookmarks
     },
     {
         0,                  // Routine Regexp
diff -X dontdiff -ur fte-0.49.13.1/src/c_mode.h fte-0.50.0/src/c_mode.h
--- fte-0.49.13.1/src/c_mode.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/c_mode.h	2007-04-15 11:00:00.000000000 +0800
@@ -108,11 +108,8 @@
 #define BFI_SaveBookmarks      46
 #define BFI_HilitTags          47
 #define BFI_ShowBookmarks      48
-#define BFI_MakeBackups        49
-
-#define BFI_AutoTag            50
-#define BFI_COUNT              51
 
+#define BFI_COUNT              49
 
 #define BFS_RoutineRegexp       (0 | 256)
 #define BFS_DefFindOpt          (1 | 256)
@@ -122,7 +119,6 @@
 #define BFS_FileNameRx          (5 | 256)
 #define BFS_FirstLineRx         (6 | 256)
 #define BFS_CompileCommand      (7 | 256)
-#define BFS_CommentPat          (8 | 256)
 
 #define BFS_COUNT               8
 
@@ -277,7 +273,7 @@
     mvChar,
     mvWord,
     mvLine,
-    mvFTEVer
+    mvFTEVer,
 } MacroVariable;
 
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/commands.cpp fte-0.50.0/src/commands.cpp
--- fte-0.49.13.1/src/commands.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/commands.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -13,7 +13,7 @@
     if (M) 
         M->GetPath(Path, MaxLen);
     if (!M || Path[0] == 0)
-        if (ExpandPath(".", Path, MaxLen) == -1)
+        if (ExpandPath(".", Path) == -1)
             return 0;
     SlashDir(Path);
     return 1;
diff -X dontdiff -ur fte-0.49.13.1/src/compkeys.cpp fte-0.50.0/src/compkeys.cpp
--- fte-0.49.13.1/src/compkeys.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/compkeys.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -211,7 +211,7 @@
         { kbCenter, "Center" },
 };
 
-static TKeyCode ftesl_getkeycode(const char* key)
+TKeyCode   ftesl_getkeycode(const char* key)
 {
         TKeyCode        kcode = 0;
 
@@ -274,7 +274,7 @@
         return 0;
 }
 
-static int ftesl_get_ctrlcode(TKeyCode key)
+int ftesl_get_ctrlcode(TKeyCode key)
 {
         TKeyCode        kcode = keyCode(key);
 
diff -X dontdiff -ur fte-0.49.13.1/src/con_dosx.cpp fte-0.50.0/src/con_dosx.cpp
--- fte-0.49.13.1/src/con_dosx.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/con_dosx.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -23,11 +23,10 @@
 #include "console.h"
 #include "c_config.h"
 #include "gui.h"
-#include "s_string.h"
 
 #include <stdlib.h>
 #include <process.h>
-#include "port.h"                // DOS portability calls,
+#include	"port.h"                // DOS portability calls,
 
 #define MAX_PIPES 4
 #define PIPE_BUFLEN 4096
@@ -1119,8 +1118,8 @@
 }
 
 int ConGetTitle(char *Title, int MaxLen, char *STitle, int SMaxLen) {
-	strlcpy(Title, "FTE", MaxLen);
-	strlcpy(STitle, "FTE", SMaxLen);
+	strcpy(Title, "FTE");
+	strcpy(STitle, "FTE");
 	return 0;
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/con_linux.cpp fte-0.50.0/src/con_linux.cpp
--- fte-0.49.13.1/src/con_linux.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/con_linux.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -1190,8 +1190,7 @@
         if (getenv("ISOCONSOLE")) {
             tab=GetGUICharacters ("Linux","++++-|+++++>.*-^v :[>");
         } else {
-            tab=GetGUICharacters ("Linux","++++-|+++++>.*-^v :[>");
-//.            tab=GetGUICharacters ("Linux","Ú¿ÀÙÄ³ÂÃ´ÁÅ\x1AúÄ±°\x1B\x1A");
+            tab=GetGUICharacters ("Linux","Ú¿ÀÙÄ³ÂÃ´ÁÅ\x1AúÄ±°\x1B\x1A");
 //            tab=GetGUICharacters ("Linux","\x0D\x0C\x0E\x0B\x12\x19____+>\x1F\x01\x12 ");
         }
     }
diff -X dontdiff -ur fte-0.49.13.1/src/con_ncurses.cpp fte-0.50.0/src/con_ncurses.cpp
--- fte-0.49.13.1/src/con_ncurses.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/con_ncurses.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -10,7 +10,6 @@
 #include <ncurses.h>
 #include <unistd.h>
 
-#include "feature.h"
 #include "sysdep.h"
 #include "c_config.h"
 #include "console.h"
@@ -152,9 +151,7 @@
 	ESCDELAY = escDelay;
 	initscr();
 	ConInitColors();
-#ifdef CONFIG_MOUSE
 	mousemask(ALL_MOUSE_EVENTS|REPORT_MOUSE_POSITION, NULL);
-#endif
 	/*    cbreak (); */
 	raw();
 	noecho();
@@ -406,7 +403,6 @@
 	return 0;
 }
 
-#ifdef CONFIG_MOUSE
 int ConSetMousePos(int /*X */ , int /*Y */ )
 {
 	return -1;
@@ -489,14 +485,13 @@
 	}
 	return 0;
 }
-#endif
 
 static TEvent Prev =
 {evNone};
 
 static int ConGetEscEvent(TEvent *Event)
 {
-	int ch;
+	char ch;
 	
 	TKeyEvent *KEvent = &(Event->Key);
 
@@ -518,8 +513,8 @@
 	}
 	else if(ch == '[' || ch == 'O')
 	{
-		int ch1 = getch();
-		int ch2 = '\0';
+		char ch1 = getch();
+		char ch2 = '\0';
 		if(ch1 >= '1' &&  ch1 <= '8')
 		{
 			ch2 = getch();
@@ -618,9 +613,7 @@
 	return 1;
 }
 
-#ifdef CONFIG_EXTERNAL_COMMAND
 extern int WaitPipeEvent(TEvent *Event,int WaitTime, int *fds, int nfds);
-#endif
 
 int ConGetEvent(TEventMask /*EventMask */ ,
 		TEvent * Event, int WaitTime, int Delete)
@@ -639,18 +632,7 @@
 
     sfd[0] = STDIN_FILENO;
 
-#ifdef CONFIG_EXTERNAL_COMMAND
-    rtn=WaitPipeEvent(Event,-1, sfd, 1);
-    if(rtn < 0) return rtn;
-    if(rtn == 1) return 0;
-#else
-    {
-       fd_set readfds;
-       FD_ZERO(&readfds);
-       FD_SET(STDIN_FILENO, &readfds);
-       if ((rtn=select(1, &readfds, NULL, NULL, NULL)) < 0) return rtn;
-    }
-#endif
+    if((rtn=WaitPipeEvent(Event,-1, sfd, 1)) != 0) return rtn;
 
 	int ch = wgetch(stdscr);
 	Event->What = evKeyDown;
@@ -698,12 +680,10 @@
 				ResizeWindow(COLS,LINES);
 				Event->What = evNone;
 				break;
-#ifdef CONFIG_MOUSE
 			case KEY_MOUSE:
 				Event->What = evNone;
 				ConGetMouseEvent(Event);
 				break;
-#endif
 			case KEY_SRIGHT:
 				KEvent->Code = kfShift | kbRight;
 				break;
@@ -730,7 +710,7 @@
 				break;
 			case KEY_BACKSPACE:
 				KEvent->Code = kbBackSp;
-                            break;
+				break;
 			case KEY_HOME:
 				KEvent->Code = kbHome;
 				break;
@@ -846,9 +826,7 @@
 	int rc, W, H, W1, H1;
 
 	ConQuerySize(&W, &H);
-#ifdef CONFIG_MOUSE
 	ConHideMouse();
-#endif
 	ConSuspend();
 
 	if (*Command == 0)		// empty string = shell
@@ -857,9 +835,7 @@
 	rc = system(Command);
 
 	ConContinue();
-#ifdef CONFIG_MOUSE
 	ConShowMouse();
-#endif
 	ConQuerySize(&W1, &H1);
 
 	if (W != W1 || H != H1) {
diff -X dontdiff -ur fte-0.49.13.1/src/con_nt.cpp fte-0.50.0/src/con_nt.cpp
--- fte-0.49.13.1/src/con_nt.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/con_nt.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -44,7 +44,6 @@
 #include "console.h"
 #include "gui.h"
 #include "s_files.h"
-#include "s_string.h"
 #include "c_config.h"
 
 #define True    1
@@ -325,7 +324,7 @@
                 case '~': Ch = '~'; break;
                 case '^': Ch = '^'; break;
                 case '`': Ch = '`'; break;
-//.                case 'ï': Ch = 'ï'; break;
+                case 'ï': Ch = 'ï'; break;
                 }
             }
         }
@@ -385,37 +384,6 @@
         E->Mouse.Count = 1;
         if (inp.Event.MouseEvent.dwEventFlags & DOUBLE_CLICK)
             E->Mouse.Count = 2;
-
-        if (inp.Event.MouseEvent.dwEventFlags == MOUSE_WHEELED)
-        {
-            E->What        = evCommand;
-            E->Msg.View    = 0;
-            E->Msg.Model   = 0;
-            E->Msg.Param2  = 0;
-
-            // Scroll:
-            // (The SDK does not tell how to determine whether the wheel
-            // was scrolled up or down. Found an example on:
-            // http://www.adrianxw.dk/SoftwareSite/Consoles/Consoles5.html
-            if (inp.Event.MouseEvent.dwButtonState & 0xFF000000) {  // Wheel down
-                if (flg & kfShift) { // Translate to horizontal scroll.
-                    E->Msg.Command = (flg & kfCtrl) ? cmHScrollPgRt : cmHScrollRight;
-                } else { // Translate to vertical scroll.
-                    E->Msg.Command = (flg & kfCtrl) ? cmVScrollPgDn : cmVScrollDown;
-                }
-            } else { // Wheel up
-                if (flg & kfShift) { // Translate to horizontal scroll.
-                    E->Msg.Command = (flg & kfCtrl) ? cmHScrollPgLt : cmHScrollLeft;
-                } else { // Translate to vertical scroll.
-                    E->Msg.Command = (flg & kfCtrl) ? cmVScrollPgUp : cmVScrollUp;
-                }
-            }
-
-            E->Msg.Param1 = (flg & kfCtrl) ? 1 : 3; // 1 page / 3 lines
-
-            return True;
-        }
-
         if (inp.Event.MouseEvent.dwEventFlags == MOUSE_MOVED)
         {
             E->What = evMouseMove;
@@ -898,9 +866,9 @@
 
 int ConSetTitle(char *Title, char *STitle) { /*FOLD00*/
     char buf[sizeof(winTitle)] = {0};
-    JustFileName(Title, buf, sizeof(buf));
+    JustFileName(Title, buf);
     if (buf[0] == '\0') // if there is no filename, try the directory name.
-        JustLastDirectory(Title, buf, sizeof(buf));
+        JustLastDirectory(Title, buf);
 
     strncpy(winTitle, "FTE - ", sizeof(winTitle) - 1);
     if (buf[0] != 0) // if there is a file/dir name, stick it in here.
@@ -1184,21 +1152,20 @@
         //** It's 4DOS all right..
         args = getenv("SystemRoot");
         if(args== 0) return -1;
-        strlcpy(tbuf, args, sizeof(tbuf));                 // Get to c:\winnt
-        strlcat(tbuf, "\\system32\\cmd.exe", sizeof(tbuf));
+        strcpy(tbuf, args);                 // Get to c:\winnt
+        strcat(tbuf, "\\system32\\cmd.exe");
         comspec = tbuf;
     }
 
-    int argslen = strlen(comspec) + strlen(p_command) + 120;
-    args    = (char *)malloc(argslen);
+    args    = (char *)malloc(strlen(comspec) + strlen(p_command) + 120);
     if(args == 0)
         dbm("malloc() failed for command line..");
     else
     {
         //** Form a command line for the process;
-        strlcpy(args, comspec, argslen);
-        strlcat(args, " /c ", argslen);
-        strlcat(args, p_command, argslen);
+        strcpy(args, comspec);
+        strcat(args, " /c ");
+        strcat(args, p_command);
 
         //** Dup the child handle to get separate handles for stdout and err,
         if (DuplicateHandle(GetCurrentProcess(), p_child_ph, // Source,
@@ -1615,21 +1582,20 @@
         //** It's 4DOS all right..
         args = getenv("SystemRoot");
         if(args== 0) return -1;
-        strlcpy(tbuf, args, sizeof(tbuf));                 // Get to c:\winnt
-        strlcat(tbuf, "\\system32\\cmd.exe", sizeof(tbuf));
+        strcpy(tbuf, args);                 // Get to c:\winnt
+        strcat(tbuf, "\\system32\\cmd.exe");
         comspec = tbuf;
     }
 
-    int argslen = strlen(comspec) + strlen(Command) + 120;
-    args    = (char *)malloc(argslen);
+    args    = (char *)malloc(strlen(comspec) + strlen(Command) + 120);
     if(args == 0)
         dbm("malloc() failed for command line..");
     else
     {
         //** Form a command line for the process;
-        strlcpy(args, comspec, argslen);
-        strlcat(args, " /c ", argslen);
-        strlcat(args, Command, argslen);
+        strcpy(args, comspec);
+        strcat(args, " /c ");
+        strcat(args, Command);
 
         //** Dup the child handle to get separate handles for stdout and err,
         /*if (DuplicateHandle(GetCurrentProcess(), hChildPipe,
diff -X dontdiff -ur fte-0.49.13.1/src/console.h fte-0.50.0/src/console.h
--- fte-0.49.13.1/src/console.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/console.h	2007-04-15 11:00:00.000000000 +0800
@@ -179,14 +179,12 @@
 int ConCursorVisible();
 int ConSetCursorSize(int Start, int End);
 
-#ifdef CONFIG_MOUSE
 int ConSetMousePos(int X, int Y);
 int ConQueryMousePos(int *X, int *Y);
 int ConShowMouse();
 int ConHideMouse();
 int ConMouseVisible();
 int ConQueryMouseButtons(int *ButtonCount);
-#endif
 
 int ConGetEvent(TEventMask EventMask, TEvent *Event, int WaitTime, int Delete);
 int ConPutEvent(TEvent Event);
diff -X dontdiff -ur fte-0.49.13.1/src/con_x11.cpp fte-0.50.0/src/con_x11.cpp
--- fte-0.49.13.1/src/con_x11.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/con_x11.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -50,7 +50,6 @@
 #include "con_i18n.h"
 #include "s_files.h"
 #include "s_util.h"
-#include "s_string.h"
 
 i18n_context_t* i18n_ctx = NULL;
 
@@ -97,16 +96,11 @@
 static unsigned char *ScreenBuffer = NULL;
 static int Refresh = 0;
 
-// res_name can be set with -name switch
-static char res_name[20] = "fte";
-static char res_class[] = "Fte";
-
 static Display *display;
 static Colormap colormap;
 static Atom wm_protocols;
 static Atom wm_delete_window;
 static Atom targets;
-static Atom XA_CLIPBOARD = 0;
 static Window win;
 static Atom selection_buffer;
 static XSizeHints sizeHints;
@@ -127,36 +121,11 @@
 static char winTitle[256] = "FTE";
 static char winSTitle[256] = "FTE";
 
-static unsigned char* CurSelectionData[3] = {NULL,NULL,NULL};
-static int CurSelectionLen[3] = {0,0,0};
-static int CurSelectionOwn[3] = {0,0,0};
+static unsigned char *CurSelectionData = 0;
+static int CurSelectionLen = 0;
+static int CurSelectionOwn = 0;
 static Time now;
 
-static Atom GetXClip (int clipboard) {
-    if (clipboard==1) {
-        return XA_PRIMARY;
-    }
-    if (clipboard==2) {
-        return XA_SECONDARY;
-    }
-    return XA_CLIPBOARD;
-}
-
-
-static int GetFTEClip (Atom clip) {
-    if (clip==XA_CLIPBOARD) {
-        return 0;
-    }
-    if (clip==XA_PRIMARY) {
-        return 1;
-    }
-    if (clip==XA_SECONDARY) {
-        return 2;
-    }
-    return -1;
-}
-
-
 static int AllocBuffer() {
     unsigned char *p;
     unsigned int i;
@@ -384,7 +353,7 @@
 #else
     char *ds;
     if ((ds = getenv("DISPLAY")) == NULL)
-	DieError(1, "$DISPLAY not set? This version of fte must be run under X11.");
+	DieError(1, "$DISPLAY not set?");
     if ((display = XOpenDisplay(ds)) == NULL)
 	DieError(1, "XFTE Fatal: could not open display: %s!", ds);
 #endif
@@ -429,8 +398,6 @@
     assert(selection_buffer != None);
     targets = XInternAtom(display, "TARGETS", False);
     assert(targets != None);
-    XA_CLIPBOARD = XInternAtom(display, "CLIPBOARD", False);
-    assert(XA_CLIPBOARD != None);
 
     sizeHints.flags = PResizeInc | PMinSize | PBaseSize | PWinGravity;
     sizeHints.width_inc = FontCX;
@@ -443,6 +410,8 @@
         sizeHints.flags |= USPosition;
 
     XClassHint classHints;
+    static char res_name[] = "fte";
+    static char res_class[] = "Fte";
     classHints.res_name = res_name;
     classHints.res_class = res_class;
     XSetClassHint(display, win, &classHints);
@@ -494,9 +463,9 @@
 
 int ConSetTitle(char *Title, char *STitle) {
     char buf[sizeof(winTitle)] = {0};
-    JustFileName(Title, buf, sizeof(buf));
+    JustFileName(Title, buf);
     if (buf[0] == '\0') // if there is no filename, try the directory name.
-        JustLastDirectory(Title, buf, sizeof(buf));
+        JustLastDirectory(Title, buf);
 
     strncpy(winTitle, "FTE - ", sizeof(winTitle) - 1);
     if (buf[0] != 0) // if there is a file/dir name, stick it in here.
@@ -513,8 +482,10 @@
 }
 
 int ConGetTitle(char *Title, int MaxLen, char *STitle, int SMaxLen) {
-    strlcpy(Title, winTitle, MaxLen);
-    strlcpy(STitle, winSTitle, SMaxLen);
+    strncpy(Title, winTitle, MaxLen);
+    Title[MaxLen - 1] = 0;
+    strncpy(STitle, winSTitle, SMaxLen);
+    STitle[SMaxLen - 1] = 0;
     return 0;
 }
 
@@ -1026,20 +997,15 @@
             if (type == ButtonPress) {
                 Event->What = evCommand;
                 if (state & ShiftMask) {
-                    Event->Msg.Param1 = 1;
-
                     if (button == Button4)
-                        Event->Msg.Command = cmVScrollUp; // fix core to use count
+                        Event->Msg.Command = cmHScrollPgLt; // fix core to use count
                     else
-                        Event->Msg.Command = cmVScrollDown;
-                }
-                else
-                {
-                    Event->Msg.Param1 = 3;
+                        Event->Msg.Command = cmHScrollPgRt;
+                } else {
                     if (button == Button4)
-                        Event->Msg.Command = cmVScrollUp;
+                        Event->Msg.Command = cmVScrollPgUp;
                     else
-                        Event->Msg.Command = cmVScrollDown;
+                        Event->Msg.Command = cmVScrollPgDn;
                 }
             }
             return ;
@@ -1213,22 +1179,21 @@
         break;
     case SelectionClear:
         {
-            for (int i=0; i<3; i++) {
-                Window owner = XGetSelectionOwner(display, GetXClip(i));
-                if (owner != win) {
-                    if (CurSelectionData[i] != NULL)
-                        free(CurSelectionData[i]);
-                    CurSelectionData[i] = NULL;
-                    CurSelectionLen[i] = 0;
-                    CurSelectionOwn[i] = 0;
-                }
+            Window owner;
+
+            owner = XGetSelectionOwner(display, XA_PRIMARY);
+            if (owner != win) {
+                if (CurSelectionData != 0)
+                    free(CurSelectionData);
+                CurSelectionData = 0;
+                CurSelectionLen = 0;
+                CurSelectionOwn = 0;
             }
         }
         break;
     case SelectionRequest:
         {
             XEvent notify;
-            unsigned int clip = GetFTEClip(event.xselectionrequest.selection);
 
             notify.type = SelectionNotify;
             notify.xselection.requestor = event.xselectionrequest.requestor;
@@ -1236,7 +1201,8 @@
             notify.xselection.target = event.xselectionrequest.target;
             notify.xselection.time = event.xselectionrequest.time;
 
-            if (clip<=2 && event.xselectionrequest.target == XA_STRING)
+            if (event.xselectionrequest.selection == XA_PRIMARY &&
+                event.xselectionrequest.target == XA_STRING)
 	    {
                 static unsigned char empty[] = "";
                 XChangeProperty(display,
@@ -1244,10 +1210,11 @@
                                 event.xselectionrequest.property,
                                 event.xselectionrequest.target,
                                 8, PropModeReplace,
-                                (CurSelectionData[clip] ? CurSelectionData[clip] : empty),
-                                CurSelectionLen[clip]);
+                                (CurSelectionData ? CurSelectionData : empty),
+                                CurSelectionLen);
                 notify.xselection.property = event.xselectionrequest.property;
-            } else if (clip<=2 && event.xselectionrequest.target == targets)
+            } else if (event.xselectionrequest.selection == XA_PRIMARY &&
+                       event.xselectionrequest.target == targets)
             {
                 Atom type = XA_STRING;
 
@@ -1409,17 +1376,16 @@
     return 0;
 }
 
-int GetXSelection(int *len, char **data, int clipboard) {
-    if (CurSelectionOwn[clipboard]) {
-        *data = (char *) malloc(CurSelectionLen[clipboard]);
+int GetXSelection(int *len, char **data) {
+    if (CurSelectionOwn) {
+        *data = (char *) malloc(CurSelectionLen);
         if (*data == 0)
             return -1;
-        memcpy(*data, CurSelectionData[clipboard], CurSelectionLen[clipboard]);
-        *len = CurSelectionLen[clipboard];
+        memcpy(*data, CurSelectionData, CurSelectionLen);
+        *len = CurSelectionLen;
         return 0;
     } else {
-        Atom clip = GetXClip(clipboard);
-        if (XGetSelectionOwner(display, clip) != None) {
+        if (XGetSelectionOwner(display, XA_PRIMARY) != None) {
             XEvent event;
             Atom type;
             long extra;
@@ -1429,7 +1395,8 @@
 
             assert(selection_buffer != None);
 
-            XConvertSelection(display, clip, XA_STRING,
+            XConvertSelection(display,
+                              XA_PRIMARY, XA_STRING,
                               selection_buffer, win, now);
 
             time_started = time(NULL);
@@ -1481,25 +1448,24 @@
         return 0;
 }
 
-int SetXSelection(int len, char *data, int clipboard) {
-    Atom clip = GetXClip(clipboard);
-    if (CurSelectionData[clipboard] != NULL)
-        free(CurSelectionData[clipboard]);
-
-    CurSelectionData[clipboard] = (unsigned char *)malloc(len);
-    if (CurSelectionData[clipboard] == NULL) {
-        CurSelectionLen[clipboard] = 0;
-        return -1;
-    }
-    CurSelectionLen[clipboard] = len;
-    memcpy(CurSelectionData[clipboard], data, CurSelectionLen[clipboard]);
-    if (CurSelectionLen[clipboard] < 64 * 1024) {
+int SetXSelection(int len, char *data) {
+    if (CurSelectionData != 0)
+        free(CurSelectionData);
+
+    CurSelectionData = (unsigned char *)malloc(len);
+    if (CurSelectionData == 0) {
+	CurSelectionLen = 0;
+	return -1;
+    }
+    CurSelectionLen = len;
+    memcpy(CurSelectionData, data, CurSelectionLen);
+    if (CurSelectionLen < 64 * 1024) {
         XStoreBytes(display, data, len);
-        XSetSelectionOwner(display, clip, win, CurrentTime);
-        if (XGetSelectionOwner(display, clip) == win)
-            CurSelectionOwn[clipboard] = 1;
+        XSetSelectionOwner(display, XA_PRIMARY, win, CurrentTime);
+        if (XGetSelectionOwner(display, XA_PRIMARY) == win)
+            CurSelectionOwn = 1;
     } else {
-        XSetSelectionOwner(display, clip, None, CurrentTime);
+        XSetSelectionOwner(display, XA_PRIMARY, None, CurrentTime);
     }
     return 0;
 }
@@ -1530,12 +1496,7 @@
         } else if ((strcmp(argv[c], "-noxmb") == 0)
                    || (strcmp(argv[c], "--noxmb") == 0))
             useXMB = 0;
-        else if (strcmp(argv[c], "-name") == 0) {
-            if (c + 1 < argc) {
-                strncpy (res_name, argv [++c], sizeof (res_name));
-                res_name[sizeof(res_name)-1] = '\0'; // ensure termination
-	    }
-        } else
+        else
             argv[o++] = argv[c];
     }
     argc = o;
@@ -1558,11 +1519,8 @@
     XDestroyWindow(display, win);
     XCloseDisplay(display);
 
-    for (int i=0; i<3; i++) {
-        if (CurSelectionData[i] != NULL) {
-            free(CurSelectionData[i]);
-        }
-    }
+    if (CurSelectionData != 0)
+        free(CurSelectionData);
 
     ::ConDone();
 }
diff -X dontdiff -ur fte-0.49.13.1/src/e_block.cpp fte-0.50.0/src/e_block.cpp
--- fte-0.49.13.1/src/e_block.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_block.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -119,7 +119,7 @@
     return 0;
 }
 
-int EBuffer::BlockCopy(int Append, int clipboard) {
+int EBuffer::BlockCopy(int Append) {
     EPoint B, E;
     int L;
     int SL, OldCount;
@@ -129,9 +129,8 @@
     if (RCount == 0) return 0;
     if (SSBuffer == 0) return 0;
     if (Append) {
-        if (SystemClipboard) {
-            GetPMClip(clipboard);
-        }
+        if (SystemClipboard)
+            GetPMClip();
     } else
         SSBuffer->Clear();
     SSBuffer->BlockMode = BlockMode;
@@ -180,34 +179,32 @@
                 return 0;
         break;
     }
-    if (SystemClipboard) {
-        PutPMClip(clipboard);
-    }
+    if (SystemClipboard)
+        PutPMClip();
     return 1;
 }
 
-int EBuffer::BlockPasteStream(int clipboard) {
+int EBuffer::BlockPasteStream() {
     BlockMode = bmStream;
-    return BlockPaste(clipboard);
+    return BlockPaste();
 }
 
-int EBuffer::BlockPasteLine(int clipboard) {
+int EBuffer::BlockPasteLine() {
     BlockMode = bmLine;
-    return BlockPaste(clipboard);
+    return BlockPaste();
 }
 
-int EBuffer::BlockPasteColumn(int clipboard) {
+int EBuffer::BlockPasteColumn() {
     BlockMode = bmColumn;
-    return BlockPaste(clipboard);
+    return BlockPaste();
 }
 
-int EBuffer::BlockPaste(int clipboard) {
+int EBuffer::BlockPaste() {
     EPoint B, E;
     int L, BL;
 
-    if (SystemClipboard) {
-        GetPMClip(clipboard);
-    }
+    if (SystemClipboard)
+        GetPMClip();
 
     if (SSBuffer == 0) return 0;
     if (SSBuffer->RCount == 0) return 0;
@@ -362,7 +359,7 @@
 }
 
 // remove selected text and paste information from clipboard to replace it
-int EBuffer::BlockPasteOver(int clipboard) {
+int EBuffer::BlockPasteOver() {
     // if there is existing selection, remove it's contents
     if (CheckBlock())
     {
@@ -370,7 +367,7 @@
     }
 
     // paste text from clipboard
-    if (BlockPaste(clipboard))
+    if (BlockPaste())
     {
         // go to end of selection
         SetPos(BE.Col, BE.Row);
@@ -382,13 +379,12 @@
     return 0;
 }
 
-// XXX clipboard ???
-int EBuffer::ClipClear(int clipboard) {
+int EBuffer::ClipClear() {
     if (SSBuffer == 0)
         return 0;
     SSBuffer->Clear();
     if (SystemClipboard)
-        PutPMClip(clipboard);
+        PutPMClip();
     return 1;
 }
 
@@ -605,10 +601,6 @@
 }
 
 int EBuffer::BlockSelectWord() {
-
-    char word[MAXSEARCH+1];
-    int len=0;
-
     int Y = VToR(CP.Row);
     PELine L = RLine(Y);
     int P;
@@ -626,21 +618,6 @@
     if (SetBB(EPoint(Y, ScreenPos(L, P))) == 0) return 0;
     while ((P < L->Count) && (C == ChClassK(L->Chars[P]))) P++;
     if (SetBE(EPoint(Y, ScreenPos(L, P))) == 0) return 0;
-
-    //.{ lechee Trans to Find Pattern and Set LSearch.ok
-    while ((P > 0) && ((ChClass(L->Chars[P-1]) == 1) || (L->Chars[P-1] == '_') || (L->Chars[P-1] == '@') || (L->Chars[P-1] == '-')))
-        P--;
-    while (len < int(sizeof(word)) && P < L->Count && (ChClass(L->Chars[P])==1 || L->Chars[P] =='_' || L->Chars[P] == '@' || L->Chars[P] == '-'))
-        word[len++] = L->Chars[P++];
-    word[len] = 0;
-    if (strlen(word)) {
-      strcpy(SearchPattern,word);
-      strcpy(LSearch.strSearch,word);
-      LSearch.ok = 1;
-      if (ParseSearchOptions(0, "i", LSearch.Options) ==0) return 0;
-    }
-    //.}
-
     return 1;
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/e_buffer.cpp fte-0.50.0/src/e_buffer.cpp
--- fte-0.49.13.1/src/e_buffer.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_buffer.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -10,10 +10,6 @@
 #include "fte.h"
 #include "c_history.h"
 
-#ifndef CONFIG_FOLDS
-int EBuffer::ExposeRow(int Row) {return 0;}
-#endif
-
 EBuffer *SSBuffer = 0; // scrap buffer (clipboard)
 
 ///////////////////////////////////////////////////////////////////////////////
@@ -29,12 +25,10 @@
     FileName = 0;
     LL = 0;
     VV = 0;
-#ifdef CONFIG_FOLDS
     FF = 0;
-    FCount = 0;
-#endif
     RGap = RCount = RAllocated = 0;
     VGap = VCount = VAllocated = 0;
+    FCount = 0;
     Modified = 0;
     BlockMode = bmStream;
     ExtendGrab = 0;
@@ -94,10 +88,8 @@
 #endif
     }
 #endif
-#ifdef CONFIG_BOOKMARKS
     if (FileName && Loaded)
         markIndex.storeForBuffer(this);
-#endif
     
     Clear();
     if (LL)
@@ -171,13 +163,11 @@
 #ifdef CONFIG_UNDOREDO
     FreeUndo();
 #endif
-#ifdef CONFIG_FOLDS
     if (FCount != 0) {
         free(FF);
         FCount = 0;
         FF = 0;
     }
-#endif
     return 0;
 }
 
@@ -396,7 +386,6 @@
     }
 #endif
     
-#ifdef CONFIG_FOLDS
     for (int f = 0; f < FCount; f++) {
         EPoint M;
         
@@ -405,7 +394,6 @@
         UpdateMark(M, Type, Row, Col, Rows, Cols);
         FF[f].line = M.Row;
     }
-#endif
     
 #ifdef CONFIG_BOOKMARKS
     for (int b = 0; b < BMCount; b++)
@@ -603,11 +591,9 @@
     VLine = RToV(Row);
     assert(VLine != -1);
     
-#ifdef CONFIG_FOLDS
     if (FindFold(Row) != -1) {
         if (FoldDestroy(Row) == 0) return 0;
     }
-#endif
     
     VLine = RToV(Row);
     assert(VLine != -1);
@@ -625,9 +611,7 @@
     //puts("Here");
 
     Draw(Row, -1);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     assert(RAllocated >= RCount);
     if (RGap != Row) 
         if (MoveRGap(Row) == 0) return 0;
@@ -695,9 +679,7 @@
     if (DoMark)
         UpdateMarker(umInsert, Row, 0, 1, 0);
     Draw(Row, -1);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     VLine = RToVN(Row);
     assert(RCount <= RAllocated);
 //    printf("++ %d G:C:A :: %d - %d - %d\n", Row, RGap, RCount, RAllocated);
@@ -765,9 +747,7 @@
     L->Count -= ACount;
     if (L->Allocate(L->Count) == 0) return 0;
     Draw(Row, Row);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
 //    printf("OK\n");
     return 1;
 }
@@ -803,9 +783,7 @@
         memmove(L->Chars + Ofs, Buffer, ACount);
     L->Count += ACount;
     Draw(Row, Row);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     // printf("OK\n");
     return 1;
 }
@@ -857,9 +835,7 @@
         if (PushUChar(ucInsChars) == 0) return 0;
     }
 #endif
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     Draw(Row, Row);
     return 1;
 }
@@ -989,9 +965,7 @@
     } else {
         UpdateMarker(umSplitLine, Row, Col, 0, 0);
         if (InsLine(Row, 1, 0) == 0) return 0;
-#ifdef CONFIG_SYNTAX_HILIT
         RLine(Row)->StateE = short((Row > 0) ? RLine(Row - 1)->StateE : 0);
-#endif
         if (Col < LineLen(Row)) {
             int P, L;
             //if (RLine(Row)->ExpandTabs(Col, -2, &Flags) == 0) return 0;
@@ -1006,9 +980,7 @@
         }
     }
     Draw(Row, -1);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     return 1;
 }
 
@@ -1034,8 +1006,6 @@
         UpdateMarker(umJoinLine, Row, Col, 0, 0);
     }
     Draw(Row, -1);
-#ifdef CONFIG_SYNTAX_HILIT
     Hilit(Row);
-#endif
     return 1;
 }
diff -X dontdiff -ur fte-0.49.13.1/src/e_buffer.h fte-0.50.0/src/e_buffer.h
--- fte-0.49.13.1/src/e_buffer.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_buffer.h	2007-04-15 11:00:00.000000000 +0800
@@ -141,9 +141,7 @@
     virtual ~EEditPort();
     
     virtual void HandleEvent(TEvent &Event);
-#ifdef CONFIG_MOUSE
     virtual void HandleMouse(TEvent &Event);
-#endif
     virtual void UpdateView();
     virtual void RepaintView();
     virtual void UpdateStatus();
@@ -442,8 +440,7 @@
     int GetMap(int Row, int *StateLen, hsState **StateMap);
 #endif
     int FindStr(char *Data, int Len, int Options);
-    int FindStr(char *Data, int Len, SearchReplaceOptions &opt);
-    int FindRx(RxNode *Rx, SearchReplaceOptions &opt);
+    int FindRx(RxNode *Rx, int Options);
     int Find(SearchReplaceOptions &opt);
     int IsLineBlank(int Row);
     int TrimLine(int Row);
@@ -511,8 +508,6 @@
     int     ScrollDown(int Lines);
     int     ScrollUp(int Lines);
     int     MoveToLine();
-    int     FileGrepLine();
-    int     FileGrepName();
     int     MoveToColumn();
     int     MoveFirstNonWhite();
     int     MoveLastNonWhite();
@@ -550,7 +545,6 @@
     int     BackSpace();
     int     Delete();
     int     CompleteWord();
-    int     CompleteGrep();
     int     KillBlockOrChar();
     int     KillBlockOrCharPrev();
 
@@ -583,7 +577,6 @@
     int     LineSplit();
     int     LineJoin();
     int     LineNew();
-    int     LineNews();
     int     LineIndent();
     int     LineTrim();
     int     LineCenter();
@@ -623,8 +616,8 @@
     int     BlockEnd();
     int     BlockUnmark();
     int     BlockCut(int Append);
-    int     BlockCopy(int Append, int clipboard=0);
-    int     BlockPaste(int clipboard=0);
+    int     BlockCopy(int Append);
+    int     BlockPaste();
     int     BlockKill();
     int     BlockIndent();
     int     BlockUnindent();
@@ -638,27 +631,25 @@
     int     BlockExtendEnd();
     int     BlockReIndent();
     int     BlockIsMarked();
-    int     BlockPasteStream(int clipboard=0);
-    int     BlockPasteLine(int clipboard=0);
-    int     BlockPasteColumn(int clipboard=0);
-    int     BlockPasteOver(int clipboard=0);
+    int     BlockPasteStream();
+    int     BlockPasteLine();
+    int     BlockPasteColumn();
+    int     BlockPasteOver();
     int     BlockSelectWord();
     int     BlockSelectLine();
     int     BlockSelectPara();
     int     BlockPrint();
     int     BlockSort(int Reverse);
-    int     ClipClear(int clipboard=0);
+    int     ClipClear();
     int     BlockUnTab();
     int     BlockEnTab();
 
     int     ToggleAutoIndent();
-    int     ToggleAutoTag();
     int     ToggleInsert();
     int     ToggleExpandTabs();
     int     ToggleShowTabs();
     int     ToggleUndo();
     int     ToggleReadOnly();
-    int     ChangeToReadOnly();
     int     ToggleKeepBackups();
     int     ToggleMatchCase();
     int     ToggleBackSpKillTab();
@@ -669,9 +660,9 @@
     int     ToggleWordWrap();
     int     ToggleTrim();
     int     ToggleShowMarkers();
-    int     ToggleHilitTags();
-    int     ToggleShowBookmarks();
-    int     ToggleMakeBackups();
+    int     ToggleHilitTags ();
+    int     ToggleShowBookmarks ();
+
     int     SetLeftMargin();
     int     SetRightMargin();
     
@@ -756,7 +747,6 @@
     int FindRepeatOnce(ExState &State);
     int FindRepeatReverse(ExState &State);
     int InsertChar(ExState &State);
-    int InsertAdupChar(ExState &State);
     int TypeChar(ExState &State);
     int ChangeMode(ExState &State);
     int ChangeKeys(ExState &State);
@@ -781,8 +771,6 @@
     int IndentFunction();
     int MoveFunctionPrev();
     int MoveFunctionNext();
-    int BlockComment(ExState& state);
-    int BlockUnComment(ExState& state);   
     int InsertDate(ExState& state);
     int InsertUid();
 
@@ -807,8 +795,4 @@
 
 EBuffer *FindFile(char *FileName);
 
-int ParseSearchOption(int replace, char c, unsigned long &opt);
-int ParseSearchOptions(int replace, const char *str, unsigned long &Options);
-int ParseSearchReplace(EBuffer *B, const char *str, int replace, SearchReplaceOptions &opt);
-
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_cmds.cpp fte-0.50.0/src/e_cmds.cpp
--- fte-0.49.13.1/src/e_cmds.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_cmds.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -309,7 +309,6 @@
     return 1;
 }
 
-#ifdef CONFIG_INDENT
 int EBuffer::MovePrevEqualIndent() {
     int L = VToR(CP.Row);
     int I = LineIndented(L);
@@ -329,7 +328,6 @@
             return SetPosR(I, L);
     return 0;
 }
-#endif
 
 int EBuffer::MoveNextTab() {
     int P = CP.Col;
@@ -631,7 +629,7 @@
 
 int EBuffer::BackSpace() {
     int Y = VToR(CP.Row);
-
+    
     if (CheckBlock() == 1 && BFI(this, BFI_BackSpKillBlock)) {
         if (BlockKill() == 0)
             return 0;
@@ -752,10 +750,8 @@
         
         //int Indent = LineIndented(VToR(CP.Row));
         
-#ifdef CONFIG_INDENT
         if (!LineIndent())
             return 0;
-#endif
         
         //if (Indent > 0)
         //  if (InsText(Row, C, Indent, 0) == 0)
@@ -768,30 +764,7 @@
     return 1;
 }
 
-int EBuffer::LineNews() {  // lechee
-    char cmdStr[512];
-    char *dot;
-    int noDot=1;
-    GetStrVar(mvFileName, cmdStr,512);
-//    strcpy(cmdStr,FileName);
-    if ( (dot = strstr(cmdStr, ".")) !=0 ) noDot=0;
-    strcpy(cmdStr,FileName);
-    if (noDot) {
-        LineNew();
-        return 0;
-    }
-    if (BFI(this, BFI_ReadOnly)&&(!noDot)) {
-
-        GetStrVar(mvFileExtension, cmdStr,512);
-        if (!strcmp(cmdStr,".grp")) return 1;
-        return 0;
-    } else {
-        return LineNew();
-    }
-}
-
 int EBuffer::LineIndent() {
-#ifdef CONFIG_INDENT
     int rc = 1;
 
     if (BFI(this, BFI_AutoIndent)) {
@@ -814,9 +787,6 @@
     if (BFI(this, BFI_Trim))
         if (TrimLine(VToR(CP.Row)) == 0) return 0;
     return 1;
-#else
-return 0;
-#endif
 }
 
 int EBuffer::LineLen() {
@@ -1012,7 +982,6 @@
 }
 
 int EBuffer::IndentLine(int Row, int Indent) {
-#ifdef CONFIG_INDENT
     int I, C;
     int Ind = Indent;
     
@@ -1039,9 +1008,6 @@
         }
     }
     return Ind - I;
-#else
-return 0;
-#endif
 }
 
 #ifdef CONFIG_UNDOREDO
@@ -1307,15 +1273,11 @@
 
 
 int EBuffer::ToggleAutoIndent() { TOGGLE(AutoIndent); }
-int EBuffer::ToggleAutoTag() { TOGGLE(AutoTag); }
 int EBuffer::ToggleInsert() { TOGGLE(Insert); }
 int EBuffer::ToggleExpandTabs() { TOGGLE_R(ExpandTabs); }
 int EBuffer::ToggleShowTabs() { TOGGLE_R(ShowTabs); }
-#ifdef CONFIG_UNDOREDO
 int EBuffer::ToggleUndo() { FreeUndo(); TOGGLE(Undo); }
-#endif
 int EBuffer::ToggleReadOnly() { TOGGLE(ReadOnly); }
-int EBuffer::ChangeToReadOnly() { Flags.num[BFI_ReadOnly]=1; return 1;}
 int EBuffer::ToggleKeepBackups() { TOGGLE(KeepBackups); }
 int EBuffer::ToggleMatchCase() { TOGGLE(MatchCase); }
 int EBuffer::ToggleBackSpKillTab() { TOGGLE(BackSpKillTab); }
@@ -1327,7 +1289,6 @@
 int EBuffer::ToggleShowMarkers() { TOGGLE_R(ShowMarkers); }
 int EBuffer::ToggleHilitTags() { TOGGLE_R(HilitTags); }
 int EBuffer::ToggleShowBookmarks() { TOGGLE_R(ShowBookmarks); }
-int EBuffer::ToggleMakeBackups() { TOGGLE(MakeBackups); }
 
 int EBuffer::ToggleWordWrap() { 
     BFI(this, BFI_WordWrap) = (BFI(this, BFI_WordWrap) + 1) % 3;
@@ -1354,11 +1315,9 @@
     if (FindMode(AMode) != 0) {
         Mode = FindMode(AMode);
         Flags = Mode->Flags;
-#ifdef CONFIG_SYNTAX_HILIT
         HilitProc = 0;
         if (Mode && Mode->fColorize)
             HilitProc = GetHilitProc(Mode->fColorize->SyntaxParser);
-#endif
         FullRedraw();
         return 1;
     }
@@ -1369,11 +1328,9 @@
 int EBuffer::ChangeKeys(char *AMode) {
     if (FindMode(AMode) != 0) {
         Mode = FindMode(AMode);
-#ifdef CONFIG_SYNTAX_HILIT
         HilitProc = 0;
         if (Mode && Mode->fColorize)
             HilitProc = GetHilitProc(Mode->fColorize->SyntaxParser);
-#endif
         FullRedraw();
         return 1;
     }
@@ -1386,11 +1343,9 @@
         EMode *XMode;
         XMode = FindMode(AMode);
         Flags = XMode->Flags;
-#ifdef CONFIG_SYNTAX_HILIT
         HilitProc = 0;
         if (Mode && Mode->fColorize)
             HilitProc = GetHilitProc(Mode->fColorize->SyntaxParser);
-#endif
         FullRedraw();
         return 1;
     }
diff -X dontdiff -ur fte-0.49.13.1/src/e_file.cpp fte-0.50.0/src/e_file.cpp
--- fte-0.49.13.1/src/e_file.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_file.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -46,7 +46,7 @@
 
     assert(View != 0);
     
-    if (ExpandPath(FileName, Name, sizeof(Name)) == -1) {
+    if (ExpandPath(FileName, Name) == -1) {
         View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Invalid path: %s.", FileName);
         return 0;
     }
@@ -75,10 +75,10 @@
 
     assert(View != 0);
 
-    JustDirectory(FileName, fX, sizeof (fX));
+    JustDirectory(FileName, fX);
     if (fX[0] == 0) strcpy(fX, ".");
-    JustFileName(FileName, FName, sizeof(FName));
-    if (ExpandPath(fX, FPath, sizeof(FPath)) == -1) return 0;
+    JustFileName(FileName, FName);
+    if (ExpandPath(fX, FPath) == -1) return 0;
     Slash(FPath, 1);
 
     ff = new FileFind(FPath, FName, ffHIDDEN | ffFULLPATH);
diff -X dontdiff -ur fte-0.49.13.1/src/e_fold.cpp fte-0.50.0/src/e_fold.cpp
--- fte-0.49.13.1/src/e_fold.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_fold.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,8 +9,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_FOLDS
-
 int EBuffer::FindFold(int Line) { // optimize /*FOLD00*/
     int f = FindNearFold(Line);
     if (f != -1)
@@ -531,4 +529,3 @@
     if (SetPosR(CP.Col, FF[f].line, tmLeft) == 0) return 0;
     return 1;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/egui.cpp fte-0.50.0/src/egui.cpp
--- fte-0.49.13.1/src/egui.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/egui.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -106,10 +106,8 @@
     case ExWinNext:                 return WinNext(view);
     case ExWinPrev:                 return WinPrev(view);
     case ExShowEntryScreen:         return ShowEntryScreen();
-#ifdef CONFIG_EXTERNAL_COMMAND
     case ExRunProgram:              return RunProgram(State, view);
     case ExRunProgramAsync:         return RunProgramAsync(State, view);
-#endif
     case ExMainMenu:                return MainMenu(State, view);
     case ExShowMenu:                return ShowMenu(State, view);
     case ExLocalMenu:               return LocalMenu(view);
@@ -121,13 +119,11 @@
     case ExWinClose:                return WinClose(view);
     case ExWinZoom:                 return WinZoom(view);
     case ExWinResize:               return WinResize(State, view);
-#ifdef CONFIG_DESKTOP
     case ExDesktopSaveAs:           return DesktopSaveAs(State, view);
     case ExDesktopSave:
         if (DesktopFileName[0] != 0)
             return SaveDesktop(DesktopFileName);
         return 0;
-#endif
     case ExChangeKeys:
         {
             char kmaps[64] = "";
@@ -214,7 +210,7 @@
         SetMsg(0);
     } else {
         if (ks != 0) {
-            GetKeyName(key, sizeof(key), *ks);
+            GetKeyName(key, *ks);
             SetMsg(key);
         }
     }
@@ -540,7 +536,6 @@
     return gui->ShowEntryScreen();
 }
 
-#ifdef CONFIG_EXTERNAL_COMMAND
 int EGUI::RunProgram(ExState &State, GxView *view) {
     static char Cmd[512] = "";
 
@@ -564,7 +559,6 @@
     gui->RunProgram(RUN_ASYNC, Cmd);
     return 1;
 }
-#endif
 
 int EGUI::MainMenu(ExState &State, GxView *View) {
     char s[3];
@@ -598,7 +592,6 @@
     return 0;
 }
 
-#ifdef CONFIG_DESKTOP
 int EGUI::DesktopSaveAs(ExState &State, GxView *view) {
     if (State.GetStrParam(0, DesktopFileName, sizeof(DesktopFileName)) == 0)
         if (view->GetFile("Save Desktop", sizeof(DesktopFileName), DesktopFileName, HIST_PATH, GF_SAVEAS) == 0)
@@ -608,7 +601,6 @@
         return SaveDesktop(DesktopFileName);
     return 0;
 }
-#endif
 
 int EGUI::FrameNew() {
     GxView *view;
@@ -682,14 +674,14 @@
         //** 0: try curdir then "homedir"..
         //         fprintf(stderr, "ld: Mode 0\n");
         if (FileExists(DESKTOP_NAME))
-            ExpandPath(DESKTOP_NAME, DesktopFileName, sizeof(DesktopFileName));
+            ExpandPath(DESKTOP_NAME, DesktopFileName);
         else {
             //** Use homedir,
 #ifdef UNIX
-            ExpandPath("~/" DESKTOP_NAME, DesktopFileName, sizeof(DesktopFileName));
+            ExpandPath("~/" DESKTOP_NAME, DesktopFileName);
 #else
-            JustDirectory(argv[0], DesktopFileName, sizeof(DesktopFileName));
-            strlcat(DesktopFileName, DESKTOP_NAME, sizeof(DesktopFileName));
+            JustDirectory(argv[0], DesktopFileName);
+            strcat(DesktopFileName, DESKTOP_NAME);
 #endif
         }
         return FileExists(DesktopFileName);
@@ -697,14 +689,14 @@
     case 1:
     case 2:
         //** Try curdir, then it's owner(s)..
-        ExpandPath(".", DesktopFileName, sizeof(DesktopFileName));
+        ExpandPath(".", DesktopFileName);
         //fprintf(stderr, "ld: Mode 1 (start at %s)\n", DesktopFileName);
 
         for (;;) {
             //** Try current location,
             char *pe = DesktopFileName + strlen(DesktopFileName);
             Slash(DesktopFileName, 1);      // Add appropriate slash
-            strlcat(DesktopFileName, DESKTOP_NAME, sizeof(DesktopFileName));
+            strcat(DesktopFileName, DESKTOP_NAME);
 
             //fprintf(stderr, "ld: Mode 1 (trying %s)\n", DesktopFileName);
             if (FileExists(DesktopFileName)) {
@@ -720,9 +712,9 @@
 
             if (p == NULL) {
                 //** No desktop! Set default name in current directory,
-                ExpandPath(".", DesktopFileName, sizeof(DesktopFileName));
+                ExpandPath(".", DesktopFileName);
                 Slash(DesktopFileName, 1);
-                strlcat(DesktopFileName, DESKTOP_NAME, sizeof(DesktopFileName));
+                strcat(DesktopFileName, DESKTOP_NAME);
 
                 SaveDesktopOnExit = 0;      // Don't save,
                 return 0;                   // NOT found!!
@@ -739,7 +731,7 @@
     if (DesktopFileName[0] != 0) {
         if (IsDirectory(DesktopFileName)) {
             Slash(DesktopFileName, 1);
-            strlcat(DesktopFileName, DESKTOP_NAME, sizeof(DesktopFileName));
+            strcat(DesktopFileName, DESKTOP_NAME);
         }
 
         if (LoadDesktopOnEntry && FileExists(DesktopFileName))
@@ -765,20 +757,20 @@
 void EGUI::DoLoadHistoryOnEntry(int &/*argc*/, char **argv) {
     if (HistoryFileName[0] == 0) {
 #ifdef UNIX
-        ExpandPath("~/.fte-history", HistoryFileName, sizeof(HistoryFileName));
+        ExpandPath("~/.fte-history", HistoryFileName);
 #else
-        JustDirectory(argv[0], HistoryFileName, sizeof(HistoryFileName));
-        strlcat(HistoryFileName, "fte.his", sizeof(HistoryFileName));
+        JustDirectory(argv[0], HistoryFileName);
+        strcat(HistoryFileName, "fte.his");
 #endif
     } else {
         char p[256];
 
-        ExpandPath(HistoryFileName, p, sizeof(p));
+        ExpandPath(HistoryFileName, p);
         if (IsDirectory(p)) {
             Slash(p, 1);
-            strlcat(p, HISTORY_NAME, sizeof(p));
+            strcat(p, HISTORY_NAME);
         }
-        strlcpy(HistoryFileName, p, sizeof(HistoryFileName));
+        strcpy(HistoryFileName, p);
     }
 
     if (KeepHistory && FileExists(HistoryFileName))
@@ -838,12 +830,10 @@
                     ModeOverride = 1;
                     strcpy(Mode, argv[Arg] + 2);
                 }
-#ifdef CONFIG_TAGS
             } else if (argv[Arg][1] == 'T') {
                 TagsAdd(argv[Arg] + 2);
             } else if (argv[Arg][1] == 't') {
                 TagGoto(ActiveView, argv[Arg] + 2);
-#endif
             } else {
                 DieError(2, "Invalid command line option %s", argv[Arg]);
                 return 0;
@@ -852,14 +842,9 @@
             char Path[MAXPATH];
 
             QuoteNext = 0;
-            if (ExpandPath(argv[Arg], Path, sizeof(Path)) == 0 && IsDirectory(Path)) {
-#ifdef CONFIG_OBJ_DIRECTORY
+            if (ExpandPath(argv[Arg], Path) == 0 && IsDirectory(Path)) {
                 EModel *m = new EDirectory(cfAppend, &ActiveModel, Path);
                 assert(ActiveModel != 0 && m != 0);
-#else
-	 ConDone();
-        DieError(0, "directory loading disabled.");
-#endif
             } else {
                 if (LCount != 0)
                     suspendLoads = 1;
@@ -878,12 +863,10 @@
                         GotoLine = 0;
                         ((EBuffer *)ActiveModel)->SetNearPosR(ColNum - 1, LineNum - 1);
                     } else {
-#ifdef CONFIG_HISTORY
                         int r, c;
 
                         if (RetrieveFPos(((EBuffer *)ActiveModel)->FileName, r, c) == 1)
                             ((EBuffer *)ActiveModel)->SetNearPosR(c, r);
-#endif
                     }
                     //ActiveView->SelectModel(ActiveModel);
                 }
@@ -898,12 +881,6 @@
             LCount++;
         }
     }
-    if(!LCount)
-    {
-	FileLoad(0, "", 0, ActiveView);
-	LCount++;
-    }
-
     EModel *P = ActiveModel;
     while (LCount-- > 0)
         P = P->Prev;
@@ -946,6 +923,7 @@
         assert(ActiveModel != 0 && m != 0);
         ActiveView->SwitchToModel(ActiveModel);
 #else
+        Usage();
         return 1;
 #endif
     }
@@ -1023,7 +1001,6 @@
         Macros = NULL;
     }
 
-#ifdef CONFIG_SYNTAX_HILIT
     // free colorizers
     {
         EColorize *p;
@@ -1033,7 +1010,6 @@
             delete p;
         }
     }
-#endif
 
     // free event maps
     {
@@ -1089,9 +1065,7 @@
 
     // free CRegexp array from o_messages.cpp
     {
-#ifdef CONFIG_OBJ_MESSAGES
         FreeCRegexp();
-#endif
     }
 
 #ifdef CONFIG_OBJ_CVS
diff -X dontdiff -ur fte-0.49.13.1/src/e_loadsave.cpp fte-0.50.0/src/e_loadsave.cpp
--- fte-0.49.13.1/src/e_loadsave.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_loadsave.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -29,16 +29,6 @@
     }
     if (BFI(this, BFI_TrimOnSave))
         FileTrim();
-
-    if(FileName == NULL || FileName[0] == '\0') {
-        char Name[MAXPATH];
-        int r;
-        Name[0] = '\0';
-	r = View->MView->Win->GetFile("Save As", sizeof(Name), Name, HIST_PATH, GF_SAVEAS);
-	if(FileName) free(FileName);
-        FileName = strdup(Name);
-        if(!r) return r;
-    }
     return SaveTo(FileName);
 }
 
@@ -237,22 +227,6 @@
         if (BFS(this, BFS_CommentEnd) == 0) len_end = 0;
         else len_end = strlen(BFS(this, BFS_CommentEnd));
 
-        // How folds and bookmarks are saved in line comment:
-        //
-        // CommentStart((FOLD)|(fold)nn)?(BOOK(bookmark)+xllllb)?CommentEnd
-        //
-        // After comment start there can be a fold - open or closed - with level number (nn - decimal).
-        // Then bookmarks can follow marked by BOOK "keyword". Last bookmark is terminated by 'x'
-        // character followed by total length of bookmark info (llll - hex) and character 'b'. The
-        // total length is needed when looking for comment start from the line end.
-        // Each bookmark has format "ccccllname" - cccc (hex) is bookmark column, ll (hex) is length
-        // of bookmark name and then the name itself follows.
-        //
-        // Example: FOLD01BOOK000a05mark1001005mark2x001ab
-        //
-        // Open first level fold, bookmark "mark1" at column 10 and bookmark "mark2" at column 16.
-        // At the end is length of string from BOOK up to end of mark2 - 26 (0x1a).
-
 	for (l = RCount - 1; l >= 0; l--) {
 	    if (LL[l]->Count >= len_start + len_end + 6) {
                 for (int where = 1; where < 3; where++) {
@@ -267,8 +241,7 @@
                         pos = LL[l]->Count - len_end;
                         // Check if line ends with end comment (if defined)
                         if (len_end != 0 && memcmp(LL[l]->Chars + pos, BFS(this, BFS_CommentEnd), len_end) != 0) continue;
-                        // Locate position of comment start - skip bookmarks and fold
-                        if (BFI(this, BFI_SaveBookmarks) == 2 && pos - 10 >= 0 && LL[l]->Chars[pos-1] == 'b') {
+                        if (BFI(this, BFI_SaveBookmarks) == 2 && pos - 10 >= 0 && LL[l]->Chars[pos-1] == 'b') { // Bookmarks can be at end
                             char numbuf[5];
                             int i;
 
@@ -284,8 +257,6 @@
                     }
                     // Check comment start
                     if (pos < 0 || (len_start != 0 && memcmp(LL[l]->Chars + pos, BFS(this, BFS_CommentStart), len_start) != 0)) continue;
-                    // Check comment length - leave empty in file
-                    if (LL[l]->Count - pos == len_start + len_end) continue;
                     startpos = pos;
                     pos += len_start;
                     // We have starting position after comment start
@@ -325,7 +296,6 @@
                         int i, col, startBook;
                         char numbuf[5], buf[256];
 
-                        if (memcmp(LL[l]->Chars + pos, "BOOK", 4) != 0) continue;
                         startBook = pos; pos += 4;
                         while (pos + len_end + 6 + 6 <= LL[l]->Count) {
                             // Read column
@@ -344,15 +314,14 @@
                                 error = 1; break;
                             }
                             if (i) {
-                                memcpy(buf, LL[l]->Chars + pos, i); buf[i] = 0;
+                                memcpy(buf, LL[l]->Chars + pos, i);
                                 pos += i;
-#ifdef CONFIG_BOOKMARKS
                                 if (PlaceUserBookmark(buf, EPoint(l, col)) == 0) goto fail;
-#endif
                             }
                             if (LL[l]->Chars[pos] == 'x') {
                                 // Read total length (just test for correctness)
-                                memcpy(numbuf, LL[l]->Chars + pos + 1, 4); numbuf[4] = 0;
+                                memcpy(numbuf, LL[l]->Chars + pos + 1, 4);
+                                numbuf[4] = 0;
                                 if (1 != sscanf(numbuf, "%x", &i)) {
                                     error = 1; break;
                                 }
@@ -372,7 +341,6 @@
                     if (where == 2 && LL[l]->Count != pos + len_end) continue;
                     pos += len_end;
 
-#ifdef CONFIG_FOLDS
                     // Create fold if whole comment was successfully parsed
                     if (open != -1) {
                         int f;
@@ -384,7 +352,6 @@
                         if (open == 0)
                             if (FoldClose(l) == 0) goto fail;
                     }
-#endif
                     // Now remove parsed comment from line
                     memmove(LL[l]->Chars + startpos,
                             LL[l]->Chars + pos,
@@ -435,11 +402,13 @@
     PELine L;
     unsigned long ByteCount = 0, OldCount = 0;
 
+    int f;
+    char fold[64];
+    unsigned int foldlen = 0;
+
     int bindex;
     unsigned int blen = 0;
-#ifdef CONFIG_BOOKMARKS
     char *bname, book[1024] = "BOOK";
-#endif
     EPoint bpos;
 
     unsigned int len_start = 0, len_end = 0;
@@ -465,18 +434,11 @@
     }
 
     if (RCount <= 0) return 0;
-
-#ifdef CONFIG_BACKUP
-    // make only backups when user have requested a one
-    if (BFI(this, BFI_MakeBackups) != 0) {
-        Msg(S_INFO, "Backing up %s...", AFileName);
-        if (MakeBackup(AFileName, (char *)ABackupName) == 0) {
-            View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Could not create backup file.");
-            return 0;
-        }
+    Msg(S_INFO, "Backing up %s...", AFileName);
+    if (MakeBackup(AFileName, (char *)ABackupName) == 0) {
+        View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Could not create backup file.");
+        return 0;
     }
-#endif
-
     Msg(S_INFO, "Writing %s...", AFileName);
 
     fp = 0;
@@ -501,11 +463,7 @@
     if (BFS(this, BFS_CommentEnd)) len_end = strlen(BFS(this, BFS_CommentEnd));
 
     for (l = 0; l < RCount; l++) {
-#ifdef CONFIG_FOLDS
-        int f;
-        char fold[64];
-        unsigned int foldlen = 0;
-
+        L = RLine(l);
         f = FindFold(l);
 
         foldlen = 0;
@@ -515,8 +473,6 @@
                               FF[f].open ? "FOLD%02d" : "fold%02d",
                               FF[f].level);
         }
-#endif
-        L = RLine(l);
 
         bindex = 0; blen = 0;
 #ifdef CONFIG_BOOKMARKS
@@ -535,10 +491,7 @@
 
         // what - write at 1 = beginning / 2 = end of line
         for (int what = 1; what < 3; what++) {
-            if (
-#ifdef CONFIG_FOLDS
-(BFI(this, BFI_SaveFolds) == what && foldlen) ||
-#endif
+            if ((BFI(this, BFI_SaveFolds) == what && foldlen) ||
                 (BFI(this, BFI_SaveBookmarks) == what && blen)
                ) {
 
@@ -546,12 +499,10 @@
                     if (fwrite(BFS(this, BFS_CommentStart), 1, len_start, fp) != len_start) goto fail;
                     ByteCount += len_start;
                 }
-#ifdef CONFIG_FOLDS
                 if (BFI(this, BFI_SaveFolds) == what && foldlen) {
                     if (fwrite(fold, 1, foldlen, fp) != foldlen) goto fail;
                     ByteCount += foldlen;
                 }
-#endif
 #ifdef CONFIG_BOOKMARKS
                 if (BFI(this, BFI_SaveBookmarks) == what && blen) {
                     if (fwrite(book, 1, blen, fp) != blen) goto fail;
@@ -595,17 +546,13 @@
         goto fail;
     }
     Msg(S_INFO, "Wrote %s.", AFileName);
-
-    // make only backups when user have requested a one
-    if (BFI(this, BFI_MakeBackups) != 0) {
-        if (BFI(this, BFI_KeepBackups) == 0
+    if (BFI(this, BFI_KeepBackups) == 0
 #ifdef CONFIG_OBJ_CVS
-            // No backups for CVS logs
-            || this == CvsLogView
+        // No backups for CVS logs
+        || this == CvsLogView
 #endif
-           ) {
-            unlink(ABackupName);
-        }
+       ) {
+        unlink(ABackupName);
     }
     return 1;
 fail:
diff -X dontdiff -ur fte-0.49.13.1/src/e_mark.cpp fte-0.50.0/src/e_mark.cpp
--- fte-0.49.13.1/src/e_mark.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_mark.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -1,5 +1,4 @@
 #include "fte.h"
-#ifdef CONFIG_OBJ_BUFFERS
 
 EMarkIndex markIndex;
 
@@ -36,12 +35,10 @@
     if (Point.Row < 0)
         Point.Row = 0;
 
-#ifdef CONFIG_BOOKMARKS
     if (aBuffer->PlaceBookmark(Name, Point) == 1) {
         Buffer = aBuffer;
         return 1;
     }
-#endif
     return 0;
 }
 
@@ -51,23 +48,19 @@
         return 0;
     assert(filecmp(aBuffer->FileName, FileName) == 0);
 
-#ifdef CONFIG_BOOKMARKS
     if (Buffer->GetBookmark(Name, Point) == 0)
         return 0;
     if (Buffer->RemoveBookmark(Name) == 0)
         return 0;
-#endif
     
     Buffer = 0;
     return 1;
 }
 
 EPoint &EMark::getPoint() {
-#ifdef CONFIG_BOOKMARKS
     if (Buffer) {
         assert(Buffer->GetBookmark(Name, Point) != 0);
     }
-#endif
     return Point;
 }
 
@@ -187,9 +180,7 @@
             b = (EBuffer *)ActiveModel;
         }
         aView->SwitchToModel(b);
-#ifdef CONFIG_BOOKMARKS
         return b->GotoBookmark(m->getName());
-#endif
     }
     return 0;
 }
@@ -265,4 +256,3 @@
     assert(remove(name) == 1);
     return 1;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_print.cpp fte-0.50.0/src/e_print.cpp
--- fte-0.49.13.1/src/e_print.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_print.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -8,7 +8,6 @@
  */
 
 #include "fte.h"
-#ifdef CONFIG_PRINT
 
 int EBuffer::BlockPrint() {
     static char cr = 13;
@@ -193,4 +192,3 @@
     Msg(S_ERROR, "Error printing %s to %s.", FileName, PrintDevice);
     return 0;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_redraw.cpp fte-0.50.0/src/e_redraw.cpp
--- fte-0.49.13.1/src/e_redraw.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_redraw.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,7 +9,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_SYNTAX_HILIT
 int EBuffer::GetMap(int Row, int *StateLen, hsState **StateMap) {
     hlState State = 0;
 
@@ -24,9 +23,11 @@
         *StateMap = (hsState *) malloc(*StateLen);
         if (*StateMap == 0) return 0;
 
+#ifdef CONFIG_SYNTAX_HILIT
         if (BFI(this, BFI_HilitOn) == 1 && HilitProc != 0)
             HilitProc(this, Row, 0, 0, *StateLen, L, State, *StateMap, &ECol);
         else
+#endif
             Hilit_Plain(this, Row, 0, 0, *StateLen, L, State, *StateMap, &ECol);
         //        if (L->StateE != State) {
         //            L->StateE = State;
@@ -39,7 +40,6 @@
     }
     return 1;
 }
-#endif
 
 void EBuffer::FullRedraw() { // redraw all views
     EView *V = View;
@@ -63,7 +63,6 @@
     }
 }
 
-#ifdef CONFIG_SYNTAX_HILIT
 void EBuffer::Hilit(int FromRow) {
     if (FromRow != -1) {
         if (StartHilit == -1)
@@ -120,7 +119,6 @@
         StartHilit++;
     }
 }
-#endif
 
 void EBuffer::Draw(int Row0, int RowE) {
     //    printf("r0 = %d, re = %d\n", Row0, RowE);
@@ -153,28 +151,22 @@
         PELine L = RLine(Row);
         int ECol = 0;
 
-#ifdef CONFIG_SYNTAX_HILIT
         if (Row > 0) State = RLine(Row - 1)->StateE;
-        else
-#endif
-	    State = 0;
+        else State = 0;
 #ifdef CONFIG_SYNTAX_HILIT
         if (BFI(this, BFI_HilitOn) == 1 && HilitProc != 0)
             HilitProc(this, Row, B, C, W, L, State, 0, &ECol);
         else
 #endif
             Hilit_Plain(this, Row, B, C, W, L, State, 0, &ECol);
-#ifdef CONFIG_SYNTAX_HILIT
         if (L->StateE != State) {
             HilitX = 1;
             L->StateE = State;
         }
-#endif
         if (BFI(this, BFI_ShowMarkers)) {
             MoveChar(B, ECol - C, W, ConGetDrawChar((Row == RCount - 1) ? DCH_EOF : DCH_EOL), hcPlain_Markers, 1);
             ECol += 1;
         }
-#ifdef CONFIG_FOLDS
         if (Row < RCount) {
             int f;
             int Folded = 0;
@@ -203,7 +195,6 @@
                 }
             }
         }
-#endif
         if (BB.Row != -1 && BE.Row != -1 && Row >= BB.Row && Row <= BE.Row) {
             switch(BlockMode) {
             case bmLine:
@@ -439,7 +430,7 @@
                     else strcpy(CCharStr, "   EOF");
                 }
 
-                sprintf(s, "%04d:%02d %c%c%c%c%c%c %.6s %c"
+                sprintf(s, "%04d:%02d %c%c%c%c%c %.6s %c"
 #ifdef DOS
                         " %lu "
 #endif
@@ -450,7 +441,6 @@
                         //                    CurPos + 1,
                         (BFI(this, BFI_Insert)) ? 'I' : ' ',
                         (BFI(this, BFI_AutoIndent)) ? 'A' : ' ',
-                        (BFI(this, BFI_AutoTag)) ? 'T' : ' ',
                         //                    (BFI(this, BFI_ExpandTabs))?'T':' ',
                         (BFI(this, BFI_MatchCase)) ? 'C' : ' ',
                         AutoExtend ?
@@ -465,8 +455,8 @@
                         (BFI(this, BFI_WordWrap) == 3) ? 't' :
                         (BFI(this, BFI_WordWrap) == 2) ? 'W' :
                         (BFI(this, BFI_WordWrap) == 1) ? 'w' :
-#endif
                         ' ',
+#endif
                         //                    (BFI(this, BFI_Undo))?'U':' ',
                         //                    (BFI(this, BFI_Trim))?'E':' ',
                         //                    (Flags.KeepBackups)?'B':' ',
@@ -511,9 +501,7 @@
         }
     }
 
-#ifdef CONFIG_SYNTAX_HILIT
     Rehilit(VToR(CP.Row));
-#endif
 
     if (BFI(this, BFI_AutoHilitParen) == 1) {
         if (Match.Row == -1 && Match.Col == -1)
@@ -573,7 +561,6 @@
     RedrawToEos = 0;
 }
 
-#ifdef CONFIG_WORD_HILIT
 int EBuffer::GetHilitWord(int len, char *str, ChColor &clr, int IgnCase) {
     char *p;
 
@@ -583,6 +570,7 @@
     if (len >= CK_MAXLEN)
         return 0;
 
+#ifdef CONFIG_WORD_HILIT
     {
         char s[CK_MAXLEN + 1];
         s[CK_MAXLEN] = 0;
@@ -593,6 +581,7 @@
             return 1;
         }
     }
+#endif
     if (len < 1) return 0;
     p = Mode->fColorize->Keywords.key[len];
     if (IgnCase) {
@@ -618,18 +607,15 @@
 
         memcpy(s, str, len);
         s[len] = 0;
-#ifdef CONFIG_TAGS
         if (BFI(this, BFI_HilitTags)&&TagDefined(s)) {
 	    //clr = 0x0A;
 	    clr = CLR_HexNumber;// Mode->fColorize->Colors[];
             return 1;
         }
-#endif
     }
     
     return 0;
 }
-#endif
 
 EEditPort *EBuffer::GetViewVPort(EView *V) {
     return (EEditPort *)V->Port;
diff -X dontdiff -ur fte-0.49.13.1/src/e_regex.cpp fte-0.50.0/src/e_regex.cpp
--- fte-0.49.13.1/src/e_regex.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_regex.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -528,7 +528,7 @@
     return F;
 }
 
-static RxNode *RxOptimize(RxNode *rx) {
+RxNode *RxOptimize(RxNode *rx) {
     return rx;
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/e_search.cpp fte-0.50.0/src/e_search.cpp
--- fte-0.49.13.1/src/e_search.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_search.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -123,17 +123,6 @@
 }
 
 int EBuffer::FindStr(char *Data, int Len, int Options) {
-    SearchReplaceOptions opt;
-
-    memset(&opt, 0, sizeof(opt));
-
-    opt.Options = Options;
-
-    return FindStr(Data, Len, opt);
-}
-
-int EBuffer::FindStr(char *Data, int Len, SearchReplaceOptions &opt) {
-    int Options = opt.Options;
     int LLen, Start, End;
     int C, L;
     PELine X;
@@ -170,14 +159,7 @@
                 C = X->Count;
             }
         } else {
-            if (Options & SEARCH_REPLACE)
-            {
-                C += CC * opt.lastInsertLen; // 0 or opt.lastInsertLen
-            } else
-            {
-                C += CC;
-            }
-
+            C += CC;
             if (C >= X->Count) {
                 C = 0;
                 L++;
@@ -296,8 +278,7 @@
     return 0;
 }
 
-int EBuffer::FindRx(RxNode *Rx, SearchReplaceOptions &opt) {
-    int Options = opt.Options;
+int EBuffer::FindRx(RxNode *Rx, int Options) {
     int LLen, Start, End;
     int C, L;
     char *P;
@@ -477,7 +458,6 @@
     RxNode *R = NULL;
 
     opt.resCount = -1;
-    opt.lastInsertLen = 0;
 
     if (slen == 0) return 0;
     if (Options & SEARCH_BLOCK) {
@@ -509,9 +489,9 @@
     opt.resCount = 0;
     while (1) {
         if (Options & SEARCH_RE) {
-            if (FindRx(R, opt) == 0) goto end;
+            if (FindRx(R, Options) == 0) goto end;
         } else {
-            if (FindStr(opt.strSearch, slen, opt) == 0) goto end;
+            if (FindStr(opt.strSearch, slen, Options) == 0) goto end;
         }
         opt.resCount++;
 
@@ -575,11 +555,6 @@
             } else {
                 if (DelText(Match.Row, Match.Col, MatchLen) == 0) goto error;
                 if (InsText(Match.Row, Match.Col, rlen, opt.strReplace) == 0) goto error;
-
-                // Cursor remains at start of inserted string. If there is recursive
-                // replace pattern, fte can go it infinite loop.
-                // Workaround: Move cursor to end of inserted string
-                opt.lastInsertLen = strlen(opt.strReplace);
             }
             if (!(Options & SEARCH_BACK)) {
                 MatchLen = rlen;
@@ -715,45 +690,6 @@
     return 0;
 }
 
-int EBuffer::CompleteGrep() {  // it should only work via Semware GREP 2.0+ format
-    char cmdStr[512]="";
-    PELine L = VLine(CP.Row);
-    int CurrLine;
-    int GotInfo=0;
-    int ii;
-    GrepLine=0;
-#ifdef UNIX
-    bzero(GrepName,MAXPATH);
-#else
-    memset(GrepName,0,MAXPATH);
-#endif
-    strcpy(cmdStr,FileName);
-    GetStrVar(mvFileExtension,cmdStr,1);
-    Msg(S_INFO,"GRP Founded");
-    if (!stricmp(cmdStr,".grp")) {
-        CurrLine = VToR(CP.Row);
-        for (;;) {
-            if (CurrLine<0) break;
-            L = RLine(CurrLine);               // Real line Pointer
-            strncpy(cmdStr,L->Chars,L->Count);
-            ii = atoi(cmdStr);
-            if ((ii>0)&&(!GotInfo)) {
-                GrepLine=ii;
-                GotInfo=1;
-            }
-            if (ii==0) {
-                if (!strncmp(cmdStr,"File:",5)) {
-                    strncpy(GrepName,cmdStr+6,L->Count-6);
-                    GotInfo=1;
-                    break;
-                }
-            }
-            CurrLine--;
-        }
-    }
-    Msg(S_INFO,"%d %s<<",GrepLine,GrepName);
-    return (GotInfo);
-}
 
 int EBuffer::CompleteWord() {
 #ifdef CONFIG_I_COMPLETE
@@ -990,10 +926,7 @@
 #ifdef CONFIG_UNDOREDO
         "U%d/%d/%d "
 #endif
-#ifdef CONFIG_SYNTAX_HILIT
-        "H%d/"
-#endif
-        "%d/%d",
+        "H%d/%d/%d",
 #ifdef HEAPWALK
         MemUsed, MemFree, BlkUsed, BlkFree, BigUsed, BigFree,
 #endif
@@ -1005,10 +938,7 @@
 #ifdef CONFIG_UNDOREDO
         US.UndoPtr, US.Num, NN,
 #endif
-#ifdef CONFIG_SYNTAX_HILIT
-        StartHilit,
-#endif
-        MinRedraw, MaxRedraw);
+        StartHilit, MinRedraw, MaxRedraw);
     return 1;
 }
 
@@ -1088,6 +1018,7 @@
 #endif
 
 int EBuffer::GetMatchBrace(EPoint &M, int MinLine, int MaxLine, int show) {
+    int StateLen;
     hsState *StateMap = 0;
     int Pos;
     PELine L = VLine(M.Row);
@@ -1114,10 +1045,7 @@
         return 0;
     }
     StateMap = 0;
-#ifdef CONFIG_SYNTAX_HILIT
-    int StateLen;
     if (GetMap(M.Row, &StateLen, &StateMap) == 0) return 0;
-#endif
     State = StateMap[Pos];
     StateRow = M.Row;
 
@@ -1128,9 +1056,7 @@
                 if (StateRow != M.Row) {
                     free(StateMap);
                     StateMap = 0;
-#ifdef CONFIG_SYNTAX_HILIT
                     GetMap(M.Row, &StateLen, &StateMap);
-#endif
                     if (StateMap == 0) return 0;
                     StateRow = M.Row;
                 }
@@ -1210,7 +1136,6 @@
     return FindStr(word, len, Case | SearchFlags | SEARCH_WORD);
 }
 
-#ifdef CONFIG_TAGS
 int EBuffer::FindTagWord(ExState &State) {
     char word[MAXSEARCH + 1];
     PELine L = VLine(CP.Row);
@@ -1227,7 +1152,6 @@
         return 0;
     }
 
-    Msg(S_INFO,"Tagging ....");
     int j = 2;
     while (j--) {
         int i;
@@ -1246,4 +1170,3 @@
     }
     return 0;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_tags.cpp fte-0.50.0/src/e_tags.cpp
--- fte-0.49.13.1/src/e_tags.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_tags.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -322,7 +322,7 @@
     char Dir[MAXPATH];
     TagData *TT = &TagD[TagI[M]];
 
-    JustDirectory(TagMem + TT->TagBase, Dir, sizeof(Dir));
+    JustDirectory(TagMem + TT->TagBase, Dir);
 
     if (IsFullPath(TagMem + TT->FileName)) {
         strcpy(path, TagMem + TT->FileName);
@@ -565,27 +565,27 @@
 }
 
 int TagPop(EView *View) { /*FOLD00*/
-    int rv=0;
     TagStack *T = TStack;
 
     assert(View != 0);
 
     if (T) {
         TStack = T->Next;
+
         if (CurrentTag)
-        {
             free(CurrentTag);
-            CurrentTag = NULL;
-        }
-
-        CurrentTag = T->CurrentTag;
+        CurrentTag = strdup(T->CurrentTag);
         TagPosition = T->TagPos;
-        rv = GotoFilePos(View, T->FileName, T->Line, T->Col);
+
+        if (GotoFilePos(View, T->FileName, T->Line, T->Col) == 0) {
+            free(T);
+            return 0;
+        }
         free(T);
-        return rv;
+        return 1;
     }
     View->Msg(S_INFO, "Tag stack empty.");
-    return rv;
+    return 0;
 }
 
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_undo.cpp fte-0.50.0/src/e_undo.cpp
--- fte-0.49.13.1/src/e_undo.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_undo.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,6 +9,20 @@
 
 #include "fte.h"
 
+int EBuffer::NextCommand() {
+    if (Match.Row != -1) {
+        Draw(Match.Row, Match.Row);
+        Match.Col = Match.Row = -1;
+    }
+    if (View)
+        View->SetMsg(0);
+#ifdef CONFIG_UNDOREDO
+    return BeginUndo();
+#else
+    return 1;
+#endif
+}
+
 #ifdef CONFIG_UNDOREDO
 
 int EBuffer::PushBlockData() {
@@ -248,7 +262,6 @@
             }
             break;
 
-#ifdef CONFIG_FOLDS
         case ucFoldCreate:
             // puts("ucFoldCreate");
             UGET(rc, No, Pos, Line); if (rc == 0) return 0;
@@ -293,14 +306,12 @@
             UGET(rc, No, Pos, Line); if (rc == 0) return 0;
             if (FoldOpen(Line) == 0) return 0;
             break;
-#endif
             
         case ucModified:
 //            printf("\tModified\n");
             Modified = 0;
             break;
 
-#ifdef CONFIG_BOOKMARKS
         case ucPlaceUserBookmark:
             //puts ("ucPlaceUserBookmark");
             UGET(rc, No, Pos, ACount); if (rc == 0) return 0;
@@ -324,7 +335,6 @@
             UGET(rc, No, Pos, Line); if (rc == 0) return 0;
             if (PlaceUserBookmark ((const char *)data,EPoint (Line,Col))==0) return 0;
             break;
-#endif
 
         default:
             assert(1 == "Oops: invalid undo command.\n"[0]);
diff -X dontdiff -ur fte-0.49.13.1/src/e_unix.cpp fte-0.50.0/src/e_unix.cpp
--- fte-0.49.13.1/src/e_unix.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_unix.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -7,15 +7,14 @@
  *
  */
 
-
-#include "fte.h"
-
-#ifdef CONFIG_HELP
-
 #ifdef WINNT
 #include "e_win32.cpp"
 #else
 
+// UNIX specific routines
+
+#include "fte.h"
+
 #include <sys/wait.h>
 #include <signal.h>
 
@@ -36,8 +35,8 @@
         word = wordAsk;
     }
 
-    snprintf(file, sizeof(file)-1, "/tmp/fte%d-man-%s", getpid(), word);
-    snprintf(command, sizeof(command)-1, "%s %s %s >'%s' 2>&1", HelpCommand, options, word, file);
+    sprintf(file, "/tmp/fte%d-man-%s", getpid(), word);
+    sprintf(command, "%s %s %s >'%s' 2>&1", HelpCommand, options, word, file);
 
     /// !!! why is this needed ???
 #define SYSCALL(call) while(((call) == -1) && (errno == EINTR))
@@ -86,5 +85,3 @@
 }
 
 #endif
-
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/e_win32.cpp fte-0.50.0/src/e_win32.cpp
--- fte-0.49.13.1/src/e_win32.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/e_win32.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -11,8 +11,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_HELP
-
 #include <windows.h>
 
 int EView::SysShowHelp(ExState &State, const char *word) {
@@ -39,4 +37,3 @@
     }
     return 1;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/feature.h fte-0.50.0/src/feature.h
--- fte-0.49.13.1/src/feature.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/feature.h	2007-04-15 11:00:00.000000000 +0800
@@ -12,21 +12,12 @@
 #ifndef __FEATURE_H__
 #define __FEATURE_H__
 
-#ifndef CONFIG_MINIMAL
-
 #undef CONFIG_EMULATE_VI // todo
 
-#define CONFIG_TRANS
-#define CONFIG_EXTERNAL_CONFIG
-#define CONFIG_VIEWLIST
-#define CONFIG_VIEWMODEMAP
-#define CONFIG_BACKUP
-#define CONFIG_EXTERNAL_COMMAND
-#define CONFIG_HELP
+#define CONFIG_CONFIGURABLE
 #define CONFIG_MOUSE
 #define CONFIG_CLIPBOARD
 #define CONFIG_SHELL
-#define CONFIG_LOGGING
 
 #define CONFIG_MFRAMES
 #define CONFIG_MWINDOWS
@@ -47,7 +38,6 @@
 #define CONFIG_WORDWRAP
 #define CONFIG_ABBREV
 #define CONFIG_TAGS
-#define VIEWBUFFERS
 
 #define CONFIG_UNDOREDO
 #define CONFIG_REGEXPS
@@ -63,7 +53,6 @@
 #define CONFIG_OBJ_ROUTINE
 #define CONFIG_OBJ_BUFFERS
 #define CONFIG_OBJ_MESSAGES
-#define CONFIG_OBJ_MODEMAP
 #define CONFIG_OBJ_CVS
 #endif
 
@@ -85,9 +74,6 @@
 #define CONFIG_HILIT_CATBS
 #define CONFIG_HILIT_SIMPLE
 #endif
-#define CONFIG_INDENT
-
-#ifdef CONFIG_INDENT
 
 #if defined(CONFIG_HILIT_C)
 #define CONFIG_INDENT_C
@@ -101,10 +87,5 @@
 #define CONFIG_INDENT_REXX
 #endif
 
-#endif
-
 #define CONFIG_I_COMPLETE
-
-#endif
-
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/fte-bcc2.mak fte-0.50.0/src/fte-bcc2.mak
--- fte-0.49.13.1/src/fte-bcc2.mak	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/fte-bcc2.mak	2007-04-15 11:00:00.000000000 +0800
@@ -3,7 +3,7 @@
 
 .AUTODEPEND
 
-DEFINES=-DOS2 -DBCPP -DHEAPWALK -DINCL_32
+DEFINES=-DOS2 -DBCPP -DHEAPWALK
 
 DEBUG =
 #DEBUG=-v
åªå¨ fte-0.49.13.1/src å­å¨ï¼fte.cnf
diff -X dontdiff -ur fte-0.49.13.1/src/fte.cpp fte-0.50.0/src/fte.cpp
--- fte-0.49.13.1/src/fte.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/fte.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -6,9 +6,8 @@
  *    License or the Artistic License, as specified in the README file.
  *
  */
+#define NEED_LOG_H
 #include "fte.h"
-#include "log.h"
-#include "c_history.h"
 #ifdef USE_LOCALE
 #include <locale.h>
 #endif
@@ -16,13 +15,9 @@
 #if defined(UNIX)
 /* default locations for the configuration files */
 const char *Unix_RCPaths[] = {
-#ifdef SYSTEM_FTERC
-	SYSTEM_FTERC
-#else
     "/usr/local/etc/fte/system.fterc",
     "/etc/fte/system.fterc",
     "/usr/X11R6/lib/X11/fte/system.fterc",
-#endif
 };
 
 // variables used by vfte
@@ -110,59 +105,42 @@
 
 #endif
 
-#ifdef CONFIG_EXTERNAL_CONFIG
 static int GetConfigFileName(int /*argc*/, char **argv, char *ConfigFileName) {
-    // NOTE: function assumes that ConfigFileName's size is MAXPATH
-
     char CfgName[MAXPATH] = "";
 
     if (ConfigFileName[0] == 0) {
 #if defined(UNIX)
         // ? use ./.fterc if by current user ?
-        ExpandPath("~/.fterc", CfgName, sizeof(CfgName));
+        ExpandPath("~/.fterc", CfgName);
 #elif defined(DOS) || defined(DOSP32)
-        strlcpy(CfgName, argv[0], sizeof(CfgName));
-
-        char *extPtr;
-
-        if ((extPtr = findPathExt(CfgName)) != NULL)
-        {
-            *extPtr = 0;
-            strlcat(CfgName, ".cnf", sizeof(CfgName));
-        }
+        strcpy(CfgName, argv[0]);
+        strcpy(findPathExt(CfgName), ".cnf");
 #elif defined(OS2) || defined(NT)
         char home[MAXPATH] = "";
         char *ph;
 #if defined(OS2)
         ph = getenv("HOME");
-        if (ph) strlcpy(home, ph, sizeof(home));
+        if (ph) strcpy(home, ph);
 #endif
 #if defined(NT)
         ph = getenv("HOMEDRIVE");
-        if (ph) strlcpy(home, ph, sizeof(home));
+        if (ph) strcpy(home, ph);
         ph = getenv("HOMEPATH");
-        if (ph) strlcat(home, ph, sizeof(home));
+        if (ph) strcat(home, ph);
 #endif
         if (home[0]) {
-            strlcpy(CfgName, home, sizeof(CfgName));
+            strcpy(CfgName, home);
             Slash(CfgName, 1);
-            strlcat(CfgName, "fte.cnf", sizeof(CfgName));
+            strcat(CfgName, "fte.cnf");
         }
 
         if (!home[0] || access(CfgName, 0) != 0) {
-            strlcpy(CfgName, argv[0], sizeof(CfgName));
-
-            char *extPtr;
-
-            if ((extPtr = findPathExt(CfgName)) != NULL)
-            {
-                *extPtr = 0;
-                strlcat(CfgName, ".cnf", sizeof(CfgName));
-            }
+            strcpy(CfgName, argv[0]);
+            strcpy(findPathExt(CfgName), ".cnf");
         }
 #endif
 
-        strlcpy(ConfigFileName, CfgName, MAXPATH);
+        strcpy(ConfigFileName, CfgName);
     }
     if (access(ConfigFileName, 0) == 0)
         return 1;
@@ -170,14 +148,13 @@
 #if defined(UNIX)
     for (unsigned int i = 0; i < sizeof(Unix_RCPaths)/sizeof(Unix_RCPaths[0]); i++) {
         if (access(Unix_RCPaths[i], 0) == 0) {
-            strlcpy(ConfigFileName, Unix_RCPaths[i], MAXPATH);
+            strcpy(ConfigFileName, Unix_RCPaths[i]);
             return 1;
         }
     }
 #endif
     return 0;
 }
-#endif
 
 static int CmdLoadConfiguration(int &argc, char **argv) {
     int ign = 0;
@@ -194,15 +171,15 @@
                 }
                 int debug_clean = strcmp(argv[Arg], "--debugclean") == 0;
                 if (debug_clean || strcmp(argv[Arg], "--debug") == 0) {
-#ifdef CONFIG_LOGGING
+#ifndef FTE_NO_LOGGING
                     char path[MAXPATH];
 #ifdef UNIX
-                    ExpandPath("~/.fte", path, sizeof(path));
+                    ExpandPath("~/.fte", path);
 #else
-                    JustDirectory(argv[0], path, sizeof(path));
+                    JustDirectory(argv[0], path);
 #endif
                     Slash(path,1);
-                    strlcat(path, "fte.log", sizeof(path));
+                    strcat(path, "fte.log");
                     if (debug_clean) unlink(path);
 
                     globalLog.SetLogFile(path);
@@ -223,7 +200,7 @@
             } else if (argv[Arg][1] == 'c' || argv[Arg][1] == 'C') {
                 if (argv[Arg][2])
                 {
-                    ExpandPath(argv[Arg] + 2, ConfigFileName, sizeof(ConfigFileName));
+                    ExpandPath(argv[Arg] + 2, ConfigFileName);
                     haveConfig = 1;
                 }
                 else
@@ -231,19 +208,22 @@
             }
         }
     }
-#ifdef CONFIG_EXTERNAL_CONFIG
-    if (ign || !haveConfig && GetConfigFileName(argc, argv, ConfigFileName) == 0) {
+    if (!haveConfig && GetConfigFileName(argc, argv, ConfigFileName) == 0) {
+        // should we default to internal
+#ifdef DEFAULT_INTERNAL_CONFIG
+       ign = 1;
 #endif
+    }
+
+    if (ign) {
         if (UseDefaultConfig() == -1)
             DieError(1, "Error in internal configuration??? FATAL!");
-#ifdef CONFIG_EXTERNAL_CONFIG
     } else {
         if (LoadConfig(argc, argv, ConfigFileName) == -1)
             DieError(1,
                      "Failed to load configuration file '%s'.\n"
                      "Use '-C' option.", ConfigFileName);
     }
-#endif
     for (Arg = 1; Arg < argc; Arg++) {
         if (!QuoteAll && !QuoteNext && (argv[Arg][0] == '-')) {
             if (argv[Arg][1] == '-' && argv[Arg][2] == '\0') {
@@ -252,10 +232,10 @@
                 QuoteNext = 1;
 #ifdef CONFIG_DESKTOP
             } else if (argv[Arg][1] == 'D') {
-                ExpandPath(argv[Arg] + 2, DesktopFileName, sizeof(DesktopFileName));
+                ExpandPath(argv[Arg] + 2, DesktopFileName);
                 if (IsDirectory(DesktopFileName)) {
                     Slash(DesktopFileName, 1);
-                    strlcat(DesktopFileName, DESKTOP_NAME, sizeof(DesktopFileName));
+                    strcat(DesktopFileName, DESKTOP_NAME);
                 }
                 if (DesktopFileName[0] == 0) {
                     LoadDesktopOnEntry = 0;
@@ -266,7 +246,7 @@
 #endif
 #ifdef CONFIG_HISTORY
             } else if (argv[Arg][1] == 'H') {
-                strlcpy(HistoryFileName, argv[Arg] + 2, sizeof(HistoryFileName));
+                strcpy(HistoryFileName, argv[Arg] + 2);
                 if (HistoryFileName[0] == 0) {
                     KeepHistory = 0;
                 } else {
@@ -278,16 +258,12 @@
             if (LoadDesktopOnEntry == 2) {
                 LoadDesktopOnEntry = 0;
                 SaveDesktopOnExit = 0;
-#ifdef CONFIG_DESKTOP
                 DesktopFileName[0] = 0;
-#endif
             }
         }
     }
-#ifdef CONFIG_DESKTOP
     if (LoadDesktopOnEntry == 2)
         LoadDesktopOnEntry = 1;
-#endif
     return 1;
 }
 
@@ -330,12 +306,7 @@
     if (gui == 0 || g == 0)
         DieError(1, "Failed to initialize display\n");
 
-    if(gui->Run() != 0)
-    {
-        delete gui;
-        Usage();
-        return 1;
-    }
+    gui->Run();
 
 #if defined(OS2) && !defined(DBMALLOC) && defined(CHECKHEAP)
     if (_heapchk() != _HEAPOK)
diff -X dontdiff -ur fte-0.49.13.1/src/fte.h fte-0.50.0/src/fte.h
--- fte-0.49.13.1/src/fte.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/fte.h	2007-04-15 11:00:00.000000000 +0800
@@ -44,7 +44,6 @@
 #include "o_list.h"
 #include "e_tags.h"
 #include "s_util.h"
-#include "s_string.h"
 #include "i_search.h"
 #include "i_complete.h"
 #include "o_directory.h"
diff -X dontdiff -ur fte-0.49.13.1/src/fte-unix.mak fte-0.50.0/src/fte-unix.mak
--- fte-0.49.13.1/src/fte-unix.mak	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/fte-unix.mak	2007-04-15 11:00:00.000000000 +0800
@@ -5,8 +5,7 @@
 
 #  vfte - for Linux console directly (with limitations, see con_linux.cpp)
 
-TARGETS = nfte xfte sfte
-#TARGETS = xfte vfte sfte nfte
+TARGETS = xfte vfte sfte nfte
 #TARGETS = xfte
 
 PRIMARY = xfte
@@ -18,48 +17,31 @@
 #REMAPFLAG = -DUSE_HARD_REMAP
 
 # Drawing fonts with locale support
-#XMBFLAG = -DUSE_XMB
+XMBFLAG = -DUSE_XMB
 
 # System X11R6 is compiled with X_LOCALE
 #SYSTEM_X_LOCALE = -DX_LOCALE
 
 # Enable normal locale support
-#USE_LOCALE = -DUSE_LOCALE
+USE_LOCALE = -DUSE_LOCALE
 
-#I18NOPTIONS = $(XMBFLAG) $(REMAPFLAG) $(SYSTEM_X_LOCALE) $(USE_LOCALE)
+I18NOPTIONS = $(XMBFLAG) $(REMAPFLAG) $(SYSTEM_X_LOCALE) $(USE_LOCALE)
 
 # Optionally, you can define:
 # -DDEFAULT_INTERNAL_CONFIG to use internal config by default
 # -DUSE_XTINIT to use XtInitialize on init
 # -DFTE_NO_LOGGING to completely disable trace logging
-ifeq "$(FTECONFIG)" "minimal"
-DEFAULT_FTE_CONFIG = minimal.fte
-APPOPTIONS = -DCONFIG_MINIMAL
-endif
-ifeq "$(FTECONFIG)" "dosedit"
-DEFAULT_FTE_CONFIG = dosedit.fte
-APPOPTIONS = -DCONFIG_MINIMAL -DCONFIG_DOSEDIT
-endif
-ifeq "$(DEFAULT_FTE_CONFIG)" ""
-DEFAULT_FTE_CONFIG = simple.fte
-endif
-
-
-PREFIX=/usr/local
-SYSTEM_FTERC=$(PREFIX)/lib/fte/system.fterc
+APPOPTIONS = -DDEFAULT_INTERNAL_CONFIG
 
 #gcc/g++
-#COPTIONS = -Wall -Wpointer-arith -Wconversion -Wwrite-strings \
-#           -Winline
+COPTIONS = -Wall -Wpointer-arith -Wconversion -Wwrite-strings \
+           -Winline
 
-#CROSS = /export/tools/bin/i386-linux-
 #CC       = g++
 #LD       = g++
 # try this for smaller/faster code and less dependencies
-CCNATIVE = g++ -fno-rtti -fno-exceptions 
-LDNATIVE = g++ -fno-rtti -fno-exceptions 
-CC       = $(CROSS)$(CCNATIVE)
-LD       = $(CROSS)$(LDNATIVE)
+CC       = g++ -fno-rtti -fno-exceptions
+LD       = g++ -fno-rtti -fno-exceptions
 
 
 # choose your os here
@@ -88,8 +70,7 @@
 #MINCDIR  = -I/usr/include/Motif1.2
 #MLIBDIR  = -L/usr/lib/Motif1.2
 
-#SINCDIR   = -I/usr/include/slang
-#SINCDIR   = -I/usr/local/include
+SINCDIR   = -I/usr/include/slang
 
 #######################################################################
 # AIX
@@ -155,15 +136,11 @@
 LIBDIR   =
 INCDIR   =
 
-ifneq "$(FTECONFIG)" ""
-OPTIMIZE = -O2 -s
-else
 OPTIMIZE = -g # -O -g
 #OPTIMIZE = -O2
 #OPTIMIZE = -O2 -s
-endif
 
-CCFLAGS  = $(OPTIMIZE) $(I18NOPTIONS) $(APPOPTIONS) -DSYSTEM_FTERC='"$(SYSTEM_FTERC)"' $(COPTIONS) -DUNIX $(UOS) $(INCDIR) $(XINCDIR) $(QINCDIR) $(MINCDIR) $(SINCDIR)
+CCFLAGS  = $(OPTIMIZE) $(I18NOPTIONS) $(APPOPTIONS) $(COPTIONS) -DUNIX $(UOS) $(INCDIR) $(XINCDIR) $(QINCDIR) $(MINCDIR) $(SINCDIR)
 LDFLAGS  = $(OPTIMIZE) $(LIBDIR) $(XLIBDIR) $(QLIBDIR) $(MLIBDIR)
 
 OEXT     = o
@@ -179,7 +156,7 @@
 VLIBS    = -lgpm -lncurses
 # -ltermcap outdated by ncurses
 NLIBS    = -lncurses
-SLIBS    = /usr/lib/libslang.a
+SLIBS    = -lslang
 QLIBS    = -lqt
 #MLIBS    = -lXm -lXp -lXt -lXpm -lXext
 
@@ -189,23 +166,14 @@
 .c.o:
 	$(CC) $(CCFLAGS) -c $<
 
-native-%.o: %.c
-	$(CCNATIVE) $(CCFLAGS) -c $< -o $@
-
-native-%.o: %.cpp
-	$(CCNATIVE) $(CCFLAGS) -c $< -o $@
-
 .cpp.moc:
 	$(MOC) $< -o $@
 
-all:    $(CFTE_TARGET) $(TARGETS)
+all:    cfte $(TARGETS)
 #rm -f fte ; ln -s $(PRIMARY) fte
 
-cfte: cfte.o s_files.o s_string.o
-	$(LD) $(LDFLAGS) $+ -o $@
-
-native-cfte: $(patsubst %,native-%,cfte.o s_files.o s_string.o)
-	$(LDNATIVE) $(LDFLAGS) $+ -o $@
+cfte: cfte.o s_files.o
+	$(LD) $(LDFLAGS) cfte.o s_files.o -o cfte
 
 c_config.o: defcfg.h
 
@@ -213,12 +181,12 @@
 	perl mkdefcfg.pl <defcfg.cnf >defcfg.h
 
 #DEFAULT_FTE_CONFIG = simple.fte
-#DEFAULT_FTE_CONFIG = defcfg.fte
+DEFAULT_FTE_CONFIG = defcfg.fte
 #DEFAULT_FTE_CONFIG = defcfg2.fte
 #DEFAULT_FTE_CONFIG = ../config/main.fte
 
-defcfg.cnf: $(DEFAULT_FTE_CONFIG) $(NATIVE_PREFIX)cfte
-	./$(NATIVE_PREFIX)cfte $(DEFAULT_FTE_CONFIG) defcfg.cnf
+defcfg.cnf: $(DEFAULT_FTE_CONFIG) cfte
+	./cfte $(DEFAULT_FTE_CONFIG) defcfg.cnf
 
 xfte: .depend $(OBJS) $(XOBJS)
 	$(LD) -o $@ $(LDFLAGS) $(OBJS) $(XOBJS) $(XLIBS)
@@ -248,12 +216,8 @@
 .depend: defcfg.h
 	$(CC) -MM $(CCFLAGS) $(SRCS) 1>.depend
 
-# purposefully not part of "all".
-tags: $(SRCS) $(wildcard *.h)
-	ctags *.h $(SRCS)
-
 clean:
-	rm -f core *.o .depend $(TARGETS) defcfg.h defcfg.cnf $(NATIVE_PREFIX)cfte cfte fte vfte compkeys tags
+	rm -f core *.o .depend $(TARGETS) defcfg.h defcfg.cnf cfte fte vfte compkeys
 
 #
 # include dependency files if they exist
diff -X dontdiff -ur fte-0.49.13.1/src/ftever.h fte-0.50.0/src/ftever.h
--- fte-0.49.13.1/src/ftever.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/ftever.h	2007-04-15 11:00:00.000000000 +0800
@@ -6,8 +6,8 @@
 #define PROG_FTE      "fte"
 #define PROG_CFTE     "cfte"
 #define PROGRAM       PROG_FTE
-#define EXTRA_VERSION "-CT"
-#define VERSION       "0.49.13.1" EXTRA_VERSION
+#define EXTRA_VERSION "-cvs"
+#define VERSION       "0.49.13" EXTRA_VERSION
 #define VERNUM        MAKE_VERSION(0x00, 0x49, 0x0402)
 #define COPYRIGHT     "Copyright (c) 1994-1998 Marko Macek\n" \
                       "Copyright (c) 2000-2003 Others"
diff -X dontdiff -ur fte-0.49.13.1/src/g_motif.cpp fte-0.50.0/src/g_motif.cpp
--- fte-0.49.13.1/src/g_motif.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/g_motif.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -1796,21 +1796,27 @@
     return 1;
 }
 
-int GUI::RunProgram(char *Command) {
+int GUI::RunProgram(int mode, char *Command) {
     char Cmd[1024];
 
-    strlcpy(Cmd, XShellCommand, sizeof(Cmd));
+    char* xterm = getenv("TERM");
+    if (NULL == xterm || 0 == *xterm)
+        xterm = "xterm";
+
+    strcpy(Cmd, xterm);
 
     if (*Command == 0)  // empty string = shell
-        strlcat(Cmd, " -ls &", sizeof(Cmd));
+        strcat(Cmd, " -ls &");
     else {
-        strlcat(Cmd, " -e ", sizeof(Cmd));
-	strlcat(Cmd, Command, sizeof(Cmd));
+        strcat(Cmd, " -e ");
+        // buffer overflow problem: -2 for possible async.
+	strncat(Cmd, Command, sizeof(Cmd) - strlen(Cmd) - 2);
+        Cmd[sizeof(Cmd) - 3] = 0;
         if (mode == RUN_ASYNC)
-            strlcat(Cmd, " &", sizeof(Cmd));
+            strcat(Cmd, " &");
     }
-
-    return system(Cmd);
+    rc = system(Cmd);
+    return rc;
 }
 
 void PipeCallback(GPipe *pipe, int *source, XtInputId *input) {
@@ -1922,8 +1928,7 @@
     return WEXITSTATUS(status);
 }
 
-int GetXSelection(int *len, char **data, int clipboard) {
-    // XXX use clipboard?
+int GetXSelection(int *len, char **data) {
     *data = XFetchBytes(display, len);
     if (*data == 0)
         return -1;
@@ -1931,24 +1936,9 @@
         return 0;
 }
 
-int SetXSelection(int len, char *data, int clipboard) {
-    Atom clip;
+int SetXSelection(int len, char *data) {
     XStoreBytes(display, data, len);
-    switch (clipboard) {
-    case 0:
-        clip =  XA_CLIPBOARD;
-        break;
-    case 1:
-        clip = XA_PRIMARY;
-        break;
-    case 2:
-        clip = XA_SECONDARY;
-        break;
-    default:
-        // not supported
-        return -1;
-    }
-    XSetSelectionOwner(display, clip, None, CurrentTime);
+    XSetSelectionOwner (display, XA_PRIMARY, None, CurrentTime);
     return 1;
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/g_pm.cpp fte-0.50.0/src/g_pm.cpp
--- fte-0.49.13.1/src/g_pm.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/g_pm.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -45,7 +45,6 @@
 #include "c_mode.h"
 #include "c_color.h"
 #include "s_files.h"
-#include "s_string.h"
 #include "log.h"
 
 #define PM_STACK_SIZE (96 * 1024)
@@ -2042,13 +2041,11 @@
                     case SB_LINEUP:
                         Event->What = evCommand;
                         Event->Msg.Command = cmVScrollUp;
-                        Event->Msg.Param1 = 1;
                         break;
                         
                     case SB_LINEDOWN:
                         Event->What = evCommand;
                         Event->Msg.Command = cmVScrollDown;
-                        Event->Msg.Param1 = 1;
                         break;
                         
                     case SB_PAGEUP:
@@ -2094,13 +2091,11 @@
                     case SB_LINEUP:
                         Event->What = evCommand;
                         Event->Msg.Command = cmHScrollLeft;
-                        Event->Msg.Param1 = 1;
                         break;
                         
                     case SB_LINEDOWN:
                         Event->What = evCommand;
                         Event->Msg.Command = cmHScrollRight;
-                        Event->Msg.Param1 = 1;
                         break;
                         
                     case SB_PAGEUP:
@@ -2943,13 +2938,13 @@
 int GFramePeer::ConSetTitle(char *Title, char *STitle) {
     char szTitle[256] = {0};
 
-    JustFileName(Title, szTitle, sizeof(szTitle));
+    JustFileName(Title, szTitle);
     if (szTitle[0] == '\0') // if there is no filename, try the directory name.
-        JustLastDirectory(Title, szTitle, sizeof(szTitle));
+        JustLastDirectory(Title, szTitle);
 
     if (szTitle[0] != '\0') // if there is something...
-        strlcat(szTitle, " - ", sizeof(szTitle));
-    strlcat(szTitle, Title, sizeof(szTitle));
+        strncat(szTitle, " - ", sizeof(szTitle) - 1 - strlen(szTitle));
+    strncat(szTitle, Title, sizeof(szTitle) - 1 - strlen(szTitle));
 
     WinSetWindowText(hwndFrame, szTitle);
     return 1;
@@ -3495,20 +3490,17 @@
     int rc;
     PID pid;
     ULONG sid;
-    int ArgsSize;
     
     Prog = getenv("COMSPEC");
-
-    ArgsSize = 3 + strlen(Command) + 1;
     
-    Args = (char *)malloc(ArgsSize);
+    Args = (char *)malloc(3 + strlen(Command) + 1);
     if (Args == NULL) {
         return -1;
     }
     
     if (*Command != 0) {
-        strlcpy(Args, "/c ", ArgsSize);
-        strlcat(Args, Command, ArgsSize);
+        strcpy(Args, "/c ");
+        strcat(Args, Command);
     } else {
         Args[0] = 0;
     }
@@ -3620,15 +3612,14 @@
     arglen += strlen(Command) + 1;
     Args[arglen] = '\0';
 #else
-    int ArgsSize = 3 + strlen(Command) + 1;
-    Args = (char *)malloc(ArgsSize);
+    Args = (char *)malloc(3 + strlen(Command) + 1);
     if (Args == NULL) {
         DosClose(hfPipe);
         return -1;
     }
     
-    strlcpy(Args, "/c ", ArgsSize);
-    strlcat(Args, Command, ArgsSize);
+    strcpy(Args, "/c ");
+    strcat(Args, Command);
 #endif
     
     
diff -X dontdiff -ur fte-0.49.13.1/src/g_qt.cpp fte-0.50.0/src/g_qt.cpp
--- fte-0.49.13.1/src/g_qt.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/g_qt.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -337,7 +337,6 @@
     NextEvent.What = evCommand;
     NextEvent.Msg.View = view->View;
     NextEvent.Msg.Command = cmHScrollLeft;
-    NextEvent.Msg.Param1 = 1;
     ActiveEvent(NextEvent);
 }
 
@@ -345,7 +344,6 @@
     NextEvent.What = evCommand;
     NextEvent.Msg.View = view->View;
     NextEvent.Msg.Command = cmHScrollRight;
-    NextEvent.Msg.Param1 = 1;
     ActiveEvent(NextEvent);
 }
 
@@ -375,7 +373,6 @@
     NextEvent.What = evCommand;
     NextEvent.Msg.View = view->View;
     NextEvent.Msg.Command = cmVScrollUp;
-    NextEvent.Msg.Param1 = 1;
     ActiveEvent(NextEvent);
 }
 
@@ -383,7 +380,6 @@
     NextEvent.What = evCommand;
     NextEvent.Msg.View = view->View;
     NextEvent.Msg.Command = cmVScrollDown;
-    NextEvent.Msg.Param1 = 1;
     ActiveEvent(NextEvent);
 }
 
@@ -1478,8 +1474,10 @@
 }
 
 int GFramePeer::ConGetTitle(char *Title, int MaxLen, char *STitle, int SMaxLen) {
-    strlcpy(Title, qFrame->caption(), MaxLen);
-    strlcpy(STitle, qFrame->iconText(), SMaxLen);
+    strncpy(Title, qFrame->caption(), MaxLen);
+    Title[MaxLen - 1] = 0;
+    strncpy(STitle, qFrame->iconText(), SMaxLen);
+    STitle[SMaxLen - 1] = 0;
     return 1;
 }
 
@@ -1964,18 +1962,24 @@
 int GUI::RunProgram(char *Command) {
     char Cmd[1024];
 
-    strlcpy(Cmd, XShellCommand, sizeof(Cmd));
+    char* xterm = getenv("TERM");
+    if (NULL == xterm || 0 == *xterm)
+        xterm = "xterm";
+
+    strcpy(Cmd, xterm);
 
     if (*Command == 0)  // empty string = shell
-        strlcat(Cmd, " -ls &", sizeof(Cmd));
+        strcat(Cmd, " -ls &");
     else {
-        strlcat(Cmd, " -e ", sizeof(Cmd));
-	strlcat(Cmd, Command, sizeof(Cmd));
+        strcat(Cmd, " -e ");
+        // buffer overflow problem: -2 for possible async.
+	strncat(Cmd, Command, sizeof(Cmd) - strlen(Cmd) - 2);
+        Cmd[sizeof(Cmd) - 3] = 0;
         if (mode == RUN_ASYNC)
-            strlcat(Cmd, " &", sizeof(Cmd));
+            strcat(Cmd, " &");
     }
-
-    return system(Cmd);
+    rc = system(Cmd);
+    return rc;
 }
 
 /*void PipeCallback(GPipe *pipe, int *source, int *input) {
@@ -2089,23 +2093,11 @@
 
 int GUI::multiFrame() { return 1; }
 
-int GetXSelection(int *len, char **data, int clipboard) {
+int GetXSelection(int *len, char **data) {
     QClipboard *cb = QApplication::clipboard();
     const char *text;
-    Mode mode;
-    switch (clipboard) {
-    case 0:
-        mode = QClipboard::Clipboard;
-        break;
-    case 1:
-        mode = QClipboard::Selection;
-        break;
-    default:
-        // not supported
-        return -1;
-    }
 
-    text = cb->text(mode);
+    text = cb->text();
     if (text == 0)
         return -1;
 
@@ -2117,26 +2109,13 @@
     return 0;
 }
 
-int SetXSelection(int len, char *data, int clipboard) {
+int SetXSelection(int len, char *data) {
     QClipboard *cb = QApplication::clipboard();
     char *text = (char *)malloc(len + 1);
-    Mode mode;
     if (text == 0)
         return -1;
-    switch (clipboard) {
-    case 0:
-        mode = QClipboard::Clipboard;
-        break;
-    case 1:
-        mode = QClipboard::Selection;
-        break;
-    default:
-        // not supported
-        return -1;
-    }
     memcpy(text, data, len);
     text[len] = 0;
-    cb.setText(text, mode);
     free(text);
     return 0;
 }
diff -X dontdiff -ur fte-0.49.13.1/src/g_text.cpp fte-0.50.0/src/g_text.cpp
--- fte-0.49.13.1/src/g_text.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/g_text.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -17,7 +17,6 @@
 #include <malloc.h>
 #endif
 
-#include "feature.h"
 #include "console.h"
 #include "gui.h"
 #include "c_mode.h"
@@ -80,9 +79,7 @@
     int ConCursorVisible();
     int ConSetCursorSize(int Start, int End);
     
-#ifdef CONFIG_MOUSE
     int CaptureMouse(int grab);
-#endif
     int CaptureFocus(int grab);
     
     int QuerySbVPos();
@@ -134,10 +131,8 @@
 }
 
 GViewPeer::~GViewPeer() {
-#ifdef CONFIG_MOUSE
     if (MouseCapture == View)
         MouseCapture = 0;
-#endif
     if (FocusCapture == View)
         FocusCapture = 0;
 }
@@ -222,7 +217,6 @@
         return 1;
 }
 
-#ifdef CONFIG_MOUSE
 int GViewPeer::CaptureMouse(int grab) {
     if (MouseCapture == 0) {
         if (grab)
@@ -237,7 +231,6 @@
     }
     return 1;
 }
-#endif
 
 int GViewPeer::CaptureFocus(int grab) {
     if (FocusCapture == 0) {
@@ -460,11 +453,9 @@
     return Peer->ConSetCursorSize(Start, End);
 }
 
-#ifdef CONFIG_MOUSE
 int GView::CaptureMouse(int grab) {
     return Peer->CaptureMouse(grab);
 }
-#endif
 
 int GView::CaptureFocus(int grab) {
     return Peer->CaptureFocus(grab);
@@ -914,7 +905,7 @@
 #endif
 }
 
-static void HandleVScroll(GView *view, TEvent &E) {
+void HandleVScroll(GView *view, TEvent &E) {
     int y; //, x
     int wY, wH;
     TEvent E1;
@@ -928,7 +919,6 @@
             E1.What = evCommand;
             E1.Msg.View = view;
             E1.Msg.Command = cmVScrollUp;
-            E1.Msg.Param1 = 1;
             gui->DispatchEvent(frames, view, E1);
             frames->Update();
             do {
@@ -943,7 +933,6 @@
             E1.What = evCommand;
             E1.Msg.View = view;
             E1.Msg.Command = cmVScrollDown;
-            E1.Msg.Param1 = 1;
             gui->DispatchEvent(frames, view, E1);
             frames->Update();
             do {
@@ -1003,7 +992,7 @@
     E.What = evNone;
 }
 
-static void HandleHScroll(GView *view, TEvent &E) {
+void HandleHScroll(GView *view, TEvent &E) {
     int x; //, x
     int wX, wW;
     TEvent E1;
@@ -1017,7 +1006,6 @@
             E1.What = evCommand;
             E1.Msg.View = view;
             E1.Msg.Command = cmHScrollLeft;
-            E1.Msg.Param1 = 1;
             gui->DispatchEvent(frames, view, E1);
             frames->Update();
             do {
@@ -1032,7 +1020,6 @@
             E1.What = evCommand;
             E1.Msg.View = view;
             E1.Msg.Command = cmHScrollRight;
-            E1.Msg.Param1 = 1;
             gui->DispatchEvent(frames, view, E1);
             frames->Update();
             do {
@@ -1201,9 +1188,7 @@
                     if (id == -1) return;
                     frames->ConQuerySize(&Cols, &Rows);
                     int x = Cols / 2, y = Rows / 2;
-#ifdef CONFIG_MOUSE
                     ::ConQueryMousePos(&x, &y);
-#endif
                     
                     frames->Update(); // sync before menu
                     if (::ExecVertMenu(x, y, id, E, 0) != 1) {
diff -X dontdiff -ur fte-0.49.13.1/src/gui.h fte-0.50.0/src/gui.h
--- fte-0.49.13.1/src/gui.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/gui.h	2007-04-15 11:00:00.000000000 +0800
@@ -206,7 +206,6 @@
     unsigned long Options;
     //
     int resCount;
-    int lastInsertLen;
 } SearchReplaceOptions;
 
 int DLGGetFind(GView *View, SearchReplaceOptions &sr);
diff -X dontdiff -ur fte-0.49.13.1/src/g_unix_pipe.cpp fte-0.50.0/src/g_unix_pipe.cpp
--- fte-0.49.13.1/src/g_unix_pipe.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/g_unix_pipe.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -1,5 +1,4 @@
-#include "fte.h"
-#ifdef CONFIG_EXTERNAL_COMMAND
+
 #define MAX_PIPES 4
 
 #include <signal.h>
@@ -177,25 +176,3 @@
     Pipes[id].used = 0;
     return WEXITSTATUS(status);
 }
-#else
-#include "sysdep.h"
-int WaitPipeEvent(TEvent *Event,int WaitTime, int *fds, int nfds)
-{
-	fd_set readfds;
-	struct timeval tv;
-	struct timeval *timeout = NULL;
-	if(WaitTime >=0)
-	{
-		tv.tv_sec = WaitTime / 1000;
-		tv.tv_usec = (WaitTime % 1000) * 1000;
-		timeout = &tv;
-	}
-	FD_ZERO(&readfds);
-	int i;
-	for(i = 0; i < nfds; i++) { FD_SET(fds[i], &readfds);}
-	int rtn = select(sizeof(fd_set) * 8, &readfds, NULL, NULL, NULL);
-	if(rtn <= 0) return rtn;
-	for(i=0; i<nfds; i++) if(FD_ISSET(fds[i], &readfds)) return i+2;
-	return 0;
-}
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/h_c.cpp fte-0.50.0/src/h_c.cpp
--- fte-0.49.13.1/src/h_c.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/h_c.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -7,9 +7,11 @@
  *
  */
 
+#define NEED_LOG_H
 #include "fte.h"
+
 #ifdef CONFIG_HILIT_C
-#include "log.h"
+
 
 #define PRINTF(x) //printf x
 
diff -X dontdiff -ur fte-0.49.13.1/src/h_perl.cpp fte-0.50.0/src/h_perl.cpp
--- fte-0.49.13.1/src/h_perl.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/h_perl.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -121,14 +121,13 @@
     C = 0;
     NC = 0;
     int isEOHereDoc = 0;
-    if ((State & X_MASK) == hsPerl_HereDoc)
-    {
-        isEOHereDoc = strlen(hereDocKey) == (size_t)len &&
-            strncmp(hereDocKey, Line->Chars, len) == 0;
-        if (isEOHereDoc) State = hsPerl_Normal | (State & X_BIT);
-    }
     for(i = 0; i < Line->Count;) {
         if (*p != ' ' && *p != 9) firstnw++;
+        if ((State & X_MASK) == hsPerl_HereDoc && 0 == i)
+        {
+            isEOHereDoc = strlen(hereDocKey) == (size_t)len &&
+                strncmp(hereDocKey, Line->Chars, len) == 0;
+        }
         if (*p == '{' && inSub)
             inSub = 0;
         IF_TAB() else {
@@ -136,23 +135,20 @@
             switch (State & X_MASK) {
             default:
             case hsPerl_Normal:
-                if (i == 0 && X_NOT(State) && len == 8 &&
-                           p[0] == '_' &&
-                           p[1] == '_' &&
-                           p[2] == 'D' &&
-                           p[3] == 'A' &&
-                           p[4] == 'T' &&
-                           p[5] == 'A' &&
-                           p[6] == '_' &&
-                           p[7] == '_')
+                if (i == 0 && X_NOT(State) && len == 7 &&
+                    p[0] == '_' &&
+                    p[1] == '_' &&
+                    p[2] == 'E' &&
+                    p[3] == 'N' &&
+                    p[4] == 'D' &&
+                    p[5] == '_' &&
+                    p[6] == '_')
                 {
                     State = hsPerl_Data;
                     Color = CLR_Comment;
-                //hilit6:
-                    ColorNext();
                 hilit5:
                     ColorNext();
-                hilit4:
+                //hilit4:
                     ColorNext();
                 //hilit3:
                     ColorNext();
@@ -162,44 +158,22 @@
                     ColorNext();
                     continue;
                 } else if (
-                           i == 0 && X_NOT(State) && len == 7 &&
-                           p[0] == '_' &&
-                           p[1] == '_' &&
-                           p[2] == 'E' &&
-                           p[3] == 'N' &&
-                           p[4] == 'D' &&
-                           p[5] == '_' &&
-                           p[6] == '_')
-                {
-                    State = hsPerl_Data;
-                    Color = CLR_Comment;
-
-                } else if (
                            i == 0 && X_NOT(State) && (*p == '=') && len > 4 &&
                            (
                             strncmp(p+1, "head", 4) == 0 ||
                             strncmp(p+1, "item", 4) == 0 ||
                             strncmp(p+1, "over", 4) == 0 ||
-                            strncmp(p+1, "back", 4) == 0
-                           )
-                          )
-                {
-                    State = hsPerl_Docs;
-                    Color = CLR_Comment;
-                    goto hilit5;
-                } else if (
-                           i == 0 && X_NOT(State) && (*p == '=') && len > 3 &&
-                           (
+                            strncmp(p+1, "back", 4) == 0 ||
                             strncmp(p+1, "pod",  3) == 0
                            )
                           )
                 {
                     State = hsPerl_Docs;
                     Color = CLR_Comment;
-                    goto hilit4;
+                    goto hilit5;
                 } else if (isalpha(*p) || *p == '_') {
                     op = -1;
-
+                    
                     j = 0;
                     while (((i + j) < Line->Count) &&
                            (isalnum(Line->Chars[i+j]) ||
@@ -215,7 +189,7 @@
                     } else {
                         int x;
                         x = i + j;
-                        while ((x < Line->Count) &&
+                        while ((x < Line->Count) && 
                                ((Line->Chars[x] == ' ') || (Line->Chars[x] == 9))) x++;
                         if ((x < Line->Count) && (Line->Chars[x] == '(')) {
                             Color = CLR_Function;
@@ -242,42 +216,42 @@
                     }
                     if (StateMap)
                         memset(StateMap + i, State, j);
-                    if (B)
+                    if (B) 
                         MoveMem(B, C - Pos, Width, Line->Chars + i, HILIT_CLRD(), j);
                     i += j;
                     len -= j;
                     p += j;
                     C += j;
-
+                    
                     switch (op) {
                     case opQ:
                         State = hsPerl_Quote1Op;   // q{} operator
                         Color = CLR_Punctuation;
                         continue;
-
+                        
                     case opQQ:
                     case opQW:
                     case opQX:
                         State = hsPerl_Quote1Op;   // qq{} qx{} qw{} operators
                         Color = CLR_Punctuation;
                         continue;
-
+                        
                     case opM:
                     case opQR:
                         State = hsPerl_Regexp1Op;   // m{} qr{} operator
                         Color = CLR_Punctuation;
                         continue;
-
+                        
                     case opTR:
                         State = hsPerl_Regexp2Op;   // tr{} operators
                         Color = CLR_RegexpDelim;
                         continue;
-
+                        
                     case opS:
                         State = hsPerl_Regexp2Op;   // s{}{} operator
                         Color = CLR_Punctuation;
                         continue;
-
+                        
                     default:
                         State = hsPerl_Normal;
                         continue;
@@ -316,7 +290,7 @@
                                          *p == '%' ||
                                          *p == '\\'))
                         ColorNext();
-                    while ((len > 0) && (isalnum(*p) ||
+                    while ((len > 0) && (isalnum(*p) || 
                                          *p == '_' ||
                                          *p == '\''))
                         ColorNext();
@@ -330,14 +304,6 @@
                     ColorNext();
                     State = hsPerl_Normal | X_BIT;
                     continue;
-                } else if (*p == '*' && len > 1 && p[1] == '*') {
-                    hlState s = State;
-                    State = hsPerl_Punct;
-                    Color = CLR_Punctuation;
-                    ColorNext();
-                    ColorNext();
-                    State = s;
-                    continue;
                 } else if (*p == '$' || *p == '@' || *p == '\\' || (len > 2 && (*p == '%' || *p == '*') && X_NOT(State))) {
                     char var_type = *p;
                     State = hsPerl_Variable;
diff -X dontdiff -ur fte-0.49.13.1/src/h_plain.cpp fte-0.50.0/src/h_plain.cpp
--- fte-0.49.13.1/src/h_plain.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/h_plain.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -12,14 +12,13 @@
 #define hsPLAIN_Normal 0
 
 int Hilit_Plain(EBuffer *BF, int /*LN*/, PCell B, int Pos, int Width, ELine* Line, hlState& State, hsState *StateMap, int *ECol) {
+    HILIT_VARS(BF->Mode->fColorize->Colors, Line);
 
-//    HILIT_VARS(NULL, Line);
-HILIT_VARS(BF->Mode->fColorize?BF->Mode->fColorize->Colors:NULL, Line);
 #ifdef CONFIG_WORD_HILIT
     int j = 0;
     
-    if (BF->Mode->fColorize && ( BF->Mode->fColorize->Keywords.TotalCount > 0 ||
-        BF->WordCount > 0) )
+    if (BF->Mode->fColorize->Keywords.TotalCount > 0 ||
+        BF->WordCount > 0)
     { /* words have to be hilited, go slow */
         for(i = 0; i < Line->Count;) {
             IF_TAB() else {
@@ -79,7 +78,6 @@
     return 0;
 }
 
-#ifdef CONFIG_INDENT
 int Indent_Plain(EBuffer *B, int Line, int PosCursor) {
     int OI = B->LineIndented(Line);
     B->IndentLine(Line, B->LineIndented(Line - 1));
@@ -94,4 +92,3 @@
     }
     return 1;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/h_sh.cpp fte-0.50.0/src/h_sh.cpp
--- fte-0.49.13.1/src/h_sh.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/h_sh.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -119,9 +119,6 @@
                 } else if ( len >= 2 && *p == '\\' && p[1] == '"' ) {
                     Color = CLR_String;
                     ColorNext();
-                } else if ( len >= 2 && *p == '\\' && p[1] == '`' ) {
-                    Color = CLR_Command;
-                    ColorNext();
                 } else if (*p == '`') {
                     State = hsSH_BQuote;
                     Color = CLR_Command;
diff -X dontdiff -ur fte-0.49.13.1/src/i_choice.cpp fte-0.50.0/src/i_choice.cpp
--- fte-0.49.13.1/src/i_choice.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_choice.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -103,7 +103,6 @@
             break;
         }
         break;
-#ifdef CONFIG_MOUSE
     case evMouseDown:
         if (Win->CaptureMouse(1))
             MouseCaptured = 1;
@@ -130,7 +129,6 @@
         else
             Cur = 0;
         break;
-#endif
     }
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/i_complete.cpp fte-0.50.0/src/i_complete.cpp
--- fte-0.49.13.1/src/i_complete.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_complete.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -67,30 +67,6 @@
     return 1;
 }
 
-bool ExComplete::IsSimpleCase()
-{
-    if (WordsLast < 2) return true;
-
-    return false;
-}
-
-int ExComplete::DoCompleteWord()
-{
-    int rc = 0;
-
-    if (WordsLast <= 0 || !Words[WordPos]) return rc;
-
-    int l = strlen(Words[WordPos]);
-
-    if (Buffer->InsText(Buffer->VToR(Orig.Row), Orig.Col, l, Words[WordPos], 1)
-        && Buffer->SetPos(Orig.Col + l, Orig.Row)) {
-        Buffer->Draw(Buffer->VToR(Orig.Row), Buffer->VToR(Orig.Row));
-        rc = 1;
-    }
-
-    return rc;
-}
-
 void ExComplete::HandleEvent(TEvent &Event)
 {
     unsigned long kb = kbCode(Event.Key.Code);
@@ -203,19 +179,15 @@
     }
 
     if (DoQuit) {
-/*	int rc = 0;
+	int rc = 0;
 	int l = strlen(Words[WordPos]);
 
 	if (Buffer->InsText(Buffer->VToR(Orig.Row), Orig.Col, l, Words[WordPos], 1)
 	    && Buffer->SetPos(Orig.Col + l, Orig.Row)) {
 	    Buffer->Draw(Buffer->VToR(Orig.Row), Buffer->VToR(Orig.Row));
 	    rc = 1;
-        }*/
-
-        int rc = DoCompleteWord();
-
-        EndExec(rc);
-
+	}
+	EndExec(rc);
 	Event.What = evNone;
     }
 
@@ -318,9 +290,7 @@
 
     // fprintf(stderr, "Calling %d  %s\n", wlen, WordBegin);
     // Search words in TAGS
-#ifdef CONFIG_TAGS
     TagComplete(Words, &WordsLast, MAXCOMPLETEWORDS, WordBegin);
-#endif
     // fprintf(stderr, "Located %d words\n", WordsLast);
     // these words are already sorted
 
diff -X dontdiff -ur fte-0.49.13.1/src/i_complete.h fte-0.50.0/src/i_complete.h
--- fte-0.49.13.1/src/i_complete.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_complete.h	2007-04-15 11:00:00.000000000 +0800
@@ -43,8 +43,5 @@
     virtual void RepaintView();
     virtual void UpdateStatus();
     virtual void RepaintStatus();
-
-    virtual bool IsSimpleCase();
-    virtual int DoCompleteWord();
 };
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/i_input.cpp fte-0.50.0/src/i_input.cpp
--- fte-0.49.13.1/src/i_input.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_input.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -167,7 +167,7 @@
                 int len;
 
                 if (SystemClipboard)
-                    GetPMClip(0);
+                    GetPMClip();
                 
                 if (SSBuffer == 0) break;
                 if (SSBuffer->RCount == 0) break;
diff -X dontdiff -ur fte-0.49.13.1/src/i_view.cpp fte-0.50.0/src/i_view.cpp
--- fte-0.49.13.1/src/i_view.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_view.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -98,7 +98,6 @@
     GView::HandleEvent(Event);
     Top->HandleEvent(Event);
 
-#ifdef CONFIG_MOUSE
     if (Event.What & evMouse) {
         int W, H;
 
@@ -136,7 +135,6 @@
             return ;
         }
     }
-#endif
 }
 
 void GxView::Update() {
@@ -328,19 +326,10 @@
     if (View->GetContext() == CONTEXT_FILE) {
         ExComplete *c = new ExComplete((EBuffer *)View->Model);
         if (c != NULL) {
-
-            if (c->IsSimpleCase())
-            {
-                rc = c->DoCompleteWord();
-            } else
-            {
-                PushView(c);
-                rc = Execute();
-                PopView();
-            }
-
+            PushView(c);
+            rc = Execute();
+            PopView();
             Repaint();
-
             delete c;
         }
     }
diff -X dontdiff -ur fte-0.49.13.1/src/i_view.h fte-0.50.0/src/i_view.h
--- fte-0.49.13.1/src/i_view.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/i_view.h	2007-04-15 11:00:00.000000000 +0800
@@ -7,9 +7,6 @@
  *
  */
 
-#ifndef __I_VIEW_H__
-#define __I_VIEW_H__
-
 class EView;
 
 class GxView: public GView {
@@ -58,5 +55,3 @@
     
     int IsModelView() { return Top ? Top->IsModelView() : 0; }
 };
-
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/log.cpp fte-0.50.0/src/log.cpp
--- fte-0.49.13.1/src/log.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/log.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -7,17 +7,10 @@
 
 ********************************************************************/
 
-#include "feature.h"
-
-
-#ifdef CONFIG_LOGGING
-
 #include <time.h>
 #include <ctype.h>
 #include "sysdep.h"
-
 #include "log.h"
-GlobalLog globalLog;
 
 #if defined(NO_NEW_CPP_FEATURES)
 #include <iomanip.h>
@@ -29,6 +22,7 @@
 using namespace std;
 #endif
 
+#ifndef FTE_NO_LOGGING
 
 /*********************************************************************
  *
@@ -36,6 +30,7 @@
  *
  *********************************************************************/
 
+GlobalLog globalLog;
 
 bool GlobalLog::OpenLogFile()
 {
diff -X dontdiff -ur fte-0.49.13.1/src/log.h fte-0.50.0/src/log.h
--- fte-0.49.13.1/src/log.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/log.h	2007-04-15 11:00:00.000000000 +0800
@@ -97,7 +97,7 @@
 using namespace std;
 #endif
 
-#ifdef CONFIG_LOGGING
+#ifndef FTE_NO_LOGGING
 
 /**
  * GlobalLog handles the actual logging.
@@ -283,22 +283,8 @@
 
 #else // defined NO_LOGGING
 
-class nullstream
-{
-	public:
-	nullstream& operator<<(const char *) { return *this; }
-	nullstream& operator<<(char *) { return *this; }
-	nullstream& operator<<(int) { return *this; }
-//	nullstream& operator<<(nullstream&) { return *this; }
-//	nullstream& endl(){ return *this; }
-};
-
-//typedef nullstream GlobalLog;
-#define GlobalLog nullstream
-extern GlobalLog globalLog;
-
-#define LOG if(0) globalLog
-#define ENDLINE 0
+#define LOG while (0) { cout
+#define ENDLINE endl; }
 
 #define STARTFUNC(func) 
 #define ENDFUNCRC(rc) return rc
diff -X dontdiff -ur fte-0.49.13.1/src/Makefile fte-0.50.0/src/Makefile
--- fte-0.49.13.1/src/Makefile	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/Makefile	2007-04-15 11:00:00.000000000 +0800
@@ -29,8 +29,6 @@
 
 vag:
 	nmake /f fte-vag.mak
-cp:
-	cp -f nfte cfte /usr/local/bin
 
 clean:
-	rm -f core *.o *~ .depend
+	rm -f core *.o *~
diff -X dontdiff -ur fte-0.49.13.1/src/menu_text.cpp fte-0.50.0/src/menu_text.cpp
--- fte-0.49.13.1/src/menu_text.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/menu_text.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -7,8 +7,6 @@
  *
  */
 
-#include "feature.h"
-
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -191,9 +189,7 @@
     PCell c;
     PCell SaveC = 0;
     int SaveX, SaveY, SaveW, SaveH;
-#ifdef CONFIG_MOUSE
     int wasmouse = 0;
-#endif
     UpMenu here;
     int dovert = 0;
     int rx;
@@ -248,7 +244,6 @@
     SaveW = w;
     SaveH = h;
     
-#ifdef CONFIG_MOUSE
     if (E.What == evMouseMove || E.What == evMouseDown) {
     }
     if (E.What & evMouse) {
@@ -257,7 +252,6 @@
         wasmouse = 1;
         E.What = evNone;
     }
-#endif
     abort = -2;
     while (abort == -2) {
         DrawVMenu(x, y, id, cur);
@@ -333,7 +327,7 @@
             case kbLeft:
             case kbRight:
                 gui->ConPutEvent(E);
-                abort = 0;
+                abort = -1;
                 break;
             default:
                 if (isAscii(E.Key.Code)) {
@@ -365,7 +359,6 @@
                 }
             }
             break;
-#ifdef CONFIG_MOUSE
         case evMouseDown:
             if (E.Mouse.X >= x && E.Mouse.Y >= y &&
                 E.Mouse.X < x + w && E.Mouse.Y < y + h) 
@@ -374,7 +367,7 @@
             } else {
                 if (up) 
                     gui->ConPutEvent(E);
-                abort = 0;
+                abort = -1;
             }
             wasmouse = 1;
             dovert = 1;
@@ -408,7 +401,7 @@
                                     first = 0;
                                 }
                                 gui->ConPutEvent(E);
-                                abort = 0;
+                                abort = -1;
                                 break;
                             }
                             first = 0;
@@ -442,10 +435,10 @@
                             if (i != -1)
                                 if (Menus[p->id].Items[i].SubMenu == id) break;
                         }
-                        abort = 0;
+                        abort = -1;
                     }
                 } else
-                    abort = 0;
+                    abort = -1;
                 if (E.Mouse.X >= x && E.Mouse.Y >= y &&
                     E.Mouse.X < x + w && E.Mouse.Y < y + h);
                 else {
@@ -464,7 +457,6 @@
                 }
             }
             break;
-#endif
         }
     }
     if (SaveC) {
@@ -473,15 +465,15 @@
         SaveC = 0;
     }
     ConShowCursor();
-    if (abort == -3 && !up) abort = -1;
-    return abort;
+    if (up && abort == -3) return -3;
+    return (abort == 1) ? 1 : -1;
 }
 
 int ExecMainMenu(TEvent &E, char sub) {
     int cur = 0;
     int id = GetMenuId(frames->Menu);
     int abort;
-    int dovert = 0;
+    int dovert = 1;
     int rx;
     static UpMenu top = { 0, 0, 0, 0, 0, 0, 1 };
     PCell topline[ConMaxCols];
@@ -499,7 +491,6 @@
     ConGetBox(0, 0, Cols, 1, (PCell) topline);
     
     if (sub != 0) {
-	    dovert = 1;
         int i;
         
         for (i = 0; i < Menus[id].Count; i++) {
@@ -514,12 +505,10 @@
         }
     }
 
-#ifdef CONFIG_MOUSE
     if (E.What == evMouseDown) {
         cur = GetHPosItem(id, E.Mouse.X);
         dovert = 1;
     }
-#endif
     abort = -2;
     while (abort == -2) {
         DrawHMenu(0, 0, id, cur);
@@ -534,8 +523,6 @@
                     } else if (rx == -3) {
                         abort = -1;
                         break;
-		    } else if (rx == -1) {
-			    dovert = 0;
                     } else
                         abort = -2;
                 }
@@ -547,6 +534,7 @@
             if (E.What & evNotify)
                 gui->DispatchEvent(frames, frames->Active, E);
         } while (E.What & evNotify);
+        dovert = 0;
         switch (E.What) {
         case evCommand:
             if (E.Msg.Command == cmResize) abort = -1;
@@ -555,6 +543,7 @@
             switch (kbCode(E.Key.Code)) {
             case kbEnd: cur = Menus[id].Count;
             case kbLeft:
+                dovert = 1;
                 {
                     int x = cur;
                     do {
@@ -565,6 +554,7 @@
                 break;
             case kbHome: cur = -1;
             case kbRight:
+                dovert = 1;
                 {
                     int x = cur;
                     do {
@@ -617,7 +607,6 @@
                 break;
             }
             break;
-#ifdef CONFIG_MOUSE
         case evMouseDown:
             if (E.Mouse.Y == 0) {
                 int oldcur = cur;
@@ -656,7 +645,6 @@
                 }
             }
             break;
-#endif
         }
     }
     DrawHMenu(0, 0, id, -1);
diff -X dontdiff -ur fte-0.49.13.1/src/objs.inc fte-0.50.0/src/objs.inc
--- fte-0.49.13.1/src/objs.inc	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/objs.inc	2007-04-15 11:00:00.000000000 +0800
@@ -1,7 +1,6 @@
 CFTE_OBJS = \
 cfte.$(OEXT) \
-s_files.$(OEXT) \
-s_string.$(OEXT)
+s_files.$(OEXT)
 
 OBJS = \
 indent.$(OEXT) \
@@ -67,7 +66,6 @@
 s_files.$(OEXT) \
 s_direct.$(OEXT) \
 s_util.$(OEXT) \
-s_string.$(OEXT) \
 view.$(OEXT) \
 gui.$(OEXT) \
 egui.$(OEXT) \
diff -X dontdiff -ur fte-0.49.13.1/src/o_buffer.cpp fte-0.50.0/src/o_buffer.cpp
--- fte-0.49.13.1/src/o_buffer.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_buffer.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,20 +9,6 @@
 
 #include "fte.h"
 
-int EBuffer::NextCommand() {
-    if (Match.Row != -1) {
-        Draw(Match.Row, Match.Row);
-        Match.Col = Match.Row = -1;
-    }
-    if (View)
-        View->SetMsg(0);
-#ifdef CONFIG_UNDOREDO
-    return BeginUndo();
-#else
-    return 1;
-#endif
-}
-
 SearchReplaceOptions LSearch = { 0 };
 int suspendLoads = 0;
 
@@ -41,9 +27,7 @@
         if (CvsDiffView) CvsDiffView->FindFileLines(this);
 #endif
 
-#ifdef CONFIG_BOOKMARKS
         markIndex.retrieveForBuffer(this);
-#endif
 
 #ifdef CONFIG_HISTORY
         int r, c;
@@ -166,11 +150,11 @@
     case evCommand:
         switch (Event.Msg.Command) {
         case cmVScrollUp:
-            Buffer->ScrollDown(Event.Msg.Param1);
+            Buffer->ScrollDown(1);
             Event.What = evNone;
             break;
         case cmVScrollDown:
-            Buffer->ScrollUp(Event.Msg.Param1);
+            Buffer->ScrollUp(1);
             Event.What = evNone;
             break;
         case cmVScrollPgUp:
@@ -194,11 +178,11 @@
             Event.What = evNone;
             break;
         case cmHScrollLeft:
-            Buffer->ScrollRight(Event.Msg.Param1);
+            Buffer->ScrollRight(1);
             Event.What = evNone;
             break;
         case cmHScrollRight:
-            Buffer->ScrollLeft(Event.Msg.Param1);
+            Buffer->ScrollLeft(1);
             Event.What = evNone;
             break;
         case cmHScrollPgLt:
@@ -222,17 +206,14 @@
             break;
         }
         break;
-#ifdef CONFIG_MOUSE
     case evMouseDown:
     case evMouseMove:
     case evMouseAuto:
     case evMouseUp:
         HandleMouse(Event);
         break;
-#endif
     }
 }
-#ifdef CONFIG_MOUSE
 void EEditPort::HandleMouse(TEvent &Event) {
     int x, y, xx, yy, W, H;
 
@@ -260,7 +241,6 @@
             View->MView->MouseMoved = 0;
 
             if (Event.Mouse.Buttons == 1) {
-                // left mouse button down
                 Buffer->SetNearPos(xx, yy);
                 switch (Event.Mouse.Count % 5) {
                 case 1:
@@ -277,13 +257,11 @@
                 }
                 //            Window->Buffer->Redraw();
                 if (SystemClipboard) {
-                    // note: copy to second clipboard
                     Buffer->NextCommand();
-                    Buffer->BlockCopy(0, 1);
+                    Buffer->BlockCopy(0);
                 }
                 Event.What = evNone;
             } else if (Event.Mouse.Buttons == 2) {
-                // right mouse button down
                 Buffer->SetNearPos(xx, yy);
             }
             break;
@@ -291,7 +269,6 @@
         case evMouseMove:
             if (View->MView->MouseCaptured) {
                 if (Event.Mouse.Buttons == 1) {
-                    // left mouse button move
                     if (!View->MView->MouseMoved) {
                         if (Event.Mouse.KeyMask == kfCtrl) Buffer->BlockMarkColumn();
                         else if (Event.Mouse.KeyMask == kfAlt) Buffer->BlockMarkLine();
@@ -304,7 +281,6 @@
                     Buffer->SetNearPos(xx, yy);
                     Buffer->BlockExtendEnd();
                 } else if (Event.Mouse.Buttons == 2) {
-                    // right mouse button move
                     if (Event.Mouse.KeyMask == kfAlt) {
                     } else {
                         Buffer->SetNearPos(xx, yy);
@@ -326,16 +302,13 @@
                 break;
             View->MView->MouseCaptured = 0;
             if (Event.Mouse.Buttons == 1) {
-                // left mouse button up
                 if (View->MView->MouseMoved)
                     if (SystemClipboard) {
-                        // note: copy to second clipboard
                         Buffer->NextCommand();
-                        Buffer->BlockCopy(0, 1);
+                        Buffer->BlockCopy(0);
                     }
             }
             if (Event.Mouse.Buttons == 2) {
-                // right mouse button up
                 if (!View->MView->MouseMoved) {
                     EEventMap *Map = View->MView->Win->GetEventMap();
                     const char *MName = 0;
@@ -348,16 +321,14 @@
                 }
             }
             if (Event.Mouse.Buttons == 4) {
-                // middle mouse button up
                 if (SystemClipboard) {
-                    // note: copy to second clipboard
                     Buffer->NextCommand();
                     if (Event.Mouse.KeyMask == 0)
-                        Buffer->BlockPasteStream(1);
+                        Buffer->BlockPasteStream();
                     else if (Event.Mouse.KeyMask == kfCtrl)
-                        Buffer->BlockPasteColumn(1);
+                        Buffer->BlockPasteColumn();
                     else if (Event.Mouse.KeyMask == kfAlt)
-                        Buffer->BlockPasteLine(1);
+                        Buffer->BlockPasteLine();
                 }
             }
             Event.What = evNone;
@@ -365,7 +336,6 @@
         }
     }
 }
-#endif
 
 void EEditPort::UpdateView() {
     Buffer->Redraw();
@@ -428,10 +398,8 @@
     case ExMoveBlockEnd:          return MoveBlockEnd();
     case ExMoveFirstNonWhite:     return MoveFirstNonWhite();
     case ExMoveLastNonWhite:      return MoveLastNonWhite();
-#ifdef CONFIG_INDENT
     case ExMovePrevEqualIndent:   return MovePrevEqualIndent();
     case ExMoveNextEqualIndent:   return MoveNextEqualIndent();
-#endif
     case ExMovePrevTab:           return MovePrevTab();
     case ExMoveNextTab:           return MoveNextTab();
     case ExMoveTabStart:          return MoveTabStart();
@@ -458,20 +426,17 @@
     case ExKillBlock:             return KillBlock();
     case ExBackSpace:             return BackSpace();
     case ExDelete:                return Delete();
-#ifdef CONFIG_TRANS
     case ExCharCaseUp:            return CharCaseUp();
     case ExCharCaseDown:          return CharCaseDown();
     case ExCharCaseToggle:        return CharCaseToggle();
     case ExLineCaseUp:            return LineCaseUp();
     case ExLineCaseDown:          return LineCaseDown();
     case ExLineCaseToggle:        return LineCaseToggle();
-#endif
     case ExLineInsert:            return LineInsert();
     case ExLineAdd:               return LineAdd();
     case ExLineSplit:             return LineSplit();
     case ExLineJoin:              return LineJoin();
     case ExLineNew:               return LineNew();
-    case ExLineNews:              return LineNews();
     case ExLineIndent:            return LineIndent();
     case ExLineTrim:              return LineTrim();
     case ExLineCenter:            return LineCenter();
@@ -528,11 +493,9 @@
     case ExBlockMarkStream:       return BlockMarkStream();
     case ExBlockMarkLine:         return BlockMarkLine();
     case ExBlockMarkColumn:       return BlockMarkColumn();
-#ifdef CONFIG_TRANS
     case ExBlockCaseUp:           return BlockCaseUp();
     case ExBlockCaseDown:         return BlockCaseDown();
     case ExBlockCaseToggle:       return BlockCaseToggle();
-#endif
     case ExBlockExtendBegin:      return BlockExtendBegin();
     case ExBlockExtendEnd:        return BlockExtendEnd();
     case ExBlockReIndent:         return BlockReIndent();
@@ -555,13 +518,11 @@
     case ExMoveSavedPos:          return MoveSavedPos();
     case ExSavePos:               return SavePos();
     case ExCompleteWord:          return CompleteWord();
-    case ExCompleteGrep:          return CompleteGrep();   // lechee
     case ExBlockPasteStream:      return BlockPasteStream();
     case ExBlockPasteLine:        return BlockPasteLine();
     case ExBlockPasteColumn:      return BlockPasteColumn();
     case ExBlockPasteOver:        return BlockPasteOver();
     case ExShowPosition:          return ShowPosition();
-#ifdef CONFIG_FOLDS
     case ExFoldCreate:            return FoldCreate(VToR(CP.Row));
     case ExFoldDestroy:           return FoldDestroy(VToR(CP.Row));
     case ExFoldDestroyAll:        return FoldDestroyAll();
@@ -577,12 +538,9 @@
     case ExMoveFoldTop:           return MoveFoldTop();
     case ExMoveFoldPrev:          return MoveFoldPrev();
     case ExMoveFoldNext:          return MoveFoldNext();
-#endif
     case ExFileSave:              return Save();
-#ifdef CONFIG_PRINT
     case ExFilePrint:             return FilePrint();
     case ExBlockPrint:            return BlockPrint();
-#endif
     case ExBlockTrim:             return BlockTrim();
     case ExFileTrim:              return FileTrim();
     case ExHilitWord:
@@ -595,15 +553,11 @@
     case ExSearchWordNext:        return SearchWord(SEARCH_NEXT);
     case ExHilitMatchBracket:     return HilitMatchBracket();
     case ExToggleAutoIndent:      return ToggleAutoIndent();
-    case ExToggleAutoTag:         return ToggleAutoTag();
     case ExToggleInsert:          return ToggleInsert();
     case ExToggleExpandTabs:      return ToggleExpandTabs();
     case ExToggleShowTabs:        return ToggleShowTabs();
-#ifdef CONFIG_UNDOREDO
     case ExToggleUndo:            return ToggleUndo();
-#endif
     case ExToggleReadOnly:        return ToggleReadOnly();
-    case ExChangeToReadOnly:      return ChangeToReadOnly();
     case ExToggleKeepBackups:     return ToggleKeepBackups();
     case ExToggleMatchCase:       return ToggleMatchCase();
     case ExToggleBackSpKillTab:   return ToggleBackSpKillTab();
@@ -616,31 +570,25 @@
     case ExToggleShowMarkers:     return ToggleShowMarkers();
     case ExToggleHilitTags:       return ToggleHilitTags();
     case ExToggleShowBookmarks:   return ToggleShowBookmarks();
-    case ExToggleMakeBackups:     return ToggleMakeBackups();
     case ExSetLeftMargin:         return SetLeftMargin();
     case ExSetRightMargin:        return SetRightMargin();
     case ExSetIndentWithTabs:     return SetIndentWithTabs(State);
 
         // stuff with UI
     case ExMoveToLine:          return MoveToLine(State);
-    case ExFileGrepLine:        return FileGrepLine();   //lechee
     case ExMoveToColumn:        return MoveToColumn(State);
-#ifdef CONFIG_FOLDS
     case ExFoldCreateByRegexp:  return FoldCreateByRegexp(State);
-#endif
 #ifdef CONFIG_BOOKMARKS
     case ExPlaceBookmark:       return PlaceBookmark(State);
     case ExRemoveBookmark:      return RemoveBookmark(State);
     case ExGotoBookmark:        return GotoBookmark(State);
-    case ExPlaceGlobalBookmark: return PlaceGlobalBookmark(State);
-    case ExPushGlobalBookmark:  return PushGlobalBookmark();
 #else
     case ExPlaceBookmark:       return ErFAIL;
     case ExRemoveBookmark:      return ErFAIL;
     case ExGotoBookmark:        return ErFAIL;
-    case ExPlaceGlobalBookmark: return ErFAIL;
-    case ExPushGlobalBookmark:  return ErFAIL;
 #endif
+    case ExPlaceGlobalBookmark: return PlaceGlobalBookmark(State);
+    case ExPushGlobalBookmark:  return PushGlobalBookmark();
     case ExInsertString:        return InsertString(State);
     case ExSelfInsert:          return SelfInsert(State);
     case ExFileReload:          return FileReload(State);
@@ -667,7 +615,6 @@
     case ExSearchReplaceB:      return SearchReplaceB(State);
     case ExSearchReplaceRx:     return SearchReplaceRx(State);
     case ExInsertChar:          return InsertChar(State);
-    case ExInsertAdupChar:      return InsertAdupChar(State);
     case ExTypeChar:            return TypeChar(State);
     case ExChangeMode:          return ChangeMode(State);
     //case ExChangeKeys:          return ChangeKeys(State);
@@ -681,32 +628,24 @@
 #else
         return ErFAIL;
 #endif
-#ifdef CONFIG_TRANS
     case ExCharTrans:           return CharTrans(State);
     case ExLineTrans:           return LineTrans(State);
     case ExBlockTrans:          return BlockTrans(State);
-#endif
 
 #ifdef CONFIG_TAGS
     case ExTagFind:             return FindTag(State);
     case ExTagFindWord:         return FindTagWord(State);
 #endif
 
-#ifdef CONFIG_INDENT_C
     case ExSetCIndentStyle:     return SetCIndentStyle(State);
-#endif
 
     case ExBlockMarkFunction:   return BlockMarkFunction();
     case ExIndentFunction:      return IndentFunction();
     case ExMoveFunctionPrev:    return MoveFunctionPrev();
     case ExMoveFunctionNext:    return MoveFunctionNext();
-    case ExBlockComment:        return BlockComment(State);
-    case ExBlockUnComment:      return BlockUnComment(State);
     case ExInsertDate:          return InsertDate(State);
     case ExInsertUid:           return InsertUid();
-#ifdef CONFIG_HELP
     case ExShowHelpWord:        return ShowHelpWord(State);
-#endif
     }
     return EModel::ExecCommand(Command, State);
 }
@@ -729,11 +668,6 @@
     return SetNearPosR(CP.Col, No - 1);
 }
 
-int EBuffer::FileGrepLine() {
-    if (GrepLine==0) return 0;
-    return SetNearPosR(CP.Col, GrepLine - 1);
-}
-
 int EBuffer::MoveToColumn(ExState &State) {
     int No = 0;
 
@@ -747,7 +681,6 @@
     return SetNearPos(No - 1, CP.Row);
 }
 
-#ifdef CONFIG_FOLDS
 int EBuffer::FoldCreateByRegexp(ExState &State) {
     char strbuf[1024] = "";
 
@@ -756,7 +689,6 @@
     }
     return FoldCreateByRegexp(strbuf);
 }
-#endif
 
 #ifdef CONFIG_BOOKMARKS
 int EBuffer::PlaceUserBookmark(const char *n,EPoint P) {
@@ -862,6 +794,7 @@
         if (View->MView->Win->GetStr("Goto Bookmark", sizeof(name), name, HIST_BOOKMARK) == 0) return 0;
     return GotoUserBookmark(name);
 }
+#endif
 
 int EBuffer::PlaceGlobalBookmark(ExState &State) {
     char name[256] = "";
@@ -886,7 +819,6 @@
          Msg(S_INFO, "Placed bookmark %s", m->getName());
     return m ? 1 : 0;
 }
-#endif
 
 int EBuffer::InsertChar(ExState &State) {
     char Ch;
@@ -904,25 +836,6 @@
     return InsertChar(Ch);
 }
 
-int EBuffer::InsertAdupChar(ExState &State) {
-    unsigned char CurCh = 0xFF;
-    int CurLine;
-    int CurColumn;
-    int ActLine;
-    int CurPos;
-
-    if (CP.Row>0) {
-        CurLine = CP.Row -1;
-        ActLine = VToR(CP.Row-1);
-        CurColumn = CP.Col;
-        if (CurColumn>LineLen(VToR(CP.Row-1))-1) return 0;
-        CurPos = CharOffset(RLine(ActLine),CurColumn);
-        CurCh = VLine(CurLine)->Chars[CurPos];
-        return InsertChar(CurCh);
-    } else return 0;
-}
-
-
 int EBuffer::TypeChar(ExState &State) {
     char Ch;
     int No;
@@ -980,7 +893,7 @@
 int EBuffer::FileSaveAs(char *FName) {
     char Name[MAXPATH];
 
-    if (ExpandPath(FName, Name, sizeof(Name)) == -1) {
+    if (ExpandPath(FName, Name) == -1) {
         View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Invalid path: %s.", FName);
         return 0;
     }
@@ -1024,7 +937,7 @@
 int EBuffer::FileWriteTo(char *FName) {
     char Name[MAXPATH];
 
-    if (ExpandPath(FName, Name, sizeof(Name)) == -1) {
+    if (ExpandPath(FName, Name) == -1) {
         View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Invalid path: %s.", FName);
         return 0;
     }
@@ -1064,12 +977,12 @@
     char Name[MAXPATH];
     char FName[MAXPATH];
 
-    if (JustDirectory(FileName, FName, sizeof(FName)) == -1) return 0;
+    if (JustDirectory(FileName, FName) == -1) return 0;
     SlashDir(FName);
     if (State.GetStrParam(View, FName, sizeof(FName)) == 0)
         if (View->MView->Win->GetFile("Read block", sizeof(FName), FName, HIST_PATH, GF_OPEN) == 0) return 0;
 
-    if (ExpandPath(FName, Name, sizeof(Name)) == -1) {
+    if (ExpandPath(FName, Name) == -1) {
         View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Invalid path: %s.", FName);
         return 0;
     }
@@ -1097,13 +1010,13 @@
     char FName[MAXPATH];
     int Append = 0;
 
-    if (JustDirectory(FileName, FName, sizeof(FName)) == -1) return 0;
+    if (JustDirectory(FileName, FName) == -1) return 0;
     SlashDir(FName);
     if (State.GetStrParam(View, FName, sizeof(FName)) == 0)
         if (View->MView->Win->GetFile("Write block", sizeof(FName), FName, HIST_PATH, GF_SAVEAS) == 0)
             return 0;
 
-    if (ExpandPath(FName, Name, sizeof(Name)) == -1) {
+    if (ExpandPath(FName, Name) == -1) {
         View->MView->Win->Choice(GPC_ERROR, "Error", 1, "O&K", "Invalid path: %s.", FName);
         return 0;
     }
@@ -1432,17 +1345,17 @@
     AName[MaxLen - 1] = 0;
 }
 
-void EBuffer::GetPath(char *APath, int MaxLen) {
-    JustDirectory(FileName, APath, MaxLen);
+void EBuffer::GetPath(char *APath, int /*MaxLen*/) {
+    JustDirectory(FileName, APath);
 }
 
 void EBuffer::GetInfo(char *AInfo, int /*MaxLen*/) {
     char buf[256] = {0};
     char winTitle[256] = {0};
 
-    JustFileName(FileName, buf, sizeof(buf));
+    JustFileName(FileName, buf);
     if (buf[0] == '\0') // if there is no filename, try the directory name.
-        JustLastDirectory(FileName, buf, sizeof(buf));
+        JustLastDirectory(FileName, buf);
 
     if (buf[0] != 0) // if there is a file/dir name, stick it in here.
     {
@@ -1547,50 +1460,6 @@
 }
 #endif
 
-int EBuffer::BlockComment(ExState &State) {
-    char strbuf[512] = "";
-    EPoint B,E;
-    int L;
-
-    if ((CheckBlock() == 0)||(RCount ==0)) {
-       Msg(S_INFO,">>This operator only work as block mode!!!");
-       return 0;
-    }
-    B = BB;
-    E = BE;
-    for (L = B.Row; L <= E.Row; L++) {
-	SetNearPosR(0, L);
-    	strcpy(strbuf,BFS(this, BFS_CommentPat));
-        InsertString(strbuf,strlen(strbuf));
-    }
-    BlockUnmark();
-
-    return 1;
-}
-
-int EBuffer::BlockUnComment(ExState &State) {
-
-    char strbuf[512]="";
-    EPoint B,E;
-    int L;
-    if ((CheckBlock() == 0)||(RCount ==0)) {
-       Msg(S_INFO,">>This operator only work as block mode!!!");
-       return 0;
-    }
-    B = BB;
-    E = BE;
-    strcpy(strbuf,BFS(this, BFS_CommentPat));
-    if (!strlen(strbuf)) {
-       Msg(S_INFO,">>No comment define for this file type!!!");
-    }
-    for (L = B.Row; L <= E.Row; L++) {
-
-    }
-
-    return 1;
-}
-
-
 // these two will probably be replaced in the future
 int EBuffer::InsertDate(ExState &State) {
     char strArg[128] = "";
@@ -1630,7 +1499,6 @@
     return InsertString(p, strlen(p));
 }
 
-#ifdef CONFIG_HELP
 int EBuffer::ShowHelpWord(ExState &State) {
     //** Code for BlockSelectWord to find the word under the cursor,
     const char *achr = "+-_."; // these are accepted characters
@@ -1676,7 +1544,6 @@
     //}
     return View->SysShowHelp(State, buf[0] ? buf : 0);
 }
-#endif
 
 int EBuffer::GetStrVar(int var, char *str, int buflen) {
     assert(buflen >= 0);
@@ -1691,25 +1558,25 @@
         return 1;
 
     case mvFileName:
-        JustFileName(FileName, str, buflen);
+        JustFileName(FileName, str);
         return 1;
 
     case mvFileDirectory:
-        JustDirectory(FileName, str, buflen);
+        JustDirectory(FileName, str);
         return 1;
     case mvFileBaseName:
         {
             char buf[MAXPATH];
             char *dot, *dot2;
 
-            JustFileName(FileName, buf, sizeof(buf));
+            JustFileName(FileName, buf);
 
             dot = strchr(buf, '.');
             while ((dot2 = strchr(dot + 1, '.')) != NULL)
                 dot = dot2;
             if (dot)
                 *dot = 0;
-            strlcpy(str, buf, buflen);
+            strcpy(str, buf);
         }
         return 1;
 
@@ -1718,112 +1585,26 @@
             char buf[MAXPATH];
             char *dot, *dot2;
 
-            JustFileName(FileName, buf, sizeof(buf));
+            JustFileName(FileName, buf);
+
             dot = strchr(buf, '.');
             while ((dot2 = strchr(dot + 1, '.')) != NULL)
                 dot = dot2;
             if (dot)
                 strcpy(str, dot);
-//                strlcpy(str, dot, buflen);
             else
                 str[0] = 0;
         }
         return 1;
 
     case mvChar:
-        {
-            PELine L;
-            int P;
-
-            L = RLine(CP.Row);
-            P = CharOffset(L, CP.Col);
-
-            strlcpy(str, "", buflen);
-
-            if (ChClass(L->Chars[P]))
-            {
-                char tmp[2];
-
-                // make copy of character
-                tmp[0] = L->Chars[P];
-                tmp[1] = 0;
-
-                strlcat(str, tmp, buflen);
-            }
-        }
-        return 1;
-
     case mvWord:
-        {
-            PELine L;
-            int P, C;
-            int wordBegin, wordEnd;
-
-            L = RLine(CP.Row);
-            P = CharOffset(L, CP.Col);
-
-            strlcpy(str, "", buflen);
-
-            if (ChClass(L->Chars[P]))
-            {
-                C = ChClassK(L->Chars[P]);
-
-                // search start of word
-                while ((P>0) && (C == ChClassK(L->Chars[P-1]))) P--;
-
-                wordBegin = P;
-
-                // search end of word
-                while ((P< L->Count) && (C == ChClassK(L->Chars[P]))) P++;
-
-                wordEnd = P;
-
-                // calculate total length for buffer copy
-                int length = wordEnd - wordBegin;
-
-                if ((length + 1) < buflen)
-                {
-                    length++;
-                } else
-                {
-                    length = buflen;
-                }
-
-                // copy word to buffer
-                strlcpy(str, &L->Chars[wordBegin], length);
-            }
-        }
-        return 1;
-
     case mvLine:
-        {
-            PELine L;
-
-            L = RLine(CP.Row);
-
-            strlcpy(str, "", buflen);
-
-            if (L->Count > 0)
-            {
-                // calculate total length for buffer copy
-                int length = L->Count;
-
-                if ((length + 1) < buflen)
-                {
-                    length++;
-                } else
-                {
-                    length = buflen;
-                }
-
-                // copy word to buffer
-                strlcpy(str, L->Chars, length);
-            }
-        }
-        return 1;
+        return 0;
 
     case mvFTEVer:
-        strlcpy(str, VERSION, buflen);
+        strncpy(str, VERSION, buflen);
+        str[buflen - 1] = 0;
         return 1;
     }
 
diff -X dontdiff -ur fte-0.49.13.1/src/o_buflist.cpp fte-0.50.0/src/o_buflist.cpp
--- fte-0.49.13.1/src/o_buflist.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_buflist.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,8 +9,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_OBJ_BUFFERS
-
 BufferView *BufferList = 0;
 
 BufferView::BufferView(int createFlags, EModel **ARoot): EList(createFlags, ARoot, "Buffers") {
@@ -263,4 +261,3 @@
     strncpy(ASTitle, "Buffers", SMaxLen);
     ASTitle[SMaxLen - 1] = 0;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/o_cvsdiff.cpp fte-0.50.0/src/o_cvsdiff.cpp
--- fte-0.49.13.1/src/o_cvsdiff.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_cvsdiff.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -92,7 +92,7 @@
 int ECvsDiff::BlockCopy (int Append) {
     if (SSBuffer==0) return ErFAIL;
     if (Append) {
-        if (SystemClipboard) GetPMClip(0);
+        if (SystemClipboard) GetPMClip ();
     } else SSBuffer->Clear ();
     SSBuffer->BlockMode=bmLine;
     // How to set these two ?
@@ -112,7 +112,7 @@
             last=i;
         }
     }
-    if (SystemClipboard) PutPMClip (0);
+    if (SystemClipboard) PutPMClip ();
     return ErOK;
 }
 
diff -X dontdiff -ur fte-0.49.13.1/src/o_directory.cpp fte-0.50.0/src/o_directory.cpp
--- fte-0.49.13.1/src/o_directory.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_directory.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -7,22 +7,17 @@
  *
  */
 
+#define NEED_LOG_H
 #include "fte.h"
-#ifdef CONFIG_OBJ_DIRECTORY
-#include "log.h"
-#include "s_files.h"
-#include "s_util.h"
-#include "o_directory.h"
-#include "c_commands.h"
-#include "c_history.h"
 
+#ifdef CONFIG_OBJ_DIRECTORY
 EDirectory::EDirectory(int createFlags, EModel **ARoot, char *aPath): EList(createFlags, ARoot, aPath) {
     char XPath[MAXPATH];
 
     Files = 0;
     FCount = 0;
     SearchLen = 0;
-    ExpandPath(aPath, XPath, sizeof(XPath));
+    ExpandPath(aPath, XPath);
     Slash(XPath, 1);
     Path = strdup(XPath);
     RescanList();
@@ -64,18 +59,8 @@
             Year = Mon = Day = Hour = Min = Sec = 0;
         }
 
-//        sprintf(s, " %04d/%02d/%02d %02d:%02d:%02d %8ld ",
-//                Year, Mon, Day, Hour, Min, Sec, Files[Line]->Size());
-        char SizeStr[16];
-        if (Files[Line]->Size() > 999999999)
-            sprintf(SizeStr, "%8s", "Very BIG");
-        else if (Files[Line]->Size() > 99999999)
-            sprintf(SizeStr, "%8s", "BIG");
-        else
-            sprintf(SizeStr, "%8ld", (long) Files[Line]->Size());
-
-        sprintf(s, " %04d/%02d/%02d %02d:%02d:%02d %s ",
-                Year, Mon, Day, Hour, Min, Sec, SizeStr);
+        sprintf(s, " %04d/%02d/%02d %02d:%02d:%02d %8ld ",
+                Year, Mon, Day, Hour, Min, Sec, Files[Line]->Size());
 
         strcat(s, Files[Line]->Name());
         s[strlen(s) + 1] = '\0';
@@ -117,8 +102,8 @@
 
     Count = 0;
     FCount = 0;
-    if (JustDirectory(Path, Dir, sizeof(Dir)) != 0) return;
-    JustFileName(Path, Name, sizeof(Name));
+    if (JustDirectory(Path, Dir) != 0) return;
+    JustFileName(Path, Name);
 
     // we don't want any special information about symbolic links, just to browse files
     ff = new FileFind(Dir, "*", ffDIRECTORY | ffHIDDEN | ffLINK);
@@ -177,7 +162,7 @@
 int EDirectory::isDir(int No) {
     char FilePath[256];
 
-    JustDirectory(Path, FilePath, sizeof(FilePath));
+    JustDirectory(Path, FilePath);
     Slash(FilePath, 1);
     strcat(FilePath, Files[No]->Name());
     return IsDirectory(FilePath);
@@ -365,15 +350,15 @@
     char CName[256] = "";
 
     if (strcmp(Name, SSLASH) == 0) {
-        JustRoot(Path, Dir, sizeof(Dir));
+        JustRoot(Path, Dir);
     } else if (strcmp(Name, SDOT SDOT) == 0) {
         Slash(Path, 0);
-        JustFileName(Path, CName, sizeof(CName));
-        JustDirectory(Path, Dir, sizeof(Dir));
+        JustFileName(Path, CName);
+        JustDirectory(Path, Dir);
     } else {
-        JustDirectory(Path, Dir, sizeof(Dir));
+        JustDirectory(Path, Dir);
         Slash(Dir, 1);
-        strlcat(Dir, Name, sizeof(Dir));
+        strcat(Dir, Name);
     }
     Slash(Dir, 1);
     free(Path);
@@ -432,7 +417,7 @@
 int EDirectory::FmLoad(const char *Name, EView *XView) {
     char FilePath[256];
 
-    JustDirectory(Path, FilePath, sizeof(FilePath));
+    JustDirectory(Path, FilePath);
     Slash(FilePath, 1);
     strcat(FilePath, Name);
     return FileLoad(0, FilePath, NULL, XView);
@@ -454,9 +439,9 @@
     char buf[256] = {0};
     char winTitle[256] = {0};
 
-    JustFileName(Path, buf, sizeof(buf));
+    JustFileName(Path, buf);
     if (buf[0] == '\0') // if there is no filename, try the directory name.
-        JustLastDirectory(Path, buf, sizeof(buf));
+        JustLastDirectory(Path, buf);
 
     if (buf[0] != 0) // if there is a file/dir name, stick it in here.
     {
@@ -478,17 +463,17 @@
             Path);*/
 }
 
-void EDirectory::GetTitle(char *ATitle, int MaxLen, char *ASTitle, int SMaxLen) {
+void EDirectory::GetTitle(char *ATitle, int MaxLen, char *ASTitle, int /*SMaxLen*/) {
 
     strncpy(ATitle, Path, MaxLen - 1);
     ATitle[MaxLen - 1] = 0;
 
     {
         char P[MAXPATH];
-        strlcpy(P, Path, sizeof(P));
+        strcpy(P, Path);
         Slash(P, 0);
 
-        JustDirectory(P, ASTitle, SMaxLen);
+        JustDirectory(P, ASTitle);
         Slash(ASTitle, 1);
     }
 }
@@ -502,7 +487,7 @@
         if (View->MView->Win->GetStr("Set directory", sizeof(Dir), Dir, HIST_PATH) == 0)
             return 0;
     }
-    if (ExpandPath(Dir, Dir2, sizeof(Dir2)) == -1)
+    if (ExpandPath(Dir, Dir2) == -1)
         return 0;
 #if 0
     // is this needed for other systems as well ?
diff -X dontdiff -ur fte-0.49.13.1/src/o_list.cpp fte-0.50.0/src/o_list.cpp
--- fte-0.49.13.1/src/o_list.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_list.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,7 +9,6 @@
 
 #include "fte.h"
 
-#ifdef CONFIG_OBJ_LIST
 EListPort::EListPort(EList *L, EView *V): EViewPort(V) {
     List = L;
     OldTopRow = OldLeftCol = OldRow = OldCount = -1;
@@ -48,11 +47,11 @@
     case evCommand:
         switch (Event.Msg.Command) {
         case cmVScrollUp:
-            List->ScrollDown(Event.Msg.Param1);
+            List->ScrollDown(1);
             Event.What = evNone;
             break;
         case cmVScrollDown:
-            List->ScrollUp(Event.Msg.Param1);
+            List->ScrollUp(1);
             Event.What = evNone;
             break;
         case cmVScrollPgUp:
@@ -74,11 +73,11 @@
             Event.What = evNone;
             break;
         case cmHScrollLeft:
-            List->ScrollRight(Event.Msg.Param1);
+            List->ScrollRight(1);
             Event.What = evNone;
             break;
         case cmHScrollRight:
-            List->ScrollLeft(Event.Msg.Param1);
+            List->ScrollLeft(1);
             Event.What = evNone;
             break;
         case cmHScrollPgLt:
@@ -95,18 +94,15 @@
             break;
         }
         break;
-#ifdef CONFIG_MOUSE
     case evMouseDown:
     case evMouseUp:
     case evMouseMove:
     case evMouseAuto:
         HandleMouse(Event);
-#endif
         break;
     }
 }
- 
-#ifdef CONFIG_MOUSE
+
 void EListPort::HandleMouse(TEvent &Event) {
     int W, H;
     int x, y, xx, yy;
@@ -181,7 +177,6 @@
         break;
     }
 }
-#endif
 
 void EListPort::UpdateView() {
     if (OldLeftCol != LeftCol || OldTopRow != TopRow || OldCount != List->Count)
@@ -714,4 +709,3 @@
     }
     return ErOK;
 }
-#endif
diff -X dontdiff -ur fte-0.49.13.1/src/o_list.h fte-0.50.0/src/o_list.h
--- fte-0.49.13.1/src/o_list.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_list.h	2007-04-15 11:00:00.000000000 +0800
@@ -24,9 +24,7 @@
     void GetPos();
     
     virtual void HandleEvent(TEvent &Event);
-#ifdef CONFIG_MOUSE
     virtual void HandleMouse(TEvent &Event);
-#endif
 
     void PaintView(int PaintAll);
     
diff -X dontdiff -ur fte-0.49.13.1/src/o_messages.cpp fte-0.50.0/src/o_messages.cpp
--- fte-0.49.13.1/src/o_messages.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_messages.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -134,10 +134,8 @@
     if (P.Row < 0)
         P.Row = 0;
 
-#ifdef CONFIG_BOOKMARKS
     if (B->PlaceBookmark(bk, P) == 1)
         ErrList[err]->Buf = B;
-#endif
 }
 
 void EMessages::FindFileErrors(EBuffer *B) {
@@ -248,9 +246,7 @@
             if (ErrList[i]->Buf != 0) {
                 char bk[16];
                 sprintf(bk, "_MSG.%d", i);
-#ifdef CONFIG_BOOKMARKS
                 ((EBuffer *)(ErrList[i]->Buf))->RemoveBookmark(bk);
-#endif
             }
             free(ErrList[i]->msg);
             free(ErrList[i]->text);
@@ -402,7 +398,7 @@
                         strcpy(fn1, curr_dir->name);
                     Slash(fn1, 1);
                     strcat(fn1, fn);
-                    if (ExpandPath(fn1, fn2, sizeof(fn2)) == 0)
+                    if (ExpandPath(fn1, fn2) == 0)
                         file = fn2;
                     else
                         file = fn1;
@@ -548,9 +544,7 @@
                 V->SwitchToModel(ErrList[err]->Buf);
 
                 sprintf(bk, "_MSG.%d", err);
-#ifdef CONFIG_BOOKMARKS
                 ErrList[err]->Buf->GotoBookmark(bk);
-#endif
             } else {
                 if (FileLoad(0, ErrList[err]->file, 0, V) == 1) {
                     V->SwitchToModel(ActiveModel);
diff -X dontdiff -ur fte-0.49.13.1/src/o_messages.h fte-0.50.0/src/o_messages.h
--- fte-0.49.13.1/src/o_messages.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_messages.h	2007-04-15 11:00:00.000000000 +0800
@@ -64,7 +64,6 @@
     int GetLine(char *Line, int maxim);
     void GetErrors();
     int Compile(char *Command);
-    int Grep(char *Command);
     void ShowError(EView *V, int err);
     void DrawLine(PCell B, int Line, int Col, ChColor color, int Width);
     char* FormatLine(int Line);
diff -X dontdiff -ur fte-0.49.13.1/src/o_model.h fte-0.50.0/src/o_model.h
--- fte-0.49.13.1/src/o_model.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_model.h	2007-04-15 11:00:00.000000000 +0800
@@ -101,7 +101,6 @@
     void SetModel(EModel *AModel);
     void SelectModel(EModel *AModel);
     void SwitchToModel(EModel *AModel);
-    int KillFileGrp();
 
     void Activate(int GotFocus);
 
@@ -125,8 +124,6 @@
     int FileLast();
     int FileSaveAll();
     int FileOpen(ExState &State);
-    int FileCheck(ExState &State);
-    int FileGrepName();
     int FileOpenInMode(ExState &State);
     int SetPrintDevice(ExState &State);
     int ToggleSysClipboard(ExState &State);
@@ -137,11 +134,8 @@
 #endif
 #ifdef CONFIG_OBJ_MESSAGES
     int Compile(ExState &State);
-    int Grep(ExState &State);
-    int vGrep(ExState &State);
     int RunCompiler(ExState &State);
     int Compile(char *Command);
-    int Grep(char *Command);
     int ViewMessages(ExState &State);
     int CompilePrevError(ExState &State);
     int CompileNextError(ExState &State);
diff -X dontdiff -ur fte-0.49.13.1/src/o_modemap.cpp fte-0.50.0/src/o_modemap.cpp
--- fte-0.49.13.1/src/o_modemap.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/o_modemap.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -8,7 +8,6 @@
  */
 
 #include "fte.h"
-#ifdef CONFIG_OBJ_MODEMAP
 #include "o_modemap.h"
 
 EventMapView *TheEventMapView = 0;
@@ -35,7 +34,7 @@
         strcpy(KeyName, aPrefix);
         strcat(KeyName, "_");
     }
-    GetKeyName(KeyName + strlen(KeyName), sizeof(KeyName)-strlen(KeyName), Key->fKey);
+    GetKeyName(KeyName + strlen(KeyName), Key->fKey);
     sprintf(Entry, "%13s   ", KeyName);
     id = Key->Cmd;
     for (int i = 0; i < Macros[id].Count; i++) {
@@ -77,7 +76,7 @@
                 strcpy(Prefix, aPrefix);
                 strcat(Prefix, "_");
             }
-            GetKeyName(Prefix + strlen(Prefix), sizeof(Prefix)-strlen(Prefix), Key->fKey);
+            GetKeyName(Prefix + strlen(Prefix), Key->fKey);
             DumpMap(Prefix, Key->fKeyMap);
         } else {
             DumpKey(aPrefix, Key);
@@ -180,5 +179,4 @@
     strncpy(ASTitle, "EventMapView", SMaxLen);
     ASTitle[SMaxLen - 1] = 0;
 }
-#endif
 
diff -X dontdiff -ur fte-0.49.13.1/src/s_files.cpp fte-0.50.0/src/s_files.cpp
--- fte-0.49.13.1/src/s_files.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/s_files.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -9,8 +9,6 @@
 
 #include "sysdep.h"
 #include "s_files.h"
-#include "s_util.h"
-#include "s_string.h"
 
 #if defined(OS2)
 #define INCL_DOS
@@ -153,7 +151,7 @@
 #if PATHTYPE == PT_UNIXISH
                 if (Path[0] == '~') {
                     char Expanded[MAXPATH];
-                    if (ExpandPath(Path, Expanded, sizeof(Expanded)) == -1) return 0;
+                    if (ExpandPath(Path, Expanded) == -1) return 0;
                     res = stat(Expanded, &statbuf);
                 } else
 #endif
@@ -267,7 +265,7 @@
 }
 #endif
 
-int ExpandPath(const char *Path, char *Expand, int ExpandSize) {
+int ExpandPath(const char *Path, char *Expand) {
     char Name[MAXPATH];
 
     if (Path[0] == 0) {
@@ -277,7 +275,7 @@
 #if PATHTYPE == PT_DOSISH
     int slashed = 0;
 
-    strlcpy(Name, Path, sizeof(Name));
+    strcpy(Name, Path);
     if (Name[0] != 0)
         slashed = ISSLASH(Name[strlen(Name)-1]);
     Slash(Name, 0);
@@ -288,7 +286,7 @@
     if (Name[0] && Name[1] == ':' && Name[2] == 0) { // '?:'
         int drive = Name[0];
 
-        strlcpy(Expand, Name, ExpandSize);
+        strcpy(Expand, Name);
         Expand[2] = '\\';
         Expand[3] = 0;
 
@@ -323,14 +321,15 @@
     char Name2[MAXPATH];
     char *path, *p;
 
-    strlcpy(Name, Path, sizeof(Name));
+    strcpy(Name, Path);
     switch (Name[0]) {
     case SLASH:
         break;
     case '~':
         if (Name[1] == SLASH || Name[1] == 0) {
             path = Name + 1;
-            strlcpy(Name2, getenv("HOME"), sizeof(Name2));
+	    strncpy(Name2, getenv("HOME"), sizeof(Name2) - 1);
+            Name2[sizeof(Name2) - 1] = 0;
         } else {
             struct passwd *pwd;
 
@@ -346,17 +345,17 @@
             pwd = getpwnam(Name + 1);
             if (pwd == NULL)
                 return -1;
-            strlcpy(Name2, pwd->pw_dir, sizeof(Name2));
+            strcpy(Name2, pwd->pw_dir);
         }
         if (path[0] != SLASH)
             Slash(Name2, 1);
-        strlcat(Name2, path, sizeof(Name2));
-        strlcpy(Name, Name2, sizeof(Name));
+        strcat(Name2, path);
+        strcpy(Name, Name2);
         break;
     default:
         if (getcwd(Name, MAXPATH) == NULL) return -1;
         Slash(Name, 1);
-        strlcat(Name, Path, sizeof(Name));
+        strcat(Name, Path);
         break;
     }
     return RemoveDots(Name, Expand);
@@ -366,60 +365,50 @@
 int IsSameFile(const char *Path1, const char *Path2) {
     char p1[MAXPATH], p2[MAXPATH];
 
-    if (ExpandPath(Path1, p1, sizeof(p1)) == -1) return -1;
-    if (ExpandPath(Path2, p2, sizeof(p2)) == -1) return -1;
+    if (ExpandPath(Path1, p1) == -1) return -1;
+    if (ExpandPath(Path2, p2) == -1) return -1;
     if (filecmp(p1, p2) == 0) return 1;
     return 0;
 }
 
-int JustDirectory(const char *Path, char *Dir, int DirSize) {
+int JustDirectory(const char *Path, char *Dir) {
     char *p;
 
-    if (ExpandPath(Path, Dir, DirSize) == -1)
-        strlcpy(Dir, Path, DirSize);
+    if (ExpandPath(Path, Dir) == -1)
+        strcpy(Dir, Path);
     p = SepRChr(Dir);
     if (p) { p[1] = 0; }
     else Dir[0] = 0;
     return 0;
 }
 
-int JustLastDirectory(const char *Path, char *Dir, int DirSize) {
+int JustLastDirectory(const char *Path, char *Dir) {
     int lastSlash = strlen(Path);
     while (lastSlash > 0 && !ISSEP(Path[lastSlash])) lastSlash--;
 
     int secondLastSlash = lastSlash;
     while (secondLastSlash > 0 && !ISSEP(Path[secondLastSlash - 1])) secondLastSlash--;
 
-    if ((lastSlash - secondLastSlash) >= (DirSize-1))
-    {
-        // how unfortunate, we didn't have enough space for directory name
-        // just copy as many characters as possible while leaving room for NUL.
-        lastSlash = secondLastSlash + DirSize - 2;
-    }
-
     strncpy(Dir, Path + secondLastSlash, lastSlash - secondLastSlash);
     Dir[lastSlash - secondLastSlash] = 0;
 
     return 0;
 }
 
-int JustFileName(const char *Path, char *Name, int NameSize) {
+int JustFileName(const char *Path, char *Name) {
     int len = strlen(Path);
 
     while (len > 0 && !ISSEP(Path[len - 1])) len--;
-    strlcpy(Name, Path + len, NameSize);
+    strcpy(Name, Path + len);
     return 0;
 }
 
-int JustRoot(const char *Path, char *Root, int RootSize) {
+int JustRoot(const char *Path, char *Root) {
 #if PATHTYPE == PT_UNIXISH
-    strlcpy(Root, SSLASH, RootSize);
+    strcpy(Root, SSLASH);
 #else
-    if (RootSize >= 4)
-    {
-        strncpy(Root, Path, 3);
-        Root[3] = 0;
-    }
+    strncpy(Root, Path, 3);
+    Root[3] = 0;
 #endif
     return 0;
 }
@@ -445,12 +434,10 @@
     int l1;
 
     if (len < 10) len = 10;
-    if (len > (sizeof(P) - 1)) len = sizeof(P) - 1;
-
-    if (ExpandPath(Path, p1, sizeof(p1)) == -1) return Path;
+    if (ExpandPath(Path, p1) == -1) return Path;
     l1 = strlen(p1);
     if (l1 < len) {
-        strlcpy(P, p1, sizeof(P));
+        strcpy(P, p1);
     } else {
         strncpy(P, p1, 3);
         strcpy(P + 3, "...");
@@ -492,19 +479,19 @@
 
 // Returns relative path of Path with respect to Dir
 // Ex: Dir = /home/martin/src/ Path = /home/martin/src/Fte/s_files.cpp -> Fte/s_files.cpp
-int RelativePathName(const char *Dir, const char *Path, char *RelPath, int RelPathSize) {
+int RelativePathName(const char *Dir, const char *Path, char *RelPath) {
     char d[MAXPATH], p[MAXPATH], c;
     int dl, pl;
 
-    if (ExpandPath(Dir, d, sizeof(d)) == -1) return -1;
-    if (ExpandPath(Path, p, sizeof(p)) == -1) return -1;
+    if (ExpandPath(Dir, d) == -1) return -1;
+    if (ExpandPath(Path, p) == -1) return -1;
     dl = strlen (d); pl = strlen (p);
 
     if (dl <= pl) {
         c = p[dl]; p[dl] = 0;
         if (filecmp(d, p) == 0) {
             p[dl] = c;
-            strlcpy(RelPath, p + dl, RelPathSize);
+            strcpy(RelPath, p + dl);
             return 0;
         }
     }
diff -X dontdiff -ur fte-0.49.13.1/src/s_files.h fte-0.50.0/src/s_files.h
--- fte-0.49.13.1/src/s_files.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/s_files.h	2007-04-15 11:00:00.000000000 +0800
@@ -35,13 +35,13 @@
 
 char *Slash(char *Path, int Add);
 char *SlashDir(char *Path);
-int ExpandPath(const char *Path, char *Expanded, int ExpandSize);
+int ExpandPath(const char *Path, char *Expanded);
 int CompletePath(const char *Path, char *Completed, int Num);
 int IsSameFile(const char *Path1, const char *Path2);
-int JustDirectory(const char *Path, char *Dir, int DirSize);
-int JustFileName(const char *Path, char *Name, int NameSize);
-int JustLastDirectory(const char *Path, char *Dir, int DirSize);
-int JustRoot(const char *Path, char *Root, int RootSize);
+int JustDirectory(const char *Path, char *Dir);
+int JustFileName(const char *Path, char *Name);
+int JustLastDirectory(const char *Path, char *Dir);
+int JustRoot(const char *Path, char *Root);
 int FileExists(const char *Path);
 int IsFullPath(const char *Path);
 int IsDirectory(const char *Path);
diff -X dontdiff -ur fte-0.49.13.1/src/s_util.cpp fte-0.50.0/src/s_util.cpp
--- fte-0.49.13.1/src/s_util.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/s_util.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -14,7 +14,6 @@
 
 extern RxNode *CompletionFilter;
 
-#ifdef CONFIG_BACKUP
 // should use DosCopy under OS/2...
 int copyfile(char *f1, char *f2) { // from F1 to F2
     void *buffer;
@@ -82,7 +81,6 @@
 
     return NULL;
 }
-#endif
 
 int GetCharFromEvent(TEvent &E, char *Ch) {
     *Ch = 0;
@@ -119,9 +117,9 @@
     int rc;
 
     if (strcmp(Base, "") == 0) {
-        if (ExpandPath(".", Name, sizeof(Name)) != 0) return -1;
+        if (ExpandPath(".", Name) != 0) return -1;
     } else {
-        if (ExpandPath(Base, Name, sizeof(Name)) != 0) return -1;
+        if (ExpandPath(Base, Name) != 0) return -1;
     }
 //    SlashDir(Name);
     dirp = Name;
@@ -209,3 +207,65 @@
     }
     return count;
 }
+
+int UnTabStr(char *dest, int maxlen, const char *source, int slen) {
+    char *p = dest;
+    int i;
+    int pos = 0;
+
+    maxlen--;
+    for (i = 0; i < slen; i++) {
+        if (maxlen > 0) {
+            if (source[i] == '\t') {
+                do {
+                    if (maxlen > 0) {
+                        *p++ = ' ';
+                        maxlen--;
+                    }
+                    pos++;
+                } while (pos & 0x7);
+            } else {
+                *p++ = source[i];
+                pos++;
+                maxlen--;
+            }
+        } else
+            break;
+    }
+
+    //dest[pos] = 0;
+    *p = '\0';
+    return pos;
+}
+
+#if !defined(HAVE_STRLCPY)
+size_t strlcpy(char *dst, const char *src, size_t size)
+{
+    size_t ret = strlen(src);
+
+    if (size) {
+        size_t len = (ret >= size) ? size-1 : ret;
+        memcpy(dst, src, len);
+        dst[len] = '\0';
+    }
+
+    return ret;
+}
+#endif // !HAVE_STRLCPY
+
+#if !defined(HAVE_STRLCAT)
+size_t strlcat(char *dst, const char *src, size_t size)
+{
+    size_t dst_len = strlen(dst);
+    size_t src_len = strlen(src);
+
+    if (size) {
+        size_t len = (src_len >= size-dst_len) ? (size-dst_len-1) : src_len;
+        memcpy(&dst[dst_len], src, len);
+        dst[dst_len + len] = '\0';
+    }
+
+    return dst_len + src_len;
+}
+#endif // !HAVE_STRLCAT
+
diff -X dontdiff -ur fte-0.49.13.1/src/s_util.h fte-0.50.0/src/s_util.h
--- fte-0.49.13.1/src/s_util.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/s_util.h	2007-04-15 11:00:00.000000000 +0800
@@ -7,8 +7,8 @@
  *
  */
 
-#ifndef __S_UTIL_H__
-#define __S_UTIL_H__
+#ifndef __EDITOR_H__
+#define __EDITOR_H__
 
 #define USE_CtrlEnter    1
 
@@ -19,16 +19,27 @@
 
 class EView;
 class EBuffer;
-class EModel;
 
 char* MakeBackup(char *FileName, char *NewName);
 
-int GetPMClip(int clipboard);
-int PutPMClip(int clipboard);
+int GetPMClip();
+int PutPMClip();
 
 int FileLoad(int createFlags, const char *FileName, const  char *Mode, EView *View);
 int MultiFileLoad(int createFlags, const char *FileName, const char *Mode, EView *View);
+int ParseSearchOption(int replace, char c, unsigned long &opt);
+int ParseSearchOptions(int replace, const char *str, unsigned long &Options);
+int ParseSearchReplace(EBuffer *B, const char *str, int replace, SearchReplaceOptions &opt);
 int SetDefaultDirectory(EModel *M);
 int GetDefaultDirectory(EModel *M, char *Path, int MaxLen);
+int UnTabStr(char *dest, int maxlen, const char *source, int slen);
+
+#if !defined(HAVE_STRLCPY)
+size_t strlcpy(char *dst, const char *src, size_t size);
+#endif // !HAVE_STRLCPY
+
+#if !defined(HAVE_STRLCAT)
+size_t strlcat(char *dst, const char *src, size_t size);
+#endif // !HAVE_STRLCAT
 
 #endif
diff -X dontdiff -ur fte-0.49.13.1/src/sysdep.h fte-0.50.0/src/sysdep.h
--- fte-0.49.13.1/src/sysdep.h	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/sysdep.h	2007-04-15 11:00:00.000000000 +0800
@@ -174,10 +174,6 @@
 #define HAVE_BOOL
 #endif
 
-#if defined __GNUC__ && (__GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 7))
-#define HAVE_BOOL
-#endif
-
 #if defined _G_HAVE_BOOL
 #define HAVE_BOOL
 #endif
@@ -186,12 +182,6 @@
 #define HAVE_BOOL
 #endif
 
-#if defined __BORLANDC__ && defined __OS2__
-#define popen _popen
-#define pclose _pclose
-#define ftruncate _ftruncate
-#endif
-
 #undef HAVE_STRLCPY
 #undef HAVE_STRLCAT
 
diff -X dontdiff -ur fte-0.49.13.1/src/view.cpp fte-0.50.0/src/view.cpp
--- fte-0.49.13.1/src/view.cpp	2007-04-15 11:00:12.000000000 +0800
+++ fte-0.50.0/src/view.cpp	2007-04-15 11:00:00.000000000 +0800
@@ -147,8 +147,6 @@
     case ExFileNext:            return FileNext();
     case ExFileLast:            return FileLast();
     case ExFileOpen:            return FileOpen(State);
-    case ExFileGrepName:        return FileGrepName();
-    case ExFileCheck:           return FileCheck(State);
     case ExFileOpenInMode:      return FileOpenInMode(State);
     case ExFileSaveAll:         return FileSaveAll();
 
@@ -170,15 +168,11 @@
     case ExViewMessages:        return ViewMessages(State);
     case ExCompile:             return Compile(State);
     case ExRunCompiler:         return RunCompiler(State);
-    case ExGrep:                return Grep(State);
-    case ExvGrep:               return vGrep(State);
     case ExCompilePrevError:    return CompilePrevError(State);
     case ExCompileNextError:    return CompileNextError(State);
 #else
     case ExViewMessages:        return ErFAIL;
     case ExCompile:             return ErFAIL;
-    case ExGrep:                return ErFAIL;
-    case ExvGrep:               return ErFAIL;
     case ExCompilePrevError:    return ErFAIL;
     case ExCompileNextError:    return ErFAIL;
 #endif
@@ -207,17 +201,14 @@
     case ExViewCvsLog:          return ErFAIL;
 #endif
 
-#ifdef VIEWBUFFERS
     case ExViewBuffers:         return ViewBuffers(State);
-#endif
 
     case ExShowKey:             return ShowKey(State);
     case ExToggleSysClipboard:  return ToggleSysClipboard(State);
     case ExSetPrintDevice:      return SetPrintDevice(State);
     case ExShowVersion:         return ShowVersion();
-#ifdef CONFIG_VIEWMODEMAP
     case ExViewModeMap:         return ViewModeMap(State);
-#endif
+    case ExClearMessages:       return ClearMessages();
 
 #ifdef CONFIG_TAGS
     case ExTagNext:             return TagNext(this);
@@ -226,18 +217,11 @@
     case ExTagClear:            TagClear(); return 1;
     case ExTagLoad:             return TagLoad(State);
 #endif
-#ifdef CONFIG_HELP
     case ExShowHelp:            return SysShowHelp(State, 0);
-#endif
-#ifdef CONFIG_OBJ_MESSAGES
-    case ExClearMessages:       return ClearMessages();
     case ExConfigRecompile:     return ConfigRecompile(State);
-#endif
-#ifdef CONFIG_BOOKMARKS
     case ExRemoveGlobalBookmark:return RemoveGlobalBookmark(State);
     case ExGotoGlobalBookmark:  return GotoGlobalBookmark(State);
     case ExPopGlobalBookmark:   return PopGlobalBookmark();
-#endif
     }
     return Model ? Model->ExecCommand(Command, State) : 0;
 }
@@ -346,17 +330,6 @@
     return 0;
 }
 
-int EView::KillFileGrp() {
-    char s[512];
-    if (Model) {
-        EModel *n=Model->Next;
-        Model->GetName(s,sizeof(s));
-        Msg(S_INFO,"CT::%s",s);  //try to kill last fte.grp when vgrep is active
-        return 1;
-    }
-    return 0;
-}
-
 int EView::SwitchTo(ExState &State) {
     EModel *M;
     int No;
@@ -397,65 +370,15 @@
     return 1;
 }
 
-int EView::FileGrepName() {
-    if (strlen(GrepName)==0) return 0;
-    return MultiFileLoad(0, GrepName, NULL, this);
-}
-
-int EView::FileCheck(ExState &State) {
-    char FName[MAXPATH];
-#ifndef UNIX
-    char msHome[MAXPATH];
-#endif
-    char *myHome;
-    FILE *in;
-#ifdef UNIX
-    myHome = getenv("HOME");
-#else
-    sprintf(msHome,"c:");
-    myHome = msHome;
-#endif
-    if (State.GetStrParam(this, FName, sizeof(FName)) != 0) {
-#ifdef UNIX
-        if (!strcmp(FName,"fte.grp")) sprintf(FName,"%s/fte.grp",myHome);
-#else
-        if (!strcmp(FName,"fte.grp")) sprintf(FName,"%s\\fte.grp",myHome);
-#endif
-//        if (!strcmp(FName,"tag")) sprintf(FName,"%s\\ve.dat",GetTmpDir());
-        if (( in = fopen(FName,"rb"))==NULL) {
-               Msg(S_INFO,"Context history not founded.");
-               return 0;
-            }
-        fclose(in);
-        return 1;
-    }
-    return 0;
-}
-
 int EView::FileOpen(ExState &State) {
     char FName[MAXPATH];
-#ifndef UNIX
-    char msHome[MAXPATH];
-#endif
-    char *myHome;
-#ifdef UNIX
-    myHome = getenv("HOME");
-#else
-    sprintf(msHome,"c:");
-    myHome = msHome;
-#endif
+
     if (State.GetStrParam(this, FName, sizeof(FName)) == 0) {
-        if (GetDefaultDirectory(Model, FName, sizeof(FName)) == 0) return 0;
+        if (GetDefaultDirectory(Model, FName, sizeof(FName)) == 0)
+            return 0;
         if (MView->Win->GetFile("Open file", sizeof(FName), FName, HIST_PATH, GF_OPEN) == 0) return 0;
-    } else {
-        if (!strcmp(FName,"fte.grp")) {
-#ifdef UNIX
-            sprintf(FName,"%s/fte.grp",myHome);
-#else
-            sprintf(FName,"%s\\fte.grp",myHome);
-#endif
-        }
     }
+
     if( strlen( FName ) == 0 ) return 0;
 
 #ifdef CONFIG_OBJ_DIRECTORY
@@ -486,7 +409,7 @@
         return OpenDir(FName);
 #endif
 
-//    if( strlen( FName ) == 0 ) return 0;
+    if( strlen( FName ) == 0 ) return 0;
 
     return MultiFileLoad(0, FName, Mode, this);
 }
@@ -515,7 +438,7 @@
     ks.Mask = 0;
     ks.Key = MView->Win->GetChar(0);
 
-    GetKeyName(buf, sizeof(buf), ks);
+    GetKeyName(buf, ks);
     Msg(S_INFO, "Key: '%s' - '%8X'", buf, ks.Key);
     return 1;
 }
@@ -557,7 +480,6 @@
     }
 }
 
-#ifdef VIEWBUFFERS
 int EView::ViewBuffers(ExState &/*State*/) {
     if (BufferList == 0) {
         BufferList = new BufferView(0, &ActiveModel);
@@ -570,7 +492,6 @@
     }
     return 0;
 }
-#endif
 
 #ifdef CONFIG_OBJ_ROUTINE
 int EView::ViewRoutines(ExState &/*State*/) {
@@ -614,7 +535,7 @@
     char XPath[MAXPATH];
     EDirectory *dir = 0;
 
-    if (ExpandPath(Path, XPath, sizeof(XPath)) == -1)
+    if (ExpandPath(Path, XPath) == -1)
         return 0;
     {
         EModel *x = Model;
@@ -686,150 +607,6 @@
     return Compile(Command);
 }
 
-int EView::Grep(ExState &State) { // lechee
-    static char Cmd[512] = "";
-    char Command[512] = "";
-    char SPath[512] = "";
-    char BMask[512] = "*.asm *.inc *.cpp *.c *.h";
-    char DoCmd[512] = "";
-    char *B,*BD;
-
-    B = getenv("bmask");
-    if (B != NULL) {
-        strcpy(BMask,B);
-        }
-    BD = getenv("bhome");
-    if (BD != NULL) {
-        strcpy(SPath,BD);
-    } else {
-       BD = getenv("tagfile");
-       if (BD != NULL) {
-           strcpy(SPath,BD);
-       }
-    }
-    if (CompilerMsgs != 0 && CompilerMsgs->Running) {
-        Msg(S_INFO, "Already running...");
-        return 0;
-    }
-    // Get String Parameter from CNF as command parameter
-    if (State.GetStrParam(this, Command, sizeof(Command)) == 0) {
-        if (Model->GetContext() == CONTEXT_FILE) {
-            EBuffer *B = (EBuffer *)Model;
-            if (BFS(B, BFS_CompileCommand) != 0)
-                strcpy(Cmd, BFS(B, BFS_CompileCommand));
-        }
-        if (Cmd[0] == 0)
-            strcpy(Cmd, CompileCommand);
-
-        if (MView->Win->GetStr("Grep", sizeof(Cmd), Cmd, HIST_GREP) == 0) return 0;
-        strcpy(Command, Cmd);
-    } else {
-
-        if (strlen(SearchPattern)!=0) {   
-             strcat(Command,SearchPattern);
-             }
-        if (MView->Win->GetStr("Grep", sizeof(Command), Command, HIST_GREP) == 0) return 0;
-        if (strlen(Command)==0) return 0;
-        if (MView->Win->GetStr("Dir", sizeof(SPath), SPath, HIST_GREPPATH) == 0) return 0;
-        if (SPath[strlen(SPath)-1]=='\\') SPath[strlen(SPath)-1]='\0';
-        if ((!strcmp(SPath,"."))||(strlen(SPath)==0)) GetStrVar(mvCurDirectory, SPath,512);
-//            GetCurrentDirectory(sizeof(SPath),SPath);
-        if (MView->Win->GetStr("Mask",sizeof(BMask), BMask, HIST_BMASK) == 0) return 0;
-        if (strlen(BMask)==0) strcpy(BMask,"*.*");
-        Msg(S_INFO,"Grep in Progress ........");
-    }
-        sprintf(DoCmd,"BX !Greps! %s \"%s\" \"%s\"",Command,BMask,SPath);
-    return Grep(DoCmd);
-}
-
-int EView::vGrep(ExState &State) {
-    static char Cmd[512] = "";
-    char Command[512] = "";
-    char SPath[512] = "";
-    char BMask[512] = "*.cpp";
-    char DoCmd[512] = "";
-    char myDir[512] = "";
-    char *lMask;
-    char *B,*BD,*myHome;
-//    KillFileGrp();
-//    return 0;
-    myHome = getenv("HOME");
-    if (strlen(VMASK)) {
-        strcpy(BMask,VMASK);
-    } else {
-        B = getenv("bmask");
-        if (B != NULL) {
-            strcpy(BMask,B);
-        }
-    }
-    if (strlen(VDIR)) {
-        strcpy(SPath,VDIR);
-    } else {
-        BD = getenv("bhome");
-        if ( BD != NULL ) {
-            strcpy(SPath,BD);
-        } else {
-            BD = getenv("tagfile");
-            if (BD != NULL) {
-                strcpy(SPath,BD);
-            }
-        }
-    }
-    if (CompilerMsgs != 0 && CompilerMsgs->Running) {
-        Msg(S_INFO, " Already running...");
-        return 0;
-    }
-    if (State.GetStrParam(this, Command, sizeof(Command)) == 0) {
-        if (Model->GetContext() == CONTEXT_FILE) {
-            EBuffer *B = (EBuffer *)Model;
-            if (BFS(B, BFS_CompileCommand) != 0)
-                strcpy(Cmd, BFS(B, BFS_CompileCommand));
-        }
-        if (Cmd[0] == 0)
-            strcpy(Cmd, CompileCommand);
-        if (MView->Win->GetStr("vGrep", sizeof(Cmd), Cmd, HIST_GREP) == 0)
-            return 0;
-        strcpy(Command, Cmd);
-    } else {
-        if (strlen(SearchPattern)!=0) {
-            strcat(Command,SearchPattern);
-        }
-        if (MView->Win->GetStr("vGrep", sizeof(Command), Command, HIST_GREP) == 0) return 0;
-        if (strlen(Command)==0) return 0;
-        if (MView->Win->GetStr("Dir", sizeof(SPath), SPath, HIST_GREPPATH) == 0) return 0;
-        if (SPath[strlen(SPath)-1]=='\\') SPath[strlen(SPath)-1]='\0';
-        if ((!strcmp(SPath,"."))||(strlen(SPath)==0)) {
-            //.ll            myDir=get_current_dir_name(); GetCurrentDirectory()
-            GetStrVar(mvCurDirectory, myDir,512);
-            strcpy(SPath,myDir);
-        }
-        if (MView->Win->GetStr("Mask",sizeof(BMask), BMask, HIST_BMASK) == 0) return 0;
-
-#ifdef UNIX
-        if (BMask[0]=='*') {
-            sprintf(lMask,"\\%s",BMask);
-        } else {
-            strcpy(lMask,BMask);
-        }
-#endif
-        if (strlen(BMask)==0) strcpy(BMask,"*.*");
-        Msg(S_INFO,"vGrep in Progress ........");
-    }
-//    sprintf(DoCheck,"%s/fte.grp",myHome);
-#ifdef NTCONSOLE
-    sprintf(DoCmd,"vgrep --grep %s \"%s\" \"%s\"",Command,SPath,BMask);
-#else
-    //    sprintf(DoCmd,"grep --include=%s -irn %s %s >%s/fte.grp",BMask,Command,SPath,myHome);
-    //    sprintf(DoCmd,"vgrep1.pl %s %s %s",Command, SPath,lMask);
-    sprintf(DoCmd,"vgrep --grep \"%s\" %s %s",Command, SPath, lMask);
-#endif
-    strcpy(VDIR,SPath);
-    strcpy(VMASK,BMask);
-//    Msg(S_INFO,"%s",DoCmd);
-//    return(0);
-    return Grep(DoCmd);
-}
-
 int EView::Compile(char *Command) {
     char Dir[MAXPATH] = "";
     EMessages *msgs;
@@ -848,12 +625,6 @@
     return 1;
 }
 
-int EView::Grep(char *Command) {
-    system(Command);
-    Msg(S_INFO,"-= Grep Done =-");
-    return 1;
-}
-
 int EView::ViewMessages(ExState &/*State*/) {
     if (CompilerMsgs != 0) {
         SwitchToModel(CompilerMsgs);
@@ -880,7 +651,6 @@
     return 1;
 }
 
-#ifdef CONFIG_VIEWMODEMAP
 int EView::ViewModeMap(ExState &/*State*/) {
     if (TheEventMapView != 0)
         TheEventMapView->ViewMap(GetEventMap());
@@ -892,9 +662,7 @@
         return 0;
     return 1;
 }
-#endif
 
-#ifdef CONFIG_OBJ_MESSAGES
 int EView::ClearMessages() {
     if (CompilerMsgs != 0 && CompilerMsgs->Running) {
         Msg(S_INFO, "Running...");
@@ -906,7 +674,6 @@
     }
     return 1;
 }
-#endif
 
 #ifdef CONFIG_TAGS
 int EView::TagLoad(ExState &State) {
@@ -918,31 +685,23 @@
     {
         pTagFile = "tags";
     }
-    if (ExpandPath(pTagFile, Tag, sizeof(Tag)) == -1)
+    if (ExpandPath(pTagFile, Tag) == -1)
         return 0;
+    if (State.GetStrParam(this, Tag, sizeof(Tag)) == 0)
+        if (MView->Win->GetFile("Load tags", sizeof(Tag), Tag, HIST_TAGFILES, GF_OPEN) == 0) return 0;
 
-//    if (!BFI(VBuffer, BFI_AutoTag)) {
-        if (State.GetStrParam(this, Tag, sizeof(Tag)) == 0)
-            if (MView->Win->GetFile("Load tags", sizeof(Tag), Tag, HIST_TAGFILES, GF_OPEN) == 0) return 0;
-//    }
-
-    if (ExpandPath(Tag, FullTag, sizeof(FullTag)) == -1)
+    if (ExpandPath(Tag, FullTag) == -1)
         return 0;
 
-    Msg(S_INFO,"Tags via [%s] in progress .........",FullTag);  // register_framebuffer
-
     if (!FileExists(FullTag)) {
         Msg(S_INFO, "Tag file '%s' not found.", FullTag);
         return 0;
     }
 
-    Msg(S_INFO,"Load Complete.. < Tag via TagFind() >");
-
     return ::TagLoad(FullTag);
 }
 #endif
 
-#ifdef CONFIG_OBJ_MESSAGES
 int EView::ConfigRecompile(ExState &/*State*/) {
     if (ConfigSourcePath == 0 || ConfigFileName[0] == 0) {
         Msg(S_ERROR, "Cannot recompile (must use external configuration).");
@@ -951,24 +710,18 @@
 
     char command[1024];
 
-    strlcpy(command, "cfte \"", sizeof(command));
-    strlcat(command, ConfigSourcePath, sizeof(command));
-    strlcat(command, "\" ", sizeof(command));
+    strcpy(command, "cfte ");
+    strcat(command, ConfigSourcePath);
+    strcat(command, " ");
 #ifdef UNIX
-    if (ExpandPath("~/.fterc", command + strlen(command), sizeof(command) - strlen(command)) != 0)
+    if (ExpandPath("~/.fterc", command + strlen(command)) != 0)
         return 0;
 #else
-    strlcat(command, "\"", sizeof(command));
-    strlcat(command, ConfigFileName, sizeof(command));
-    strlcat(command, "\"", sizeof(command));
+    strcat(command, ConfigFileName);
 #endif
     return Compile(command);
 }
 
-#endif
-
-#ifdef CONFIG_BOOKMARKS
-
 int EView::RemoveGlobalBookmark(ExState &State) {
     char name[256] = "";
 
@@ -999,7 +752,6 @@
     }
     return 1;
 }
-#endif
 
 int EView::GetStrVar(int var, char *str, int buflen) {
     //switch (var) {
@@ -1063,7 +815,7 @@
 
     switch (Model->GetContext()) {
         case CONTEXT_FILE:
-            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles, sizeof(buf)) != 0) return 0; // OnFiles points to buf
+            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles) != 0) return 0;
             break;
         case CONTEXT_CVSDIFF:
             OnFiles = strdup(CvsDiffView->OnFiles);
@@ -1155,7 +907,7 @@
 
     switch (Model->GetContext()) {
         case CONTEXT_FILE:
-            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles, sizeof(buf)) != 0) return 0; // OnFiles points to buf
+            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles) != 0) return 0;
             break;
         case CONTEXT_CVSDIFF:
             OnFiles = strdup(CvsDiffView->OnFiles);
@@ -1177,7 +929,6 @@
     return 1;
 }
 
-
 int EView::ViewCvsDiff(ExState &/*State*/) {
     if (CvsDiffView != 0) {
         SwitchToModel(CvsDiffView);
@@ -1234,7 +985,7 @@
 
     switch (Model->GetContext()) {
         case CONTEXT_FILE:
-            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles, sizeof(buf)) != 0) return 0; // OnFiles points to buf
+            if (JustFileName(((EBuffer *)Model)->FileName, OnFiles) != 0) return 0;
             break;
         case CONTEXT_CVSDIFF:
             OnFiles = strdup(CvsDiffView->OnFiles);
@@ -1260,7 +1011,4 @@
     return 0;
 }
 
-
-// test linux kernel function call register_framebuffer()
-
 #endif
